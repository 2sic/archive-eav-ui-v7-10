<div class="eav-entityselect">
    <div ui-tree="options" data-empty-placeholder-enabled="false" ng-show="to.settings.merged.EnableCreate || chosenEntities.length > 0">
        <ol ui-tree-nodes ng-model="chosenEntities" entity-validation ng-required="false">
            <li ng-repeat="item in chosenEntities track by $index" ui-tree-node class="eav-entityselect-item">
                <div ui-tree-handle>
                    <i title="{{ 'FieldType.Entity.DragMove' | translate }}" class="icon-link pull-left eav-entityselect-icon" ng-show="to.settings.Entity.AllowMultiValue"></i>
                    <span title="{{getEntityText(item) + ' (' + item + ')'}}">{{getEntityText(item)}}</span>
                    <span class="eav-entityselect-item-actions">
                        <span data-nodrag title="{{ 'FieldType.Entity.Edit' | translate }}" ng-click="edit(item, index)" ng-if="to.settings.merged.EnableEdit">
                            <i class="icon-pencil"></i>
                        </span>
                        <span data-nodrag title="{{ 'FieldType.Entity.Remove' | translate }}" ng-click="removeSlot(item, $index)" class="eav-entityselect-item-remove" ng-if="to.settings.merged.EnableRemove">
                            <i ng-class="{ 'icon-minus-circled': to.settings.merged.AllowMultiValue, 'icon-down-dir': !to.settings.merged.AllowMultiValue  }"></i>
                        </span>
                        <!-- todo: i18n, code in action, icon-visiblity/alignment -->
                        <span data-nodrag title="{{ 'FieldType.Entity.Delete' | translate }}" ng-click="deleteItemInSlot(item, $index)" class="eav-entityselect-item-remove" ng-if="to.settings.merged.EnableDelete">
                            <i class="icon-cancel"></i>
                        </span>
                    </span>
                </div>
            </li>

            <!-- add existing entity to this list-->
            <li class="eav-entityselect-item subtle-till-mouseover" 
                ng-if="to.settings.merged.EnableAddExisting"
                ng-show="to.settings.merged.AllowMultiValue || chosenEntities.length < 1">
                <div>
                    <i class="icon-plus-circled pull-left eav-entityselect-icon-before-select"></i>
                    <span>
                        <select class="eav-entityselect-selector form-control input-lg"
                                formly-skip-ng-model-attrs-manipulator
                                ng-model="selectedEntity"
                                ng-change="addEntity()"
                                >
                            <option value="" translate="FieldType.Entity.Choose"></option>
                            <option ng-repeat="item in availableEntities" ng-disabled="chosenEntities.indexOf(item.Value) != -1" value="{{item.Value}}">{{item.Text}}</option>
                        </select>
                    </span>
                </div>
            </li>

            <!-- create new entity to add to this list -->
            <li ng-if="to.settings.merged.EnableCreate && (to.settings.merged.AllowMultiValue || chosenEntities.length < 1)" 
                class="eav-entityselect-item eav-entityselect-create subtle-till-mouseover">
                <div ng-click="openNewEntityDialog()">
                    <i class="icon-plus pull-left eav-entityselect-icon"></i>
                    <span>{{ 'FieldType.Entity.New' | translate }}&nbsp;</span>
                </div>
            </li>
        </ol>
    </div>

</div>