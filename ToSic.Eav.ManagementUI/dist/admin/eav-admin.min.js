/*! tosic.eav 2015-10-13 11:54 */

!function(){angular.module("ContentExportApp",["EavAdminUi","EavDirectives","EavConfiguration","EavServices","ContentHelperFilters","ContentFormlyTypes"])}(),function(){function a(a,b,c,d,e,f,g,h){var i=h("translate"),j=this;j.formValues={},j.formFields=[{key:"AppId",type:"hidden",defaultValue:a},{key:"DefaultLanguage",type:"hidden",defaultValue:h("isoLangCode")(f.defaultLanguage)},{key:"ContentType",type:"hidden",defaultValue:b},{key:"Language",type:"select",expressionProperties:{"templateOptions.label":"'Content.Export.Fields.Language.Label' | translate","templateOptions.options":function(){var a=[{name:i("Content.Export.Fields.Language.Options.All"),value:""}];return angular.forEach(f.languages,function(b){var c=h("isoLangCode")(b.key);a.push({name:c,value:c})}),a}},defaultValue:""},{key:"RecordExport",type:"radio",expressionProperties:{"templateOptions.label":"'Content.Export.Fields.RecordExport.Label' | translate","templateOptions.options":function(){return[{name:i("Content.Export.Fields.RecordExport.Options.Blank"),value:"Blank"},{name:i("Content.Export.Fields.RecordExport.Options.All"),value:"All"}]}},defaultValue:"All"},{key:"LanguageReferences",type:"radio",expressionProperties:{"templateOptions.label":"'Content.Export.Fields.LanguageReferences.Label' | translate","templateOptions.disabled":function(){return"Blank"==j.formValues.RecordExport},"templateOptions.options":function(){return[{name:i("Content.Export.Fields.LanguageReferences.Options.Link"),value:"Link"},{name:i("Content.Export.Fields.LanguageReferences.Options.Resolve"),value:"Resolve"}]}},defaultValue:"Link"},{key:"ResourcesReferences",type:"radio",expressionProperties:{"templateOptions.label":"'Content.Export.Fields.ResourcesReferences.Label' | translate","templateOptions.disabled":function(){return"Blank"==j.formValues.RecordExport},"templateOptions.options":function(){return[{name:i("Content.Export.Fields.ResourcesReferences.Options.Link"),value:"Link"},{name:i("Content.Export.Fields.ResourcesReferences.Options.Resolve"),value:"Resolve"}]}},defaultValue:"Link"}],j.exportContent=function(){c.exportContent(j.formValues)},j.close=function(){g.dismiss("cancel")}}angular.module("ContentExportApp").controller("ContentExport",a),a.$inject=["appId","contentType","contentExportService","eavAdminDialogs","eavConfig","languages","$modalInstance","$filter"]}(),function(){function a(){function a(a){window.open("/api/eav/ContentExport/ExportContent?appId="+a.AppId+"&language="+a.Language+"&defaultLanguage="+a.DefaultLanguage+"&contentType="+a.ContentType+"&recordExport="+a.RecordExport+"&resourcesReferences="+a.ResourcesReferences+"&languageReferences="+a.LanguageReferences,"_self","")}var b={exportContent:a};return b}angular.module("ContentExportApp").factory("contentExportService",a)}(),function(){angular.module("ContentFormlyTypes",["naif.base64","formly","formlyBootstrap","ui.bootstrap"])}(),function(){angular.module("ContentFormlyTypes").config(["formlyConfigProvider",function(a){var b=a;b.setType({name:"file",template:"<span class='btn btn-default btn-square btn-file'><span class='glyphicon glyphicon-open'></span><input type='file' ng-model='model[options.key]' base-sixty-four-input /></span> <span ng-if='model[options.key]'>{{model[options.key].filename}}</span>",wrapper:["bootstrapLabel","bootstrapHasError"]}),b.setType({name:"hidden",template:"<input style='display:none' ng-model='model[options.key]' />",wrapper:["bootstrapLabel","bootstrapHasError"]})}])}(),function(){angular.module("ContentHelperFilters",[]),angular.module("ContentHelperFilters").filter("isoLangCode",function(){return function(a){return 5!=a.length?a:a.substring(0,2).toLowerCase()+"-"+a.substring(3,5).toUpperCase()}})}(),function(){angular.module("ContentImportApp",["EavAdminUi","EavDirectives","EavConfiguration","EavServices","ContentHelperFilters","ContentFormlyTypes"])}(),function(){function a(a,b,c,d,e,f,g,h,i){var j=i("translate"),k=this;k.debug=g,k.formValues={},k.formFields=[{key:"AppId",type:"hidden",defaultValue:a},{key:"DefaultLanguage",type:"hidden",defaultValue:i("isoLangCode")(f.defaultLanguage)},{key:"ContentType",type:"hidden",defaultValue:b},{key:"File",type:"file",templateOptions:{required:!0},expressionProperties:{"templateOptions.label":"'Content.Import.Fields.File.Label' | translate"}},{key:"ResourcesReferences",type:"radio",expressionProperties:{"templateOptions.label":"'Content.Import.Fields.ResourcesReferences.Label' | translate","templateOptions.options":function(){return[{name:j("Content.Import.Fields.ResourcesReferences.Options.Keep"),value:"Keep"},{name:j("Content.Import.Fields.ResourcesReferences.Options.Resolve"),value:"Resolve"}]}},defaultValue:"Keep"},{key:"ClearEntities",type:"radio",expressionProperties:{"templateOptions.label":"'Content.Import.Fields.ClearEntities.Label' | translate","templateOptions.options":function(){return[{name:j("Content.Import.Fields.ClearEntities.Options.None"),value:"None"},{name:j("Content.Import.Fields.ClearEntities.Options.All"),value:"All"}]}},defaultValue:"None"}],k.viewStates={Waiting:0,Default:1,Evaluated:2,Imported:3},k.viewStateSelected=k.viewStates.Default,k.evaluationResult={},k.importResult={},k.evaluateContent=function(){return k.viewStateSelected=k.viewStates.Waiting,c.evaluateContent(k.formValues).then(function(a){k.evaluationResult=a.data,k.viewStateSelected=k.viewStates.Evaluated})},k.importContent=function(){return k.viewStateSelected=k.viewStates.Waiting,c.importContent(k.formValues).then(function(a){k.importResult=a.data,k.viewStateSelected=k.viewStates.Imported})},k.reset=function(){k.formValues={},k.evaluationResult={},k.importResult={}},k.back=function(){k.viewStateSelected=k.viewStates.Default},k.close=function(){k.viewStateSelected=k.viewStates.Default,h.dismiss("cancel")}}angular.module("ContentImportApp").controller("ContentImport",a),a.$inject=["appId","contentType","contentImportService","eavAdminDialogs","eavConfig","languages","debugState","$modalInstance","$filter"]}(),function(){function a(a){function b(b){return a.post("eav/ContentImport/EvaluateContent",{AppId:b.AppId,DefaultLanguage:b.DefaultLanguage,ContentType:b.ContentType,ContentBase64:b.File.base64,ResourcesReferences:b.ResourcesReferences,ClearEntities:b.ClearEntities})}function c(b){return a.post("eav/ContentImport/ImportContent",{AppId:b.AppId,DefaultLanguage:b.DefaultLanguage,ContentType:b.ContentType,ContentBase64:b.File.base64,ResourcesReferences:b.ResourcesReferences,ClearEntities:b.ClearEntities})}var d={evaluateContent:b,importContent:c};return d}angular.module("ContentImportApp").factory("contentImportService",a),a.$inject=["$http"]}(),function(){function a(a,b,c,d,e){var f=this;f.mode=a,f.entityId=b,f.contentType=c,f.TestMessage="Test message the controller is binding correctly...",f.history=function(){return d.openItemHistory(f.entityId)},f.close=function(){e.dismiss("cancel")}}angular.module("ContentEditApp",["EavServices","EavAdminUi"]).controller("EditContentItem",a),a.$inject=["mode","entityId","contentType","eavAdminDialogs","$modalInstance"]}(),function(){function a(a,b,c,d,e,f,g){var h=this;h.debug=f;var i=a(c,d);h.add=function(){e.openItemNew(d,i.liveListReload)},h.edit=function(a){e.openItemEditWithEntityId(a.Id,i.liveListReload)},h.refresh=i.liveListReload,h.items=i.liveList(),h.dynamicColumns=[],i.getColumns().then(function(a){for(var b=a.data,c=0;c<b.length;c++)b[c].IsTitle||h.dynamicColumns.push(b[c])}),h.tryToDelete=function(a){confirm("Delete 'title-unknown-yet' ("+a.RepositoryId+") ?")&&i["delete"](a.RepositoryId)},h.openDuplicate=function(a){var b=[{ContentTypeName:d,DuplicateEntity:a.Id}];e.openEditItems(b,i.liveListReload)},h.close=function(){g.dismiss("cancel")}}angular.module("ContentItemsApp",["EavConfiguration","EavAdminUi","EavServices"]).controller("ContentItemsList",a),a.$inject=["contentItemsSvc","eavConfig","appId","contentType","eavAdminDialogs","debugState","$modalInstance"]}(),function(){function a(a,b,c,d,e){var f=this,g=c(a,b);f.entityId=b,f.items=g.liveList(),f.close=function(){d.dismiss("cancel")},f.details=function(a){e.open({animation:!0,templateUrl:"content-items/history-details.html",controller:"HistoryDetails",controllerAs:"vm",resolve:{changeId:function(){return a.ChangeId},dataSvc:function(){return g}}})}}function b(a,b,c){var d=this;alert("not implemented yet");var e=b;e.getVersionDetails(a).then(function(a){alert(a.data),d.items=a.data}),d.close=function(){c.dismiss("cancel")}}angular.module("HistoryApp",["EavServices","EavConfiguration","eavTemplates"]).controller("History",a).controller("HistoryDetails",b),a.$inject=["appId","entityId","historySvc","$modalInstance","$modal"],b.$inject=["changeId","dataSvc","$modalInstance"]}(),function(){angular.module("ContentTypesApp",["EavServices","EavAdminUi","EavDirectives"]).constant("license",{createdBy:"2sic internet solutions",license:"MIT"})}(),function(){function contentTypeListController(contentTypeSvc,eavAdminDialogs,appId,debugState,$translate){var vm=this,svc=contentTypeSvc(appId);vm.debug=debugState,vm.items=svc.liveList(),vm.refresh=svc.liveListReload,vm.tryToDelete=function(a){$translate("General.Questions.Delete",{target:"'"+a.Name+"' ("+a.Id+")"}).then(function(b){confirm(b)&&svc["delete"](a)})},vm.edit=function(a){void 0===a&&(a=svc.newItem()),eavAdminDialogs.openContentTypeEdit(a,vm.refresh)},vm.editFields=function(a){eavAdminDialogs.openContentTypeFields(a,vm.refresh)},vm.editItems=function(a){eavAdminDialogs.openContentItems(svc.appId,a.StaticName,a.Id,vm.refresh)},vm.liveEval=function admin(){$translate("General.Questions.SystemInput").then(function(msg){var inp=prompt(msg);inp&&eval(inp)})},vm.changeScope=function(){$translate("ContentTypes.Buttons.ChangeScopeQuestion").then(function(a){var b=prompt(a);b&&svc.setScope(b)})},vm.isGuid=function(a){var b=new RegExp(/[a-f0-9]{8}(?:-[a-f0-9]{4}){3}-[a-f0-9]{12}/i);return b.test(a)},vm.permissions=function(a){return eavAdminDialogs.openPermissionsForGuid(svc.appId,a.StaticName,vm.refresh)},vm.openExport=function(a){return eavAdminDialogs.openContentExport(svc.appId,a.StaticName,vm.refresh)},vm.openImport=function(a){return eavAdminDialogs.openContentImport(svc.appId,a.StaticName,vm.refresh)}}function contentTypeEditController(a,b,c,d,e){var f=this,g=c(a);f.item=b,f.ok=function(){g.save(b).then(function(){e.close(f.item)})},f.close=function(){e.dismiss("cancel")}}angular.module("ContentTypesApp").controller("List",contentTypeListController).controller("Edit",contentTypeEditController),contentTypeListController.$inject=["contentTypeSvc","eavAdminDialogs","appId","debugState","$translate"],contentTypeEditController.$inject=["appId","item","contentTypeSvc","$translate","$modalInstance"]}(),function(){function a(a,b,c,d,e,f,g,h){var i=this,j=b(a,c);i.close=function(){d.dismiss("cancel")},i.items=j.liveList(),i.add=function(){e.open({animation:!0,templateUrl:"content-types/content-types-field-edit.html",controller:"FieldsAdd",controllerAs:"vm",resolve:{svc:function(){return j}}})},i.moveUp=j.moveUp,i.moveDown=j.moveDown,i.setTitle=j.setTitle,i.tryToDelete=function(a){return a.IsTitle?g(["General.Messages.CantDelete","General.Terms.Title"],{target:"{0}"}).then(function(a){alert(a["General.Messages.CantDelete"].replace("{0}",a["General.Terms.Title"]))}):void g("General.Questions.Delete",{target:"'"+a.StaticName+"' ("+a.Id+")"}).then(function(b){confirm(b)&&j["delete"](a)})},i.createOrEditMetadata=function(a,b){var c=[i.createItemDefinition(a,"All"),i.createItemDefinition(a,b)];f.openEditItems(c,j.liveListReload)},i.createItemDefinition=function(a,b){var c="All"==b?"General":b;return void 0!==a.Metadata[b]?{EntityId:a.Metadata[b].Id,Title:c}:{ContentTypeName:"@"+b,Metadata:{Key:a.Id,KeyType:"number",TargetType:h.metadataOfAttribute},Title:c,Prefill:{Name:a.StaticName}}}}function b(a,b){var c=this,d=a.newItem;c.items=[d(),d(),d(),d(),d(),d(),d(),d(),d(),d()],c.item=a.newItem(),c.types=a.types.liveList(),c.ok=function(){for(var d=c.items,e=[],f=0;f<d.length;f++)d[f].StaticName&&e.push(d[f]);a.addMany(e,0),b.close()},c.close=function(){b.dismiss("cancel")}}angular.module("ContentTypesApp").controller("FieldList",a).controller("FieldsAdd",b),a.$inject=["appId","contentTypeFieldSvc","contentType","$modalInstance","$modal","eavAdminDialogs","$translate","eavConfig"],b.$inject=["svc","$modalInstance"]}(),angular.module("EavDirectives",[]).directive("icon",function(){return{restrict:"A",replace:!1,transclude:!1,link:function(a,b,c){var d=c.icon;b.addClass("glyphicon glyphicon-"+d)}}}).directive("stopEvent",function(){return{restrict:"A",link:function(a,b,c){c&&c.stopEvent&&b.bind(c.stopEvent,function(a){a.stopPropagation()})}}}),angular.module("eavTemplates",[]).run(["$templateCache",function(a){"use strict";a.put("content-import-export/content-export.html",'<div class=modal-header><button class="btn btn-default btn-square pull-right" type=button icon=remove ng-click=vm.close()></button><h3 class=modal-title translate=Content.Export.Title>cc</h3></div><div class=modal-body><div translate=Content.Export.Help></div><formly-form form=vm.form model=vm.formValues fields=vm.formFields></formly-form></div><div class=modal-footer><button type=button class="btn btn-primary pull-left" ng-click=vm.exportContent() translate=Content.Export.Commands.Export></button></div>'),a.put("content-import-export/content-import.html",'<div ng-click=vm.debug.autoEnableAsNeeded($event)><div class=modal-header><button class="btn btn-default btn-square pull-right" type=button icon=remove ng-click=vm.close()></button><h3 class=modal-title><span translate=Content.Import.Title></span> <span ng-show="vm.viewStateSelected > 0" translate=Content.Import.TitleSteps translate-values="{step: vm.viewStateSelected}"></span></h3></div><div ng-switch=vm.viewStateSelected><div ng-switch-when=1><div class=modal-body><div translate=Content.Import.Help></div><formly-form form=vm.form model=vm.formValues fields=vm.formFields></formly-form><div class=text-warning translate=Content.Import.Messages.BackupContentBefore></div></div><div class=modal-footer><button type=button class="btn btn-primary pull-left" ng-click=vm.evaluateContent() ng-disabled="!vm.formValues.File || !vm.formValues.File.filename" translate=Content.Import.Commands.Preview></button></div></div><div ng-switch-when=0><div class=modal-body>{{\'Content.Import.Messages.WaitingForResponse\' | translate}}</div></div><div ng-switch-when=2><div class=modal-body><div ng-if=vm.evaluationResult.Succeeded><h4 translate=Content.Import.Evaluation.Detail.Title translate-values="{filename: vm.formValues.File.filename}"></h4><h5 translate=Content.Import.Evaluation.Detail.File.Title></h5><ul><li translate=Content.Import.Evaluation.Detail.File.ElementCount translate-values="{count: vm.evaluationResult.Detail.DocumentElementsCount}"></li><li translate=Content.Import.Evaluation.Detail.File.LanguageCount translate-values="{count: vm.evaluationResult.Detail.LanguagesInDocumentCount}"></li><li translate=Content.Import.Evaluation.Detail.File.Attributes translate-values="{count: vm.evaluationResult.Detail.AttributeNamesInDocument.length, attributes: vm.evaluationResult.Detail.AttributeNamesInDocument.join(\', \')}"></li></ul><h5 translate=Content.Import.Evaluation.Detail.Entities.Title></h5><ul><li translate=Content.Import.Evaluation.Detail.Entities.Create translate-values="{count: vm.evaluationResult.Detail.AmountOfEntitiesCreated}"></li><li translate=Content.Import.Evaluation.Detail.Entities.Update translate-values="{count: vm.evaluationResult.Detail.AmountOfEntitiesUpdated}"></li><li translate=Content.Import.Evaluation.Detail.Entities.Delete translate-values="{count: vm.evaluationResult.Detail.AmountOfEntitiesDeleted}"></li><li translate=Content.Import.Evaluation.Detail.Entities.AttributesIgnored translate-values="{count: vm.evaluationResult.Detail.AttributeNamesNotImported.length, attributes: vm.evaluationResult.Detail.AttributeNamesNotImported.join(\', \')}"></li></ul><div class=text-warning translate=Content.Import.Messages.ImportCanTakeSomeTime></div></div><div ng-if=!vm.evaluationResult.Succeeded><h4 translate=Content.Import.Evaluation.Error.Title translate-values="{filename: vm.formValues.File.filename}"></h4><ul><li ng-repeat="error in vm.evaluationResult.Detail"><div><span translate=Content.Import.Evaluation.Error.Codes.{{error.ErrorCode}}></span></div><div ng-if=error.ErrorDetail><i translate=Content.Import.Evaluation.Error.Detail translate-values="{detail: error.ErrorDetail}"></i></div><div ng-if=error.LineNumber><i translate=Content.Import.Evaluation.Error.LineNumber&quot; translate-values="{number: error.LineNumber}"></i></div><div ng-if=error.LineDetail><i translate=Content.Import.Evaluation.Error.LineDetail translate-values="{detail: error.LineDetail}"></i></div></li></ul></div></div><div class=modal-footer><button type=button class="btn pull-left" ng-click=vm.back() icon=arrow-left></button> <button type=button class="btn btn-default pull-left" ng-click=vm.importContent() translate=Content.Import.Commands.Import ng-disabled=!vm.evaluationResult.Succeeded></button></div></div><div ng-switch-when=3><div class=modal-body><span ng-show=vm.importResult.Succeeded translate=Content.Import.Messages.ImportSucceeded></span> <span ng-hide=vm.importResult.Succeeded translate=Content.Import.Messages.ImportFailed></span></div></div><div ng-if=vm.debug.on><h3>Debug infos</h3><pre>{{vm.formValues | json}}</pre></div></div></div>'),a.put("content-items/content-edit.html",'<div class=modal-header><button type=button class="btn btn-default" ng-click=vm.history()><span class="glyphicon glyphicon-time">history / todo</span></button><h3 class=modal-title>Edit / New Content</h3></div><div class=modal-body>this is where the edit appears. Would edit entity {{vm.entityId}} or add a {{vm.contentType}} - depending on the mode: {{vm.mode}}<h3>Use cases</h3><ol><li>Edit an existing entity with ID</li><li>Create a new entity of a certaint content-type, just save and done (like from a "new" button without content-group)</li><li>Create a new entity of a certain type and assign it to a metadata thing (guid, int, string)</li><li>Create a new entity and put it into a content-group at the right place</li><li>Edit content-group: item + presentation</li><li>Edit multiple IDs/or new/mix: Edit multiple items with IDs</li></ol>init of 1 edit - entity-id in storage - new-type + optional: assignment-id + assignment-type - array of the above --- [{id 17}, {type: "person"}, {type: person, asstype: 4, target: 0205}] - content-group</div>'),a.put("content-items/content-items.html",'<div ng-click=vm.debug.autoEnableAsNeeded($event)><div class=modal-header><button class="btn btn-default btn-square pull-right" type=button ng-click=vm.close()><i icon=remove></i></button><h3 class=modal-title translate=Content.Manage.Title></h3></div><div class=modal-body><button type=button class="btn btn-primary btn-square" ng-click=vm.add()><i icon=plus></i></button> <button ng-if=vm.debug.on type=button class="btn btn-warning btn-square" ng-click=vm.refresh()><i icon=repeat></i></button><div style="overflow: auto"><table class="table table-hover table-manage-eav"><thead><tr><th translate=Content.Manage.Table.Id class=col-id></th><th translate=Content.Manage.Table.Status style="width: 60px"></th><th translate=Content.Manage.Table.Title style="width: 200px"></th><th translate=Content.Manage.Table.Actions class=mini-btn-2></th><th ng-repeat="col in vm.dynamicColumns" style="width: 10%">{{col.StaticName}}</th></tr></thead><tbody><tr ng-repeat="item in vm.items | orderBy: [\'Id\',\'-IsPublished\'] " class=clickable-row ng-click=vm.edit(item)><td class="text-nowrap clickable" style="text-align: right"><span tooltip="Id: {{item.Id}}\r\nRepoId: {{item.RepositoryId}}\r\n'+"Guid: {{item.Guid}}\">{{item.Id}}</span></td><td class=text-nowrap><span class=glyphicon ng-class=\"{'glyphicon-eye-open': item.IsPublished, 'glyphicon-eye-close' : !item.IsPublished}\" tooltip=\"{{ 'Content.Publish.' + (item.IsPublished ? 'PnV': item.Published ? 'DoP' : 'D') | translate }}\"></span> <span icon=\"{{ item.Draft ? 'link' : item.Published ? 'link' : '' }}\" tooltip=\"{{ (item.Draft ? 'Content.Publish.HD' :'') | translate:'{ id: item.Draft.RepositoryId}' }}\r\n{{ (item.Published ? 'Content.Publish.HP' :'') | translate }} #{{ item.Published.RepositoryId }}\"></span> <span ng-if=item.Metadata tooltip=\"Metadata for type {{ item.Metadata.TargetType}}, id {{ item.Metadata.KeyNumber }}{{ item.Metadata.KeyString }}{{ item.Metadata.KeyGuid }}\" icon=tag></span></td><td class=\"text-nowrap clickable\"><div class=hide-overflow-text style=\"height: 20px; width: 200px\" tooltip={{item.Title}}>{{item.Title}}{{ (!item.Title ? 'Content.Manage.NoTitle':'') | translate }}</div></td><td class=text-nowrap stop-event=click><button type=button class=\"btn btn-xs btn-square\" ng-click=vm.openDuplicate(item) tooltip=\"{{ 'General.Buttons.Copy' | translate }}\"><i icon=duplicate></i></button> <button type=button class=\"btn btn-xs btn-square\" ng-click=vm.tryToDelete(item) tooltip=\"{{ 'General.Buttons.Delete' | translate }}\"><i icon=remove></i></button></td><td ng-repeat=\"col in vm.dynamicColumns\" width=10%><div style=\"height: 20px; max-width: 300px\" class=hide-overflow-text tooltip={{item[col.StaticName]}}>{{item[col.StaticName].toString().substring(0,25)}}</div></td></tr><tr ng-if=!vm.items.length><td colspan=100 translate=General.Messages.NothingFound></td></tr></tbody></table></div></div></div>"),a.put("content-items/history-details.html",'<div><div class=modal-header><button class="btn btn-primary pull-right" type=button ng-click=vm.close()><span class="glyphicon glyphicon-remove"></span></button><h3 class=modal-title>History Details {{vm.ChangeId}} of {{vm.entityId}}</h3></div><div class=modal-body><h1>todo</h1><table class="table table-striped table-hover"><thead><tr><th>Field</th><th>Language</th><th>Value</th><th>SharedWith</th></tr></thead><tbody><tr ng-repeat="item in vm.items | orderBy:SysCreatedDate:reverse"><td>{{item.Field}}</td><td>{{item.Language}}</td><td>{{item.Value}}</td><td>{{item.SharedWith}}</td></tr><tr ng-if=!vm.items.length><td colspan=100>No History</td></tr></tbody></table><button class="btn btn-primary pull-right" type=button ng-click=vm.restore()><span class="glyphicon glyphicon-ok">todo restore</span></button></div></div>'),a.put("content-items/history.html",'<div><div class=modal-header><button class="btn btn-primary pull-right" type=button ng-click=vm.close()><span class="glyphicon glyphicon-remove"></span></button><h3 class=modal-title>{{ "Content.History.Title" | translate:\'{ id:vm.entityId }\' }}History of {{vm.entityId}}</h3></div><div class=modal-body><table class="table table-striped table-hover"><thead><tr><th translate=Content.History.Table.Id></th><th translate=Content.History.Table.When></th><th translate=Content.History.Table.User></th><th translate=Content.History.Table.Action></th></tr></thead><tbody><tr ng-repeat="item in vm.items | orderBy:SysCreatedDate:reverse"><td><span tooltip="ChangeId: {{item.ChangeId}}">{{item.VirtualVersion}}</span></td><td>{{item.SysCreatedDate.replace("T", " ")}}</td><td>{{item.User}}</td><td><button type=button class="btn btn-xs" ng-click=vm.details(item)><span class="glyphicon glyphicon-search"></span></button></td></tr><tr ng-if=!vm.items.length><td colspan=100 translate=General.Messages.NothingFound></td></tr></tbody></table></div></div>'),a.put("content-types/content-types-edit.html",'<div class=modal-header><button class="btn btn-default btn-square pull-right" type=button ng-click=vm.close()><i icon=remove></i></button><h3 class=modal-title translate=ContentTypeEdit.Title></h3></div><div class=modal-body>{{ "ContentTypeEdit.Name" | translate }}:<br><input ng-model="vm.item.Name"><br>{{ "ContentTypeEdit.Description" | translate }}:<br><input ng-model="vm.item.Description"><br>{{ "ContentTypeEdit.Scope" | translate }}:<br><input disabled ng-model="vm.item.Scope"></div><div class=modal-footer><button class="btn btn-primary btn-square pull-left" type=button ng-click=vm.ok()><i icon=ok></i></button></div>'),a.put("content-types/content-types-field-edit.html",'<div class=modal-header><button icon=remove class="btn pull-right" type=button ng-click=vm.close()></button><h3 class=modal-title translate=Fields.TitleEdit></h3></div><div class=modal-body><table class="table table-hover table-manage-eav"><thead><tr><th translate=Fields.Table.Name style="width: 200px"></th><th translate=Fields.Table.DataType style="width: 150px">Data Type</th><th></th></tr></thead><tbody><tr ng-repeat="item in vm.items"><td><input ng-model=item.StaticName ng-required="true"></td><td><select ng-model=item.Type ng-options="o as \'DataType.\' + o + \'.Choice\' | translate for o in vm.types | orderBy: \'toString()\' "></select></td><td></td></tr></tbody></table></div><div class=modal-footer><button icon=ok class="btn btn-default pull-left" type=button ng-click=vm.ok()></button></div>'),a.put("content-types/content-types-fields.html",'<div class=modal-header><button class="btn btn-default btn-square pull-right" type=button ng-click=vm.close()><i icon=remove></i></button><h3 class=modal-title translate=Fields.Title></h3></div><div class=modal-body><button icon=plus ng-click=vm.add() class="btn btn-primary btn-square"></button><table class="table table-hover table-manage-eav"><thead><tr><th translate=Fields.Table.Title class=mini-btn-1></th><th translate=Fields.Table.Name style="width: 200px"></th><th translate=Fields.Table.DataType style="width: 100px"></th><th translate=Fields.Table.Label style="width: 150px"></th><th translate=Fields.Table.Notes style="width: 250px"></th><th translate=Fields.Table.Sort class=mini-btn-2></th><th translate=Fields.Table.Action class=mini-btn-1></th></tr></thead><tbody><tr ng-repeat="item in vm.items | orderBy: \'SortOrder\'" class=clickable-row ng-click="vm.createOrEditMetadata(item, item.Type)"><td stop-event=click><button type=button class="btn btn-xs btn-square" ng-style="(item.IsTitle ? \'\' : \'color: transparent !important\')" ng-click=vm.setTitle(item)><i icon="{{item.IsTitle ? \'star\' : \'star-empty\'}}"></i></button></td><td class=clickable><span tooltip="{{ \'Id: \' + item.Id}}">{{item.StaticName}}</span></td><td class="text-nowrap clickable">{{item.Type}}</td><td class="text-nowrap clickable">{{item.Metadata.All.Name}}</td><td class="text-nowrap clickable">{{item.Metadata.All.Notes}}</td><td class=text-nowrap stop-event=click><button icon=arrow-up type=button class="btn btn-xs btn-square" ng-disabled=$first ng-click=vm.moveUp(item)></button> <button icon=arrow-down type=button class="btn btn-xs btn-square" ng-disabled=$last ng-click=vm.moveDown(item)></button></td><td stop-event=click><button icon=remove type=button class="btn btn-xs btn-square" ng-click=vm.tryToDelete(item)></button></td></tr><tr ng-if=!vm.items.length><td colspan=100 translate=General.Messages.NothingFound></td></tr></tbody></table></div>'),a.put("content-types/content-types.html",'<div ng-controller="List as vm" ng-click=vm.debug.autoEnableAsNeeded($event)><div class=modal-header><h3 class=modal-title translate=ContentTypes.Title></h3></div><div class=modal-body><button title="{{ \'General.Buttons.Add\' | translate }}" type=button class="btn btn-primary btn-square" ng-click=vm.edit()><i icon=plus></i></button> <span class=btn-group ng-if=vm.debug.on><button title="{{ \'General.Buttons.Refresh\' | translate }}" type=button class="btn btn-warning btn-square" ng-click=vm.refresh()><i icon=repeat></i></button> <button title="{{ \'ContentTypes.Buttons.ChangeScope\' | translate }}" type=button class="btn btn-warning btn-square" ng-click=vm.changeScope()><i icon=record></i></button> <button title="{{ \'General.Buttons.System\' | translate }}" type=button class="btn btn-warning btn-square" ng-click=vm.liveEval()><i icon=flash></i></button></span><table class="table table-hover" style="table-layout: fixed; width: 100%"><thead><tr><th translate=ContentTypes.TypesTable.Items class=col-id></th><th translate=ContentTypes.TypesTable.Name style="width: 50%"></th><th translate=ContentTypes.TypesTable.Description style="width: 50%"></th><th translate=ContentTypes.TypesTable.Fields class=mini-btn-2></th><th translate=ContentTypes.TypesTable.Actions class=mini-btn-3></th><th style="width: 40px"></th></tr></thead><tbody><tr ng-if=vm.items.isLoaded ng-repeat="item in vm.items | orderBy:\'Name\'" class=clickable-row ng-click=vm.editItems(item)><td style="text-align: center" class=clickable>{{item.Items}}</td><td class=clickable><span class="text-nowrap hide-overflow-text" style="max-width: 400px" tooltip={{item.Name}}>{{item.Name}}</span></td><td class=clickable><div class="text-nowrap hide-overflow-text" style="max-width: 500px" tooltip={{item.Description}}>{{item.Description}}</div></td><td stop-event=click><button type=button class="btn btn-xs" style="width: 60px" ng-click=vm.editFields(item)><span icon=list>&nbsp;{{item.Fields}}</span></button></td><td class=text-nowrap stop-event=click><button tooltip="{{ \'General.Buttons.Rename\' | translate }}" type=button class="btn btn-xs btn-square" ng-click=vm.edit(item)><i icon=info-sign></i></button> <button tooltip="{{ \'ContentTypes.Buttons.Export\' | translate }}" type=button class="btn btn-xs btn-square" ng-click=vm.openExport(item)><i icon=export></i></button> <button tooltip="{{ \'ContentTypes.Buttons.Import\' | translate }}" type=button class="btn btn-xs btn-square" ng-click=vm.openImport(item)><i icon=import></i></button> <button type=button class="btn btn-xs btn-square" ng-click=vm.permissions(item) ng-if=vm.isGuid(item.StaticName)><i icon=user></i></button></td><td stop-event=click><button icon=remove type=button class="btn btn-xs" ng-click=vm.tryToDelete(item)></button></td></tr><tr ng-if=!vm.items.length><td colspan=100>{{ \'General.Messages.Loading\' | translate }} / {{ \'General.Messages.NothingFound\' | translate }}</td></tr></tbody></table></div><div ng-if=vm.debug.on><h3>Notes / Debug / ToDo</h3><ol><li>get validators to work on all dialogs</li><li>this dialog doesn\'t refresh properly when I add/change stuff</li></ol></div></div>'),a.put("permissions/permissions.html",'<div class=modal-header><button class="btn btn-default btn-square pull-right" type=button ng-click=vm.close()><i icon=remove></i></button><h3 class=modal-title translate=Permissions.Title></h3></div><div class=modal-body><button type=button class="btn btn-primar btn-square" ng-click=vm.add()><i icon=plus></i></button> <button ng-if=vm.debug.on type=button class="btn btn-square" ng-click=vm.refresh()><i icon=repeat></i></button><table class="table table-striped table-hover table-manage-eav"><thead><tr><th translate=Permissions.Table.Id style="width: 60px"></th><th translate=Permissions.Table.Name style="width: 33%"></th><th translate=Permissions.Table.Condition style="width: 33%"></th><th translate=Permissions.Table.Grant style="width: 33%"></th><th translate=Permissions.Table.Actions style="width: 40px"></th></tr></thead><tbody><tr ng-repeat="item in vm.items | orderBy:\'Title\'" class=clickable-row ng-click=vm.edit(item)><td class=clickable>{{item.Id}}</td><td class=clickable>{{item.Title}}</td><td class=clickable>{{item.Condition}}</td><td class=clickable>{{item.Grant}}</td><td class=text-nowrap stop-event=click><button icon=remove type=button class="btn btn-xs btn-square" ng-click=vm.tryToDelete(item)></button></td></tr><tr ng-if=!vm.items.length><td colspan=100 translate=General.Messages.NothingFound></td></tr></tbody></table></div>'),a.put("pipelines/pipeline-designer.html",'<div class=ng-cloak><div ng-controller=PipelineDesignerController><div id=pipelineContainer><div ng-repeat="dataSource in pipelineData.DataSources" datasource guid={{dataSource.EntityGuid}} id=dataSource_{{dataSource.EntityGuid}} class=dataSource ng-attr-style="top: {{dataSource.VisualDesignerData.Top}}px; left: {{dataSource.VisualDesignerData.Left}}px"><div class=configure ng-click=configureDataSource(dataSource) title="Configure this DataSource" ng-if=!dataSource.ReadOnly><span class="glyphicon glyphicon-list-alt"></span></div><div class=name title="Click to edit the Name" ng-click=editName(dataSource)>{{dataSource.Name || \'(unnamed)\'}}</div><br><div class=description title="Click to edit the Description" ng-click=editDescription(dataSource)>{{dataSource.Description || \'(no description)\'}}</div><br><div class=typename ng-attr-title={{dataSource.PartAssemblyAndType}}>Type: {{dataSource.PartAssemblyAndType | typename: \'className\'}}</div><div class=ep title="Drag a new Out-Connection from here" ng-if=!dataSource.ReadOnly><span class="glyphicon glyphicon-plus-sign"></span></div><div class="delete glyphicon glyphicon-remove" title="Delete this DataSource" ng-click=remove($index) ng-if=!dataSource.ReadOnly></div></div></div><div class="actions panel panel-default"><div class=panel-heading><span class=pull-left>Actions</span> <a href=http://2sxc.org/help class="btn btn-info btn-xs pull-right" target=_blank><span class="glyphicon glyphicon-question-sign"></span> Help</a></div><div class=panel-body><button type=button class="btn btn-primary btn-block" ng-disabled=readOnly ng-click=savePipeline()><span class="glyphicon glyphicon-floppy-save"></span> Save</button><select class=form-control ng-model=addDataSourceType ng-disabled=readOnly ng-change=addDataSource() ng-options="d.ClassName for d in pipelineData.InstalledDataSources | filter: {allowNew: \'!false\'} | orderBy: \'ClassName\'"><option value="">-- Add DataSource --</option></select><button type=button class="btn btn-default btn-sm" title="Query the Data of this Pipeline" ng-click=queryPipeline()><span class="glyphicon glyphicon-play"></span> Query</button> <button type=button class="btn btn-default btn-sm" title="Clone this Pipeline with all DataSources and Configurations" ng-click=clonePipeline() ng-disabled=!PipelineEntityId><span class="glyphicon glyphicon-share-alt"></span> Clone</button> <button type=button class="btn btn-default btn-sm" ng-click=editPipelineEntity()><span class="glyphicon glyphicon-pencil"></span> Test Parameters</button> <button type=button class="btn btn-info btn-xs" ng-click=toggleEndpointOverlays()><span class="glyphicon glyphicon-info-sign"></span> {{showEndpointOverlays ? \'Hide\' : \'Show\' }} Overlays</button> <button type=button class="btn btn-info btn-xs" ng-click=repaint()><span class="glyphicon glyphicon-repeat"></span> Repaint</button> <button type=button class="btn btn-info btn-xs" ng-click=toogleDebug()><span class="glyphicon glyphicon-info-sign"></span> {{debug ? \'Hide\' : \'Show\'}} Debug Info</button></div></div><toaster-container></toaster-container><pre ng-if=debug>{{pipelineData | json}}</pre></div></div>'),
a.put("pipelines/pipelines.html",'<div class=modal-header><h3 class=modal-title translate=Pipeline.Manage.Title></h3></div><div class="modal-body ng-cloak"><div translate=Pipeline.Manage.Intro></div><div><button icon=plus type=button class="btn btn-default" ng-click=vm.add()></button> <button icon=repeat type=button class=btn ng-click=vm.refresh()></button> <button icon=flash type=button class=btn ng-click=vm.liveEval()></button><table class="table table-striped table-hover table-manage-eav"><thead><tr><th translate=Pipeline.Manage.Table.Id class=col-id></th><th translate=Pipeline.Manage.Table.Name></th><th translate=Pipeline.Manage.Table.Description></th><th translate=Pipeline.Manage.Table.Actions class=mini-btn-4></th></tr></thead><tbody><tr ng-repeat="pipeline in vm.pipelines | orderBy:\'Name\'"><td>{{pipeline.Id}}</td><td><a ng-click=vm.edit(pipeline)>{{pipeline.Name}}</a></td><td>{{pipeline.Description}}</td><td class="text-nowrap mini-btn-4"><button icon=edit title="{{ \'General.Buttons.Edit\' | translate }}" class="btn btn-xs btn-default" ng-click=vm.design(pipeline)></button> <button icon=user title="{{ \'General.Buttons.Permissions\' | translate }}" type=button class="btn btn-xs" ng-click=vm.permissions(pipeline)></button> <button icon=duplicate title="{{ \'General.Buttons.Copy\' | translate }}" type=button class="btn btn-xs" ng-click=vm.clone(pipeline)></button> <button icon=remove title="{{ \'General.Buttons.Delete\' | translate }}" type=button class="btn btn-xs" ng-click=vm.delete(pipeline)></button></td></tr><tr ng-if=!vm.pipelines.length><td colspan=100 translate=General.Messages.NothingFound></td></tr></tbody></table></div></div>'),a.put("pipelines/query-stats.html",'<div class=modal-header><button icon=remove class="btn pull-right" type=button ng-click=vm.close()></button><h3 class=modal-title translate=Pipeline.Stats.Title></h3></div><div class=modal-body><div translate=Pipeline.Stats.Intro></div><div><h3 translate=Pipeline.Stats.ParamTitle></h3><div translate=Pipeline.Stats.ExecutedIn translate-values="{ ms: vm.timeUsed, ticks: vm.ticksUsed }"></div><div><ul><li ng-repeat="param in vm.testParameters">{{param}}</li></ul></div></div><div><h3 translate=Pipeline.Stats.QueryTitle></h3><pre>{{vm.result | json}}</pre></div><div><h3 translate=Pipeline.Stats.SourcesAndStreamsTitle></h3><h4 translate=Pipeline.Stats.Sources.Title></h4><table><tr><th translate=Pipeline.Stats.Sources.Guid></th><th translate=Pipeline.Stats.Sources.Type></th><th translate=Pipeline.Stats.Sources.Config></th></tr><tr ng-repeat="s in vm.sources"><td tooltip={{s}}><pre>{{s.Guid.substring(0, 13)}}...</pre></td><td>{{s.Type}}</td><td tooltip={{s.Configuration}}><ol><li ng-repeat="(key, value) in s.Configuration"><b>{{key}}</b>=<em>{{value}}</em></li></ol></td></tr></table><h4 translate=Pipeline.Stats.Streams.Title></h4><table><tr><th translate=Pipeline.Stats.Streams.Source></th><th translate=Pipeline.Stats.Streams.Target></th><th translate=Pipeline.Stats.Streams.Items></th><th translate=Pipeline.Stats.Streams.Error></th></tr><tr ng-repeat="sr in vm.streams"><td><pre>{{sr.Source.substring(0, 13) + ":" + sr.SourceOut}}</pre></td><td><pre>{{sr.Target.substring(0, 13) + ":" + sr.TargetIn}}</pre></td><td><span>{{sr.Count}}</span></td><td><span>{{sr.Error}}</span></td></tr></table></div></div>')}]),function(){function a(a,b,c,d,e,f){var g=this,h=a(d,e);g.edit=function(a){b.openItemEditWithEntityId(a.Id,h.liveListReload)},g.add=function(){b.openMetadataNew(d,"entity",h.PermissionTargetGuid,h.ctName,h.liveListReload)},g.items=h.liveList(),g.refresh=h.liveListReload,g.tryToDelete=function(a){confirm("Delete '"+a.Title+"' ("+a.Id+") ?")&&h["delete"](a.Id)},g.close=function(){f.dismiss("cancel")}}angular.module("PermissionsApp",["EavServices","EavConfiguration","EavAdminUi"]).controller("PermissionList",a),a.$inject=["permissionsSvc","eavAdminDialogs","eavConfig","appId","targetGuid","$modalInstance"]}(),angular.module("PipelineDesigner",["PipelineDesigner.filters","ngResource","EavConfiguration","EavServices","eavTemplates","eavNgSvcs","EavAdminUi"]).directive("datasource",["$timeout",function(a){return{restrict:"A",link:function(b,c){a(function(){b.makeDataSource(b.dataSource,c)}),b.$last===!0&&a(function(){b.$emit("ngRepeatFinished")})}}}]),angular.module("PipelineDesigner.filters",[]).filter("typename",function(){return function(a,b){var c=a.match(/[^,\s]+/g);switch(b){case"classFullName":if(c)return c[0];break;case"className":if(c){var d=c[0].match(/[^\.]+/g);return d[d.length-1]}}return a}}),function(){angular.module("PipelineDesigner").controller("PipelineDesignerController",["appId","pipelineId","$scope","pipelineService","$location","$timeout","$filter","uiNotification","eavAdminDialogs","$log","eavConfig","$q",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";h.wait(),c.readOnly=!0,c.dataSourcesCount=0,c.dataSourceIdPrefix="dataSource_",c.debug=!1,c.PipelineEntityId=b,d.setAppId(a),c.findDataSourceOfElement=function(a){var b=a.attributes.guid.value,d=c.pipelineData.DataSources,e=g("filter")(d,{EntityGuid:b})[0];return e},d.getPipeline(c.PipelineEntityId).then(function(a){c.pipelineData=a,c.PipelineEntityId&&1!==c.pipelineData.DataSources.length?(c.readOnly=!a.Pipeline.AllowEdit,h.note("Ready",c.readOnly?"This pipeline is read only":"You can now design the Pipeline. \nNote that there are still a few UI bugs.\nVisit 2sxc.org/help for more.",!0)):(c.readOnly=!1,r())},function(a){h.error("Loading Pipeline failed",a)}),jsPlumb.ready(function(){c.jsPlumbInstance=jsPlumb.getInstance({Connector:["Bezier",{curviness:70}],HoverPaintStyle:{lineWidth:4,strokeStyle:"#216477",outlineWidth:2,outlineColor:"white"},PaintStyle:{lineWidth:4,strokeStyle:"#61B7CF",joinstyle:"round",outlineColor:"white",outlineWidth:2},Container:"pipelineContainer"}),c.jsPlumbInstance.bind("connectionDetached",function(a){if(a.targetId==c.dataSourceIdPrefix+"Out"){var b=angular.element(a.target),d=c.findDataSourceOfElement(b).dataSource.Definition().In,e=a.targetEndpoint.getOverlay("endpointLabel").label;-1==d.indexOf(e)&&f(function(){c.jsPlumbInstance.deleteEndpoint(a.targetEndpoint)})}}),c.jsPlumbInstance.bind("connection",function(a){if(c.connectionsInitialized)for(var b=0,d=function(b){var c=b.getOverlay("endpointLabel").getLabel();c===g&&a.targetEndpoint.id!==b.id&&angular.element(b.canvas).hasClass("targetEndpoint")&&(i=b)};;){b++;var e="Please name the Stream";b>1&&(e+=". Ensure the name is not used by any other Stream on this DataSource.");var f=a.targetEndpoint.getOverlay("endpointLabel"),g=prompt(e,f.getLabel());if(g){f.setLabel(g);var h=c.jsPlumbInstance.getEndpoints(a.target.id),i=null;if(angular.forEach(h,d),!i)break}}})});var m=function(a){return[["Label",{id:"endpointLabel",location:[.5,a?-.5:1.5],label:"Default",cssClass:a?"endpointSourceLabel":"endpointTargetLabel",events:{dblclick:function(a){if(!c.readOnly){var b=prompt("Rename Stream",a.label);b&&a.setLabel(b)}}}}]]},n={paintStyle:{fillStyle:"transparent",radius:10,lineWidth:0},cssClass:"sourceEndpoint",maxConnections:-1,isSource:!0,anchor:["Continuous",{faces:["top"]}],overlays:m(!0)},o={paintStyle:{fillStyle:"transparent",radius:10,lineWidth:0},cssClass:"targetEndpoint",maxConnections:1,isTarget:!0,anchor:["Continuous",{faces:["bottom"]}],overlays:m(!1),dropOptions:{hoverClass:"hover",activeClass:"active"}};c.makeDataSource=function(a,b){c.jsPlumbInstance.doWhileSuspended(function(){var d=a.Definition();if(null!==d){if(angular.forEach(d.Out,function(a){p(b,a,!1)}),angular.forEach(d.In,function(a){p(b,a,!0)}),d.In){var e=o;e.maxConnections=-1,c.jsPlumbInstance.makeTarget(b,e)}c.jsPlumbInstance.makeSource(b,n,{filter:".ep .glyphicon"})}c.readOnly||c.jsPlumbInstance.draggable(b,{grid:[20,20],drag:c.dataSourceDrag})}),c.dataSourcesCount++};var p=function(a,b,d){if(!a.length)return void j.error({message:"Element not found",selector:a.selector});console.log(a);var e=c.findDataSourceOfElement(a[0]),f=a[0].id+(d?"_in_":"_out_")+b,g={uuid:f,enabled:!e.ReadOnly||"Out"==e.EntityGuid},h=c.jsPlumbInstance.addEndpoint(a,d?o:n,g);h.getOverlay("endpointLabel").setLabel(b)};c.connectionsInitialized=!1,c.$on("ngRepeatFinished",function(){c.connectionsInitialized||(c.jsPlumbInstance.doWhileSuspended(function(){q(c.pipelineData.Pipeline.StreamWiring)}),c.repaint(),c.connectionsInitialized=!0)});var q=function(a){angular.forEach(a,function(a){var b=c.dataSourceIdPrefix+a.From,d=b+"_out_"+a.Out,e=c.dataSourceIdPrefix+a.To,f=e+"_in_"+a.In;c.jsPlumbInstance.getEndpoint(d)||p(jsPlumb.getSelector("#"+b),a.Out,!1),c.jsPlumbInstance.getEndpoint(f)||p(jsPlumb.getSelector("#"+e),a.In,!0);try{c.jsPlumbInstance.connect({uuids:[d,f]})}catch(g){j.error({message:"Connection failed",from:d,to:f})}})},r=function(){var a=k.pipelineDesigner.defaultPipeline.dataSources;angular.forEach(a,function(a){c.addDataSource(a.partAssemblyAndType,a.visualDesignerData,!1,a.entityGuid)});var b=c.$on("ngRepeatFinished",function(){c.connectionsInitialized=!1,q(k.pipelineDesigner.defaultPipeline.streamWiring),c.connectionsInitialized=!0,b()})};c.addDataSource=function(a,b,e,f){a||(a=c.addDataSourceType.PartAssemblyAndType,c.addDataSourceType=null),b||(b={Top:100,Left:100});var h={VisualDesignerData:b,Name:g("typename")(a,"className"),Description:"",PartAssemblyAndType:a,EntityGuid:f||"unsaved"+(c.dataSourcesCount+1)};h=angular.extend(h,d.getNewDataSource(c.pipelineData,h)),c.pipelineData.DataSources.push(h),e!==!1&&c.savePipeline()},c.remove=function(a){var b=c.pipelineData.DataSources[a];if(confirm('Delete DataSource "'+(b.Name||"(unnamed)")+'"?')){var d=c.dataSourceIdPrefix+b.EntityGuid;c.jsPlumbInstance.selectEndpoints({element:d}).remove(),c.pipelineData.DataSources.splice(a,1)}},c.editName=function(a){if(!a.ReadOnly){var b=prompt("Rename DataSource",a.Name);void 0!==b&&b.trim()&&(a.Name=b)}},c.editDescription=function(a){if(!a.ReadOnly){var b=prompt("Edit Description",a.Description);void 0!==b&&b.trim()&&(a.Description=b)}},c.dataSourceDrag=function(){var a=$(this),b=a.offset(),d=c.findDataSourceOfElement(a).dataSource;c.$apply(function(){d.VisualDesignerData.Top=Math.round(b.top),d.VisualDesignerData.Left=Math.round(b.left)})},c.configureDataSource=function(a){return a.ReadOnly?void 0:s(a)?void d.editDataSourcePart(a):void c.savePipeline()};var s=function(a){return-1===a.EntityGuid.indexOf("unsaved")};c.showEndpointOverlays=!0,c.toggleEndpointOverlays=function(){c.showEndpointOverlays=!c.showEndpointOverlays;var a=c.jsPlumbInstance.selectEndpoints();c.showEndpointOverlays?a.showOverlays():a.hideOverlays()},c.editPipelineEntity=function(){c.savePipeline().then(function(){i.openEditItems([{EntityId:c.PipelineEntityId}],function(){d.getPipeline(c.PipelineEntityId).then(u)})})};var t=function(){var a=[];angular.forEach(c.jsPlumbInstance.getAllConnections(),function(b){a.push({From:b.sourceId.substr(c.dataSourceIdPrefix.length),Out:b.endpoints[0].getOverlay("endpointLabel").label,To:b.targetId.substr(c.dataSourceIdPrefix.length),In:b.endpoints[1].getOverlay("endpointLabel").label})}),c.pipelineData.Pipeline.StreamWiring=a;var b=[];c.jsPlumbInstance.selectEndpoints({target:c.dataSourceIdPrefix+"Out"}).each(function(a){b.push(a.getOverlay("endpointLabel").label)}),c.pipelineData.Pipeline.StreamsOut=b.join(",")};c.savePipeline=function(a){h.wait("Saving..."),c.readOnly=!0,t();var b=l.defer();return"undefined"==typeof a&&(a=u),d.savePipeline(c.pipelineData.Pipeline,c.pipelineData.DataSources).then(a,function(a){h.error("Save Pipeline failed",a),c.readOnly=!1,b.reject()}).then(function(){b.resolve()}),b.promise};var u=function(a){c.pipelineData.Pipeline=a.Pipeline,c.PipelineEntityId=a.Pipeline.EntityId,e.search("PipelineId",a.Pipeline.EntityId),c.readOnly=!a.Pipeline.AllowEdit,c.pipelineData.DataSources=a.DataSources,d.postProcessDataSources(c.pipelineData),h.success("Saved","Pipeline "+a.Pipeline.EntityId+" saved and loaded",!0),c.jsPlumbInstance.reset(),c.connectionsInitialized=!1};c.repaint=function(){c.jsPlumbInstance.repaintEverything()},c.toogleDebug=function(){c.debug=!c.debug},c.queryPipeline=function(){var a=function(){h.wait("Running Query ..."),d.queryPipeline(c.PipelineEntityId).then(function(a){h.clear();var d=i.CreateResolve({testParams:c.pipelineData.Pipeline.TestParameters,result:a});i.OpenModal("pipelines/query-stats.html","QueryStats as vm","lg",d),f(function(){b(a)}),j.debug(a)},function(a){h.error("Query failed",a)})},b=function(a){angular.forEach(a.Streams,function(a){var b=c.dataSourceIdPrefix+a.Source,d=c.dataSourceIdPrefix+a.Target;"00000000-0000-0000-0000-000000000000"===a.Target&&(d=c.dataSourceIdPrefix+"Out");var e=b+"_out_"+a.SourceOut,f=d+"_in_"+a.TargetIn,g=c.jsPlumbInstance.getEndpoint(e),h=!1;g&&angular.forEach(g.connections,function(b){return b.endpoints[1].getUuid()===f?(b.setLabel({label:a.Count.toString(),cssClass:"streamEntitiesCount"}),void(h=!0)):void 0}),h||j.error("Stream not found",a,g)})};c.savePipeline().then(a)},c.clonePipeline=function(){if(confirm("Clone Pipeline "+c.PipelineEntityId+"?")){var a=function(){return d.clonePipeline(c.PipelineEntityId)},b=function(a){return d.getPipeline(a.EntityId)};c.savePipeline(null).then(a).then(b).then(u)}}}])}(),angular.module("PipelineManagement",["EavServices","EavConfiguration","eavNgSvcs","EavAdminUi"]).controller("PipelineManagement",["$modalInstance","appId","pipelineService","eavAdminDialogs","eavConfig",function($modalInstance,appId,pipelineService,eavAdminDialogs,eavConfig){var vm=this;vm.appId=appId,pipelineService.setAppId(appId),pipelineService.initContentTypes(),vm.getPipelineUrl=pipelineService.getPipelineUrl,vm.refresh=function(){vm.pipelines=pipelineService.getPipelines(appId)},vm.refresh(),vm["delete"]=function(a){confirm('Delete Pipeline "'+a.Name+'" ('+a.Id+")?")&&pipelineService.deletePipeline(a.Id).then(function(){vm.refresh()},function(a){alert(a)})},vm.clone=function(a){pipelineService.clonePipeline(a.Id).then(function(){vm.refresh()},function(a){alert(a)})},vm.permissions=function(a){return eavAdminDialogs.openPermissionsForGuid(appId,a.Guid)},vm.add=function(){var a=[{ContentTypeName:"DataPipeline",Prefill:{TestParameters:eavConfig.pipelineDesigner.testParameters}}];eavAdminDialogs.openEditItems(a,vm.refresh)},vm.edit=function(a){eavAdminDialogs.openItemEditWithEntityId(a.Id,vm.refresh)},vm.design=function(a){return eavAdminDialogs.editPipeline(vm.appId,a.Id,vm.refresh)},vm.liveEval=function admin(){var inp=prompt("This is for very advanced operations. Only use this if you know what you're doing. \n\n Enter admin commands:");inp&&eval(inp)},vm.close=function(){$modalInstance.dismiss("cancel")}}]),function(){angular.module("PipelineDesigner").controller("QueryStats",["testParams","result","$modalInstance",function(a,b,c){var d=this,e=b;d.testParameters=a.split("\n"),d.timeUsed=e.QueryTimer.Milliseconds,d.ticksUsed=e.QueryTimer.Ticks,d.result=e.Query,d.sources=e.Sources,d.streams=e.Streams,d.connections="todo",d.close=function(){c.dismiss("cancel")}}])}(),angular.module("EavServices",["ng","EavConfiguration","pascalprecht.translate","ngResource","toaster"]),angular.module("EavServices").factory("contentItemsSvc",["$http","entitiesSvc","metadataSvc","svcCreator",function(a,b,c,d){return function(c,e){var f={};return f.contentType=e,f.appId=c,f=angular.extend(f,d.implementLiveList(function(){return a.get("eav/entities/GetAllOfTypeForAdmin",{params:{appId:f.appId,contentType:f.contentType}})})),f["delete"]=function(a){return b["delete"](f.contentType,a).then(f.liveListReload)},f.getColumns=function(){return a.get("eav/contenttype/getfields/",{params:{appid:f.appId,staticName:f.contentType}})},f}}]),angular.module("EavServices").factory("contentTypeFieldSvc",["$http","eavConfig","svcCreator",function(a,b,c){return function(b,d){var e={};return e.appId=b,e.contentType=d,e.typeListRetrieve=function(){return a.get("eav/contenttype/datatypes/",{params:{appid:e.appId}})},e.getFields=function(){return a.get("eav/contenttype/getfields",{params:{appid:e.appId,staticName:e.contentType.StaticName}})},e=angular.extend(e,c.implementLiveList(e.getFields)),e.types=c.implementLiveList(e.typeListRetrieve),e.moveUp=function(b){return a.get("eav/contenttype/reorder",{params:{appid:e.appId,contentTypeId:e.contentType.Id,attributeId:b.Id,direction:"up"}}).then(e.liveListReload)},e.moveDown=function(b){return a.get("eav/contenttype/reorder",{params:{appid:e.appId,contentTypeId:e.contentType.Id,attributeId:b.Id,direction:"down"}}).then(e.liveListReload)},e["delete"]=function(b){return a["delete"]("eav/contenttype/delete",{params:{appid:e.appId,contentTypeId:e.contentType.Id,attributeId:b.Id}}).then(e.liveListReload)},e.addMany=function(b,c){return a.get("eav/contenttype/addfield/",{params:b[c]}).then(function(){b.length==++c?e.liveListReload():e.addMany(b,c)})},e.add=function(b){return a.get("eav/contenttype/addfield/",{params:b}).then(e.liveListReload)},e.newItemCount=0,e.newItem=function(){return{AppId:e.appId,ContentTypeId:e.contentType.Id,Id:0,Type:"String",StaticName:"",IsTitle:0===e.liveList().length,SortOrder:e.liveList().length+e.newItemCount++}},e["delete"]=function(b){if(b.IsTitle)throw"Can't delete Title";return a["delete"]("eav/contenttype/deletefield",{params:{appid:e.appId,contentTypeId:e.contentType.Id,attributeId:b.Id}}).then(e.liveListReload)},e.setTitle=function(b){return a.get("eav/contenttype/setTitle",{params:{appid:e.appId,contentTypeId:e.contentType.Id,attributeId:b.Id}}).then(e.liveListReload)},e}}]),angular.module("EavServices").factory("contentTypeSvc",["$http","eavConfig","svcCreator",function(a,b,c){return function(d,e){var f={};return f.scope=e||b.contentType.defaultScope,f.appId=d,f.retrieveContentTypes=function(){return a.get("eav/contenttype/get/",{params:{appid:f.appId,scope:f.scope}})},f=angular.extend(f,c.implementLiveList(f.retrieveContentTypes)),f.getDetails=function(b){return a.get("eav/contenttype/GetSingle",{params:{appid:f.appId,contentTypeStaticName:b}})},f.newItem=function(){return{StaticName:"",Name:"",Description:"",Scope:b.contentType.defaultScope}},f.save=function(b){return a.post("eav/contenttype/save/",b,{params:{appid:f.appId}}).then(f.liveListReload)},f["delete"]=function(b){return a["delete"]("eav/contenttype/delete",{params:{appid:f.appId,staticName:b.StaticName}}).then(f.liveListReload)},f.setScope=function(a){f.scope=a,f.liveListReload()},f}}]),angular.module("EavServices").factory("debugState",function(){var a={on:!1};return a.autoEnableAsNeeded=function(b){b=window.event||b;var c=b.ctrlKey;c&&(a.on=!a.on)},a}),angular.module("EavServices").factory("dragClass",function(){return document.addEventListener("dragover",function(){this===document&&document.body.classList.add("eav-dragging")}),document.addEventListener("dragleave",function(){this===document&&document.body.classList.remove("eav-dragging")}),{}}),angular.module("EavAdminUi",["ng","ui.bootstrap","EavServices","eavTemplates","PermissionsApp","ContentItemsApp","PipelineManagement","ContentImportApp","ContentExportApp","HistoryApp","eavEditEntity"]).factory("eavAdminDialogs",["$modal","eavConfig","contentTypeSvc","$window",function(a,b,c,d){var e={};return e.openContentItems=function(a,b,c,d){var f=e.CreateResolve({appId:a,contentType:b,contentTypeId:c});return e.OpenModal("content-items/content-items.html","ContentItemsList as vm","xlg",f,d)},e.openContentImport=function(a,b,c){var d=e.CreateResolve({appId:a,contentType:b});return e.OpenModal("content-import-export/content-import.html","ContentImport as vm","lg",d,c)},e.openContentExport=function(a,b,c){var d=e.CreateResolve({appId:a,contentType:b});return e.OpenModal("content-import-export/content-export.html","ContentExport as vm","lg",d,c)},e.openContentTypeEdit=function(a,b){var c=e.CreateResolve({item:a});return e.OpenModal("content-types/content-types-edit.html","Edit as vm","sm",c,b)},e.openContentTypeFields=function(a,b){var c=e.CreateResolve({contentType:a});return e.OpenModal("content-types/content-types-fields.html","FieldList as vm","lg",c,b)},e.openItemNew=function(a,b){return e.openEditItems([{ContentTypeName:a}],b)},e.openItemEditWithEntityId=function(a,b){return e.openEditItems([{EntityId:a}],b)},e.openEditItems=function(a,b){var c=e.CreateResolve({items:a});return e.OpenModal("form/main-form.html","EditEntityWrapperCtrl as vm","lg",c,b)},e.openItemHistory=function(a,b){return e.OpenModal("content-items/history.html","History as vm","lg",e.CreateResolve({entityId:a}),b)},e.openMetadataNew=function(a,c,d,f,g){var h={};switch(c){case"entity":h.Key=d,h.KeyType="guid",h.TargetType=b.metadataOfEntity;break;case"attribute":h.Key=d,h.KeyType="number",h.TargetType=b.metadataOfAttribute;break;default:throw"targetType unknown, only accepts entity or attribute for now"}var i=[{ContentTypeName:f,Metadata:h}];e.openEditItems(i,g)},e.openPermissionsForGuid=function(a,b,c){var d=e.CreateResolve({appId:a,targetGuid:b});return e.OpenModal("permissions/permissions.html","PermissionList as vm","lg",d,c)},e.editPipeline=function(a,c,e){var f=b.adminUrls.pipelineDesigner(a,c);d.open(f)},e._attachCallbacks=function(a,b){return"undefined"!=typeof b?("function"==typeof b&&(b={close:b}),a.result.then(b.success||b.close,b.error||b.close,b.notify||b.close)):void 0},e.OpenModal=function(b,c,d,f,g){var h=c.indexOf(" as "),i=h>0?c.substring(h+4):null;h>0&&(c=c.substring(0,h));var j=a.open({animation:!0,templateUrl:b,controller:c,controllerAs:i,size:d,resolve:f});return e._attachCallbacks(j,g)},e.CreateResolve=function(){var a={},b=arguments[0];for(var c in b)b.hasOwnProperty(c)&&(a[c]=e._create1Resolve(b[c]));return a},e._create1Resolve=function(a){return function(){return a}},e}]),angular.module("eavNgSvcs",["ng"]).config(["$locationProvider",function(a){a.html5Mode({enabled:!0,requireBase:!1})}]),angular.module("EavServices").factory("historySvc",["$http","svcCreator",function(a,b){return function(c,d){var e={appId:c,entityId:d};return e=angular.extend(e,b.implementLiveList(function(){return a.get("eav/entities/history",{params:{appId:e.appId,entityId:e.entityId}}).then(function(a){for(var b=a.data,c=0;c<b.length;c++)b[c].VirtualVersion=b.length-c;return a})})),e.getVersionDetails=function(b){return a.get("eav/entities/historydetails",{params:{appId:e.appId,entityId:e.entityId,changeId:b}})},e}}]),function(){angular.module("EavServices").config(["$translateProvider","languages","$translatePartialLoaderProvider",function(a,b,c){a.preferredLanguage(b.currentLanguage.split("-")[0]).useSanitizeValueStrategy("escapeParameters").fallbackLanguage(b.defaultLanguage.split("-")[0]).useLoader("$translatePartialLoader",{urlTemplate:b.i18nRoot+"{part}-{lang}.js"}).useLoaderCache(!0),c.addPart("admin").addPart("edit")}]).run(["$rootScope","$translate",function(a,b){a.$on("$translatePartialLoaderStructureChanged",function(){b.refresh()})}])}(),function(){function a(a){return window.$2sxc?window.$2sxc.urlParams.get(a):b(a)}function b(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)","i"),c=b.exec(location.search);if(null===c){var d=new RegExp("[#&]"+a+"=([^&#]*)","i");c=d.exec(location.hash)}if(null===c){var e=window.location.pathname.match(new RegExp("/"+a+"/([^/]+)","i"));null!==e&&e.length>1&&(c=e.reverse()[0])}else c=c[1];return null===c?"":decodeURIComponent(c.replace(/\+/g," "))}angular.module("InitParametersFromUrl",[]).factory("appId",function(){return a("appId")}).factory("zoneId",function(){return a("zoneId")}).factory("entityId",function(){return a("entityid")}).factory("contentTypeName",function(){return a("contenttypename")}).factory("pipelineId",function(){return a("pipelineId")}).factory("dialog",function(){return a("dialog")}).factory("$modalInstance",function(){return null})}(),angular.module("EavServices").factory("metadataSvc",["$http","appId",function(a,b){var c={};return c.getMetadata=function(c,d,e){return a.get("eav/metadata/getassignedentities",{params:{appId:b,assignmentObjectTypeId:c,keyType:"guid",key:d,contentType:e}})},c}]),angular.module("EavServices").factory("permissionsSvc",["$http","eavConfig","entitiesSvc","metadataSvc","svcCreator","contentTypeSvc",function(a,b,c,d,e,f){var g=b;return function(a,b){var h={PermissionTargetGuid:b,ctName:"PermissionConfiguration",ctId:0,EntityAssignment:g.metadataOfEntity,ctSvc:f(a)};return h=angular.extend(h,e.implementLiveList(function(){return d.getMetadata(h.EntityAssignment,h.PermissionTargetGuid,h.ctName).then(h.updateLiveAll)})),h.ctSvc.getDetails(h.ctName).then(function(a){h.ctId=a.data.AttributeSetId}),h["delete"]=function(a){return c["delete"](h.ctName,a).then(h.liveListReload)},h}}]),angular.module("EavServices").factory("pipelineService",["$resource","$q","$filter","eavConfig","$http","contentTypeSvc","metadataSvc","eavAdminDialogs",function(a,b,c,d,e,f,g,h){"use strict";var i={};i.pipelineResource=a("eav/PipelineDesigner/:action"),i.entitiesResource=a("eav/Entities/:action"),i.dataPipelineAttributeSetId=0,i.appId=0,i.getDataSourceDefinitionProperty=function(a,b){var d=c("filter")(a.InstalledDataSources,function(a){return a.PartAssemblyAndType==b.PartAssemblyAndType})[0];if(!d)throw"DataSource Definition not found: "+b.PartAssemblyAndType;return d};var j=function(a){a.DataSources.push({Name:d.pipelineDesigner.outDataSource.name,Description:d.pipelineDesigner.outDataSource.description,EntityGuid:"Out",PartAssemblyAndType:d.pipelineDesigner.outDataSource.className,VisualDesignerData:d.pipelineDesigner.outDataSource.visualDesignerData,ReadOnly:!0}),angular.forEach(a.DataSources,function(b){b.Definition=function(){return i.getDataSourceDefinitionProperty(a,b)},b.ReadOnly=b.ReadOnly||!a.Pipeline.AllowEdit})};return angular.extend(i,{getPipeline:function(a){var c=b.defer(),e=i.pipelineResource.get({action:"GetPipeline",id:a,appId:i.appId}),f=i.pipelineResource.query({action:"GetInstalledDataSources"});return b.all([e.$promise,f.$promise]).then(function(b){var e=JSON.parse(angular.toJson(b[0]));e.InstalledDataSources=JSON.parse(angular.toJson(b[1])),a||(e.Pipeline={AllowEdit:"True"}),e.InstalledDataSources.push({PartAssemblyAndType:d.pipelineDesigner.outDataSource.className,ClassName:d.pipelineDesigner.outDataSource.className,In:d.pipelineDesigner.outDataSource["in"],Out:null,allowNew:!1}),j(e),c.resolve(e)},function(a){c.reject(a)}),c.promise},postProcessDataSources:function(a){c("filter")(a.DataSources,function(a){return"Out"==a.EntityGuid})[0]||j(a)},getNewDataSource:function(a,b){return{Definition:function(){return i.getDataSourceDefinitionProperty(a,b)}}},savePipeline:function(a,c){if(!i.appId)return b.reject("appId must be set to save a Pipeline");var d=[];return angular.forEach(c,function(a){var b=angular.copy(a);delete b.ReadOnly,d.push(b)}),i.pipelineResource.save({action:"SavePipeline",appId:i.appId,Id:a.EntityId},{pipeline:a,dataSources:d}).$promise},clonePipeline:function(a){return i.pipelineResource.get({action:"ClonePipeline",appId:i.appId,Id:a}).$promise},editDataSourcePart:function(a){var b=c("typename")(a.PartAssemblyAndType,"classFullName"),d="|Config "+b,e=4,f=a.EntityGuid;g.getMetadata(e,f,d).then(function(a){var b=a.data;if(b.length)h.openItemEditWithEntityId(b[0].Id);else{var c=[{ContentTypeName:d,Metadata:{TargetType:e,KeyType:"guid",Key:f}}];h.openEditItems(c)}})}}),angular.extend(i,{queryPipeline:function(a){return i.pipelineResource.get({action:"QueryPipeline",appId:i.appId,id:a}).$promise},setAppId:function(a){i.appId=a},initContentTypes:function(){return f(i.appId).getDetails("DataPipeline").then(function(a){i.dataPipelineAttributeSetId=a.data.AttributeSetId})},getPipelines:function(){return i.entitiesResource.query({action:"GetEntities",appId:i.appId,contentType:"DataPipeline"})},deletePipeline:function(a){return i.pipelineResource.get({action:"DeletePipeline",appId:i.appId,id:a}).$promise}}),i}]),angular.module("EavServices").factory("svcCreator",function(){var a={};return a.implementLiveList=function(a){var b={};return b.liveListCache=[],b.liveListCache.isLoaded=!1,b.liveList=function(){return 0===b.liveListCache.length&&b.liveListReload(),b.liveListCache},b._liveListUpdateWithResult=function(a){b.liveListCache.length=0;for(var c=0;c<a.data.length;c++)b.liveListCache.push(a.data[c]);return b.liveListCache.isLoaded=!0,a},b.liveListSourceRead=a,b.liveListReload=function(){return b.liveListSourceRead().then(b._liveListUpdateWithResult)},b.liveListReset=function(){b.liveListCache=[]},b},a}),angular.module("EavServices").factory("uiNotification",["toaster",function(a){"use strict";var b=function(b,c,d,e){angular.element(document).ready(function(){a.clear(),a.pop(b,c,d,e?null:0)})};return{clear:function(){a.clear()},error:function(a,c){var d;c&&c.data&&c.data.Message?(d=c.data.Message,c.data.ExceptionMessage&&(d+="\n"+c.data.ExceptionMessage)):d=c,b("error",a,d)},note:function(a,c,d){b("note",a,c,d)},success:function(a,c,d){b("success",a,c,d)},wait:function(a){b("note",a?a:"Please wait ..","This shouldn't take long",!1)}}}]);
//# sourceMappingURL=eav-admin.min.js.map