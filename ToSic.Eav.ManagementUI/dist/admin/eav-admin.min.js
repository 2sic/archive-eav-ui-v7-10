/*! tosic.eav 2015-09-23 07:35 */

!function(){angular.module("ContentFormlyTypes",["naif.base64","formly","formlyBootstrap","ui.bootstrap"])}(),function(){angular.module("ContentFormlyTypes").config(["formlyConfigProvider",function(a){var b=a;b.setType({name:"file",template:"<span class='btn btn-default btn-file'><span class='glyphicon glyphicon-open'></span><input type='file' ng-model='model[options.key]' base-sixty-four-input /></span><br /><span ng-if='model[options.key]'>{{model[options.key].filename}}</span>",wrapper:["bootstrapLabel","bootstrapHasError"]}),b.setType({name:"hidden",template:"<input style='display:none' ng-model='model[options.key]' />",wrapper:["bootstrapLabel","bootstrapHasError"]})}])}(),function(){angular.module("ContentImportApp",["EavAdminUi","EavDirectives","EavServices","ContentFormlyTypes"])}(),function(){function a(a,b,c,d,e,f,g){var h=g("translate"),i=this;i.debug={},i.formValues={},i.formFields=[{key:"AppId",type:"hidden",defaultValue:a},{key:"ContentType",type:"hidden",defaultValue:b},{key:"File",type:"file",templateOptions:{required:!0},expressionProperties:{"templateOptions.label":"'Content.Import.Fields.File.Label' | translate"}},{key:"FileReferences",type:"radio",expressionProperties:{"templateOptions.label":"'Content.Import.Fields.FileReferences.Label' | translate","templateOptions.options":function(){return[{name:h("Content.Import.Fields.FileReferences.Options.Keep"),value:"Keep"},{name:h("Content.Import.Fields.FileReferences.Options.Resolve"),value:"Resolve"}]}},defaultValue:"Keep"},{key:"ClearEntities",type:"radio",expressionProperties:{"templateOptions.label":"'Content.Import.Fields.ClearEntities.Label' | translate","templateOptions.options":function(){return[{name:h("Content.Import.Fields.ClearEntities.Options.None"),value:"None"},{name:h("Content.Import.Fields.ClearEntities.Options.All"),value:"All"}]}},defaultValue:"None"}],i.currentStep="1",i.evaluateContent=function(){c.evaluateContent(i.formValues).then(function(a){i.debug=a})},i.importContent=function(){},i.close=function(){f.dismiss("cancel")}}angular.module("ContentImportApp").controller("ContentImport",a),a.$inject=["appId","contentType","contentImportService","eavAdminDialogs","eavConfig","$modalInstance","$filter"]}(),function(){function a(a){function b(b){return a.post("eav/ContentImport/EvaluateContent",{AppId:b.AppId,ContentType:b.ContentType,ContentBase64:b.File.base64})}function c(a){}var d={evaluateContent:b,importContent:c};return d}angular.module("ContentImportApp").factory("contentImportService",a),a.$inject=["$http"]}(),function(){function a(a,b,c,d,e){var f=this;f.mode=a,f.entityId=b,f.contentType=c,f.TestMessage="Test message the controller is binding correctly...",f.history=function(){return d.openItemHistory(f.entityId)},f.close=function(){e.dismiss("cancel")}}angular.module("ContentEditApp",["EavServices","EavAdminUi"]).controller("EditContentItem",a),a.$inject=["mode","entityId","contentType","eavAdminDialogs","$modalInstance"]}(),function(){function a(a,b,c,d,e,f){var g=this,h=a(c,d);g.add=function(){e.openItemNew(d,h.liveListReload)},g.edit=function(a){e.openItemEditWithEntityId(a.Id,h.liveListReload)},g.items=h.liveList(),g.dynamicColumns=[],h.getColumns().then(function(a){for(var b=a.data,c=0;c<b.length;c++)b[c].IsTitle||g.dynamicColumns.push(b[c])}),g.tryToDelete=function(a){confirm("Delete 'title-unknown-yet' ("+a.Id+") ?")&&h["delete"](a.Id)},g.close=function(){f.dismiss("cancel")}}angular.module("ContentItemsApp",["EavConfiguration","EavAdminUi","EavServices"]).controller("ContentItemsList",a),a.$inject=["contentItemsSvc","eavConfig","appId","contentType","eavAdminDialogs","$modalInstance"]}(),function(){function a(a,b,c,d,e){var f=this,g=c(a,b);f.entityId=b,f.items=g.liveList(),f.close=function(){d.dismiss("cancel")},f.details=function(a){e.open({animation:!0,templateUrl:"content-items/history-details.html",controller:"HistoryDetails",controllerAs:"vm",resolve:{changeId:function(){return a.ChangeId},dataSvc:function(){return g}}})}}function b(a,b,c){var d=this;alert("not implemented yet");var e=b;e.getVersionDetails(a).then(function(a){alert(a.data),d.items=a.data}),d.close=function(){c.dismiss("cancel")}}angular.module("HistoryApp",["EavServices","EavConfiguration","eavTemplates"]).controller("History",a).controller("HistoryDetails",b),a.$inject=["appId","entityId","historySvc","$modalInstance","$modal"],b.$inject=["changeId","dataSvc","$modalInstance"]}(),function(){angular.module("ContentTypesApp",["EavServices","EavAdminUi","EavDirectives"]).constant("license",{createdBy:"2sic internet solutions",license:"MIT"})}(),function(){function contentTypeListController(contentTypeSvc,eavAdminDialogs,appId,$translate){var vm=this,svc=contentTypeSvc(appId);vm.items=svc.liveList(),vm.refresh=svc.liveListReload,vm.tryToDelete=function(a){$translate("General.Questions.Delete",{target:"'"+a.Name+"' ("+a.Id+")"}).then(function(b){confirm(b)&&svc["delete"](a)})},vm.edit=function(a){void 0===a&&(a=svc.newItem()),eavAdminDialogs.openContentTypeEdit(a,vm.refresh)},vm.editFields=function(a){eavAdminDialogs.openContentTypeFields(a,vm.refresh)},vm.editItems=function(a){eavAdminDialogs.openContentItems(svc.appId,a.StaticName,a.Id,vm.refresh)},vm.liveEval=function admin(){$translate("General.Questions.SystemInput").then(function(msg){var inp=prompt(msg);inp&&eval(inp)})},vm.isGuid=function(a){var b=new RegExp(/[a-f0-9]{8}(?:-[a-f0-9]{4}){3}-[a-f0-9]{12}/i);return b.test(a)},vm.permissions=function(a){return eavAdminDialogs.openPermissionsForGuid(svc.appId,a.StaticName,vm.refresh)},vm.openExport=function(){return eavAdminDialogs.openContentExport(svc.appId)},vm.openImport=function(a){return eavAdminDialogs.openContentImport(svc.appId,a.StaticName,vm.refresh)}}function contentTypeEditController(a,b,c,d){var e=this,f=c(a);e.item=b,e.ok=function(){f.save(b).then(function(){d.close(e.item)})},e.close=function(){d.dismiss("cancel")}}angular.module("ContentTypesApp").controller("List",contentTypeListController).controller("Edit",contentTypeEditController),contentTypeListController.$inject=["contentTypeSvc","eavAdminDialogs","appId","$translate"],contentTypeEditController.$inject=["appId","item","contentTypeSvc","$modalInstance"]}(),function(){function a(a,b,c,d,e,f,g){var h=this,i=b(a,c);h.close=function(){d.dismiss("cancel")},h.items=i.liveList(),h.add=function(){e.open({animation:!0,templateUrl:"content-types/content-types-field-edit.html",controller:"FieldsAdd",controllerAs:"vm",resolve:{svc:function(){return i}}})},h.moveUp=i.moveUp,h.moveDown=i.moveDown,h.setTitle=i.setTitle,h.tryToDelete=function(a){return a.IsTitle?g(["General.Messages.CantDelete","General.Terms.Title"],{target:"{0}"}).then(function(a){alert(a["General.Messages.CantDelete"].replace("{0}",a["General.Terms.Title"]))}):void g("General.Questions.Delete",{target:"'"+a.StaticName+"' ("+a.Id+")"}).then(function(b){confirm(b)&&i["delete"](a)})},h.createOrEditMetadata=function(b,c){var d=void 0!==b.Metadata[c];d?f.openItemEditWithEntityId(b.Metadata[c].Id,i.liveListReload):f.openMetadataNew(a,"attribute",b.Id,"@"+c,i.liveListReload)}}function b(a,b){var c=this,d=a.newItem;c.items=[d(),d(),d(),d(),d(),d(),d(),d(),d(),d()],c.item=a.newItem(),c.types=a.types.liveList(),c.ok=function(){for(var d=c.items,e=[],f=0;f<d.length;f++)d[f].StaticName&&e.push(d[f]);a.addMany(e,0),b.close()},c.close=function(){b.dismiss("cancel")}}angular.module("ContentTypesApp").controller("FieldList",a).controller("FieldsAdd",b),a.$inject=["appId","contentTypeFieldSvc","contentType","$modalInstance","$modal","eavAdminDialogs","$translate"],b.$inject=["svc","$modalInstance"]}(),angular.module("EavDirectives",[]).directive("icon",function(){return{restrict:"A",replace:!1,transclude:!1,link:function(a,b,c){var d=c.icon;b.addClass("glyphicon glyphicon-"+d)}}}),angular.module("eavTemplates",[]).run(["$templateCache",function(a){"use strict";a.put("content-import-export/content-export.html",""),a.put("content-import-export/content-import.html",'<div class=modal-header><button class="btn pull-right" type=button icon=remove ng-click=vm.close()></button><h3 class=modal-title translate=Content.Import.Title translate-values="{currentStep: vm.currentStep}"></h3></div><div class=modal-body><div ng-switch=vm.currentStep><div ng-switch-when=1><p translate=Content.Import.Help></p><formly-form form=vm.form model=vm.formValues fields=vm.formFields><p class=text-warning translate=Content.Import.Messages.BackupContentBefore></p><button type=button class="btn btn-primary" ng-click="vm.evaluateContent(); vm.currentStep = 2" ng-disabled=!vm.form.$valid translate=Content.Import.Commands.Preview></button> <button type=button class="btn btn-default" ng-click=vm.close() translate=Content.Import.Commands.Close></button></formly-form></div><div ng-switch-when=2><p>TODO: Show the evaluation of the content</p><button type=button class="btn btn-primary" ng-click="vm.importContent(); vm.currentStep = 3" translate=Content.Import.Commands.Import></button> <button type=button class="btn btn-default" ng-click="vm.currentStep = 1" translate=Content.Import.Commands.Back></button> <button type=button class="btn btn-default" ng-click=vm.close() translate=Content.Import.Commands.Close></button></div><div ng-switch-when=3><p>TODO: Show the result of import</p><button type=button class="btn btn-primary" ng-click="vm.currentStep = 1" translate=Content.Import.Commands.Back></button> <button type=button class="btn btn-default" ng-click=vm.close() translate=Content.Import.Commands.Close></button></div></div><hr><pre>{{vm.debug | json}}</pre></div>'),a.put("content-items/content-edit.html",'<div class=modal-header><button type=button class="btn btn-default" ng-click=vm.history()><span class="glyphicon glyphicon-time">history / todo</span></button><h3 class=modal-title>Edit / New Content</h3></div><div class=modal-body>this is where the edit appears. Would edit entity {{vm.entityId}} or add a {{vm.contentType}} - depending on the mode: {{vm.mode}}<h3>Use cases</h3><ol><li>Edit an existing entity with ID</li><li>Create a new entity of a certaint content-type, just save and done (like from a "new" button without content-group)</li><li>Create a new entity of a certain type and assign it to a metadata thing (guid, int, string)</li><li>Create a new entity and put it into a content-group at the right place</li><li>Edit content-group: item + presentation</li><li>Edit multiple IDs/or new/mix: Edit multiple items with IDs</li></ol>init of 1 edit - entity-id in storage - new-type + optional: assignment-id + assignment-type - array of the above --- [{id 17}, {type: "person"}, {type: person, asstype: 4, target: 0205}] - content-group</div>'),a.put("content-items/content-items.html","<div class=modal-header><button icon=remove class=\"btn pull-right\" type=button ng-click=vm.close()></button><h3 class=modal-title translate=Content.Manage.Title></h3></div><div class=modal-body><button icon=plus type=button class=\"btn btn-default\" ng-click=vm.add()></button> <button icon=repeat type=button class=btn ng-click=vm.refresh()></button><div style=\"overflow: auto\"><table class=\"table table-striped table-hover\"><thead><tr><th translate=Content.Manage.Table.Id></th><th translate=Content.Manage.Table.Published></th><th translate=Content.Manage.Table.Title style=\"width: 200px\"></th><th translate=Content.Manage.Table.Actions></th><th ng-repeat=\"col in vm.dynamicColumns\">{{col.StaticName}}</th></tr></thead><tbody><tr ng-repeat=\"item in vm.items\"><td class=text-nowrap><span>{{item.Id}}</span></td><td class=text-nowrap><span class=glyphicon ng-class=\"{'glyphicon-ok-circle': item.IsPublished, 'glyphicon-ban-circle' : !item.IsPublished && !item.Published, 'glyphicon-record' : !item.IsPublished && item.Published }\" tooltip=\"{{ 'Content.Publish.' + (item.IsPublished ? 'PnV': item.Published ? 'DoP' : 'D') | translate }}\"></span> <span icon=\"{{ item.Draft ? 'paperclip' : item.Published ? 'export' : '' }}\" tooltip=\"{{ (item.Draft ? 'Content.Publish.HD' :'') | translate:'{ id: item.Draft.RepositoryId}' }}{{ (item.Published ? 'Content.Publish.HP' :'') | translate:'{ id: item.Published.RepositoryId}' }}\"></span></td><td><div style=\"height: 20px; width: 200px; position: relative; overflow: hidden; white-space: nowrap; text-overflow: ellipsis\" tooltip={{item.Title}}><a ng-click=vm.edit(item)>{{item.Title}}{{ (!item.Title ? 'Content.Manage.NoTitle':'') | translate }}</a></div></td><td><button icon=remove type=button class=\"btn btn-xs\" ng-click=vm.tryToDelete(item)></button></td><td ng-repeat=\"col in vm.dynamicColumns\"><div style=\"height: 20px; max-width: 100px; position: relative; overflow: hidden; text-overflow: ellipsis\" tooltip={{item[col.StaticName]}}>{{item[col.StaticName].toString().substring(0,25)}}</div></td></tr><tr ng-if=!vm.items.length><td colspan=100 translate=General.Messages.NothingFound></td></tr></tbody></table></div></div>"),a.put("content-items/history-details.html",'<div><div class=modal-header><button class="btn btn-primary pull-right" type=button ng-click=vm.close()><span class="glyphicon glyphicon-remove"></span></button><h3 class=modal-title>History Details {{vm.ChangeId}} of {{vm.entityId}}</h3></div><div class=modal-body><h1>todo</h1><table class="table table-striped table-hover"><thead><tr><th>Field</th><th>Language</th><th>Value</th><th>SharedWith</th></tr></thead><tbody><tr ng-repeat="item in vm.items | orderBy:SysCreatedDate:reverse"><td>{{item.Field}}</td><td>{{item.Language}}</td><td>{{item.Value}}</td><td>{{item.SharedWith}}</td></tr><tr ng-if=!vm.items.length><td colspan=100>No History</td></tr></tbody></table><button class="btn btn-primary pull-right" type=button ng-click=vm.restore()><span class="glyphicon glyphicon-ok">todo restore</span></button></div></div>'),a.put("content-items/history.html",'<div><div class=modal-header><button class="btn btn-primary pull-right" type=button ng-click=vm.close()><span class="glyphicon glyphicon-remove"></span></button><h3 class=modal-title>{{ "Content.History.Title" | translate:\'{ id:vm.entityId }\' }}History of {{vm.entityId}}</h3></div><div class=modal-body><table class="table table-striped table-hover"><thead><tr><th translate=Content.History.Table.Id></th><th translate=Content.History.Table.When></th><th translate=Content.History.Table.User></th><th translate=Content.History.Table.Action></th></tr></thead><tbody><tr ng-repeat="item in vm.items | orderBy:SysCreatedDate:reverse"><td><span tooltip="ChangeId: {{item.ChangeId}}">{{item.VirtualVersion}}</span></td><td>{{item.SysCreatedDate.replace("T", " ")}}</td><td>{{item.User}}</td><td><button type=button class="btn btn-xs" ng-click=vm.details(item)><span class="glyphicon glyphicon-search"></span></button></td></tr><tr ng-if=!vm.items.length><td colspan=100 translate=General.Messages.NothingFound></td></tr></tbody></table></div></div>'),a.put("content-types/content-types-edit.html",'<div class=modal-header><button icon=remove class="btn pull-right" type=button ng-click=vm.close()></button><h3 class=modal-title translate=ContentTypeEdit.Title></h3></div><div class=modal-body>{{ "ContentTypeEdit.Name" | translate }}:<br><input ng-model="vm.item.Name"><br>{{ "ContentTypeEdit.Description" | translate }}:<br><input ng-model="vm.item.Description"><br>{{ "ContentTypeEdit.Scope" | translate }}:<br><input disabled ng-model="vm.item.Scope"></div><div class=modal-footer><button icon=ok class="btn btn-primary" type=button ng-click=vm.ok()></button></div>'),a.put("content-types/content-types-field-edit.html",'<div class=modal-header><button icon=remove class="btn pull-right" type=button ng-click=vm.close()></button><h3 class=modal-title translate=Fields.TitleEdit></h3></div><div class=modal-body><table class="table table-hover"><thead><tr><th translate=Fields.Table.Name></th><th translate=Fields.Table.DataType>Data Type</th></tr></thead><tbody><tr ng-repeat="item in vm.items"><td><input ng-model=item.StaticName ng-required="true"></td><td><select ng-model=item.Type ng-options="o for o in vm.types track by o"></select></td></tr><tr ng-if=!vm.items.length><td colspan=100 translate=General.Messages.NothingFound></td></tr></tbody></table></div><div class=modal-footer><button icon=ok class="btn btn-primary" type=button ng-click=vm.ok()></button></div>'),a.put("content-types/content-types-fields.html",'<div class=modal-header><button icon=remove class="btn pull-right" type=button ng-click=vm.close()></button><h3 class=modal-title translate=Fields.Title></h3></div><div class=modal-body><button icon=plus ng-click=vm.add() class="btn btn-default"></button><table class="table table-hover"><thead><tr><th translate=Fields.Table.Title></th><th translate=Fields.Table.Name></th><th translate=Fields.Table.Edit></th><th translate=Fields.Table.Label></th><th translate=Fields.Table.Notes></th><th translate=Fields.Table.Sort></th><th translate=Fields.Table.Action></th></tr></thead><tbody><tr ng-repeat="item in vm.items | orderBy: \'SortOrder\'"><td><button icon="{{item.IsTitle ? \'star\' : \'star-empty\'}}" type=button class="btn btn-xs" ng-style="(item.IsTitle ? \'\' : \'color: transparent !important\')" ng-click=vm.setTitle(item)></button></td><td><span tooltip="{{ \'Id: \' + item.Id}}">{{item.StaticName}}</span></td><td class=text-nowrap><button icon=pencil type=button class="btn btn-xs" ng-click="vm.createOrEditMetadata(item, \'All\')" translate=Fields.General></button> <button icon=pencil type=button class="btn btn-xs" ng-click="vm.createOrEditMetadata(item, item.Type)">{{item.Type}}</button></td><td>{{item.Metadata[\'@All\'].Attributes.Name.DefaultValue.TypedContents}}</td><td>{{item.Metadata[\'@All\'].Attributes.Notes.DefaultValue.TypedContents}}</td><td class=text-nowrap><button icon=arrow-up type=button class="btn btn-xs" ng-disabled=$first ng-click=vm.moveUp(item)></button> <button icon=arrow-down type=button class="btn btn-xs" ng-disabled=$last ng-click=vm.moveDown(item)></button></td><td><button icon=remove type=button class="btn btn-xs" ng-click=vm.tryToDelete(item)></button></td></tr><tr ng-if=!vm.items.length><td colspan=100 translate=General.Messages.NothingFound></td></tr></tbody></table></div>'),a.put("content-types/content-types.html",'<div class=modal-header><h3 class=modal-title translate=ContentTypes.Title></h3></div><div class=modal-body><div ng-controller="List as vm" class=ng-cloak><button icon=plus title="{{ \'General.Buttons.Add\' | translate }}" type=button class="btn btn-default" ng-click=vm.edit()></button> <button icon=repeat title="{{ \'General.Buttons.Refresh\' | translate }}" type=button class=btn ng-click=vm.refresh()></button> <button icon=flash title="{{ \'General.Buttons.System\' | translate }}" type=button class=btn ng-click=vm.liveEval()></button><table class="table table-hover"><thead><tr><th translate=ContentTypes.TypesTable.Name></th><th translate=ContentTypes.TypesTable.Description></th><th translate=ContentTypes.TypesTable.Fields></th><th translate=ContentTypes.TypesTable.Items></th><th translate=ContentTypes.TypesTable.Actions></th><th></th></tr></thead><tbody><tr ng-if=vm.items.isLoaded ng-repeat="item in vm.items | orderBy:\'Name\'"><td><a ng-click=vm.edit(item) target=_self>{{item.Name}}</a></td><td>{{item.Description}}</td><td><button type=button class="btn btn-xs btn-default" ng-click=vm.editFields(item)><span icon=cog>&nbsp;{{item.Fields}}</span></button></td><td><button type=button class="btn btn-xs btn-default" ng-click=vm.editItems(item)><span icon=list>&nbsp;{{item.Items}}</span></button></td><td class=text-nowrap><button icon=export tooltip="{{ \'ContentTypes.Buttons.Export\' | translate }}" type=button class="btn btn-xs" ng-click=vm.openExport(item)></button> <button icon=import tooltip="{{ \'ContentTypes.Buttons.Import\' | translate }}" type=button class="btn btn-xs" ng-click=vm.openImport(item)></button> <button icon=user type=button class="btn btn-xs" ng-click=vm.permissions(item) ng-if=vm.isGuid(item.StaticName)></button></td><td><button icon=remove type=button class="btn btn-xs" ng-click=vm.tryToDelete(item)></button></td></tr><tr ng-if=!vm.items.length><td colspan=100>{{ \'General.Messages.Loading\' | translate }} / {{ \'General.Messages.NothingFound\' | translate }}</td></tr></tbody></table></div></div><div><h3>todo</h3><ol><li>get validators to work on all dialogs</li><li>this dialog doesn\'t refresh properly when I add/change stuff</li></ol></div>'),a.put("permissions/permissions.html",'<div class=modal-header><button icon=remove class="btn pull-right" type=button ng-click=vm.close()></button><h3 class=modal-title translate=Permissions.Title></h3></div><div class=modal-body><button icon=plus type=button class="btn btn-default" ng-click=vm.add()></button> <button icon=repeat type=button class=btn ng-click=vm.refresh()></button><table class="table table-striped table-hover"><thead><tr><th translate=Permissions.Table.Name></th><th translate=Permissions.Table.Id></th><th translate=Permissions.Table.Condition></th><th translate=Permissions.Table.Grant></th><th translate=Permissions.Table.Actions></th></tr></thead><tbody><tr ng-repeat="item in vm.items | orderBy:\'Title\'"><td><a ng-click=vm.edit(item)>{{item.Title}}</a></td><td>{{item.Id}}</td><td>{{item.Condition}}</td><td>{{item.Grant}}</td><td><button icon=remove type=button class="btn btn-xs" ng-click=vm.tryToDelete(item)></button></td></tr><tr ng-if=!vm.items.length><td colspan=100 translate=General.Messages.NothingFound></td></tr></tbody></table></div>'),a.put("pipelines/pipeline-designer.html",'<div class=ng-cloak><div ng-controller=PipelineDesignerController><div id=pipelineContainer><div ng-repeat="dataSource in pipelineData.DataSources" datasource id=dataSource_{{dataSource.EntityGuid}} class=dataSource ng-attr-style="top: {{dataSource.VisualDesignerData.Top}}px; left: {{dataSource.VisualDesignerData.Left}}px"><div class=configure ng-click=configureDataSource(dataSource) title="Configure this DataSource" ng-if=!dataSource.ReadOnly><span class="glyphicon glyphicon-list-alt"></span></div><div class=name title="Click to edit the Name" ng-click=editName(dataSource)>{{dataSource.Name || \'(unnamed)\'}}</div><br><div class=description title="Click to edit the Description" ng-click=editDescription(dataSource)>{{dataSource.Description || \'(no description)\'}}</div><br><div class=typename ng-attr-title={{dataSource.PartAssemblyAndType}}>Type: {{dataSource.PartAssemblyAndType | typename: \'className\'}}</div><div class=ep title="Drag a new Out-Connection from here" ng-if=!dataSource.ReadOnly><span class="glyphicon glyphicon-plus-sign"></span></div><div class="delete glyphicon glyphicon-remove" title="Delete this DataSource" ng-click=remove($index) ng-if=!dataSource.ReadOnly></div></div></div><div class="actions panel panel-default"><div class=panel-heading><span class=pull-left>Actions</span> <a href=http://2sxc.org/help class="btn btn-info btn-xs pull-right" target=_blank><span class="glyphicon glyphicon-question-sign"></span> Help</a></div><div class=panel-body><button type=button class="btn btn-primary btn-block" ng-disabled=readOnly ng-click=savePipeline()><span class="glyphicon glyphicon-floppy-save"></span> Save</button><select class=form-control ng-model=addDataSourceType ng-disabled=readOnly ng-change=addDataSource() ng-options="d.ClassName for d in pipelineData.InstalledDataSources | filter: {allowNew: \'!false\'} | orderBy: \'ClassName\'"><option value="">-- Add DataSource --</option></select><button type=button class="btn btn-default btn-sm" title="Query the Data of this Pipeline" ng-click=queryPipeline()><span class="glyphicon glyphicon-play"></span> Query</button> <button type=button class="btn btn-default btn-sm" title="Clone this Pipeline with all DataSources and Configurations" ng-click=clonePipeline() ng-disabled=!PipelineEntityId><span class="glyphicon glyphicon-share-alt"></span> Clone</button> <button type=button class="btn btn-default btn-sm" ng-click=editPipelineEntity()><span class="glyphicon glyphicon-pencil"></span> Test Parameters</button> <button type=button class="btn btn-info btn-xs" ng-click=toggleEndpointOverlays()><span class="glyphicon glyphicon-info-sign"></span> {{showEndpointOverlays ? \'Hide\' : \'Show\' }} Overlays</button> <button type=button class="btn btn-info btn-xs" ng-click=repaint()><span class="glyphicon glyphicon-repeat"></span> Repaint</button> <button type=button class="btn btn-info btn-xs" ng-click=toogleDebug()><span class="glyphicon glyphicon-info-sign"></span> {{debug ? \'Hide\' : \'Show\'}} Debug Info</button></div></div><toaster-container></toaster-container><pre ng-if=debug>{{pipelineData | json}}</pre></div></div>'),a.put("pipelines/pipelines.html",'<div class=modal-header><button icon=remove class="btn pull-right" type=button ng-click=vm.close()></button><h3 class=modal-title translate=Pipeline.Manage.Title></h3></div><div class="modal-body ng-cloak"><div translate=Pipeline.Manage.Intro></div><div><button icon=plus type=button class="btn btn-default" ng-click=vm.add()></button> <button icon=repeat type=button class=btn ng-click=vm.refresh()></button> <button icon=flash type=button class=btn ng-click=vm.liveEval()></button><table class="table table-striped table-hover"><thead><tr><th translate=Pipeline.Manage.Table.Id></th><th translate=Pipeline.Manage.Table.Name></th><th translate=Pipeline.Manage.Table.Description></th><th translate=Pipeline.Manage.Table.Actions></th></tr></thead><tbody><tr ng-repeat="pipeline in vm.pipelines | orderBy:\'Name\'"><td>{{pipeline.Id}}</td><td><a ng-click=vm.edit(pipeline)>{{pipeline.Name}}</a></td><td>{{pipeline.Description}}</td><td class=text-nowrap><button icon=edit title="{{ \'General.Buttons.Edit\' | translate }}" class="btn btn-xs btn-default" ng-click=vm.design(pipeline)></button> <button icon=user title="{{ \'General.Buttons.Permissions\' | translate }}" type=button class="btn btn-xs" ng-click=vm.permissions(pipeline)></button> <button icon=duplicate title="{{ \'General.Buttons.Copy\' | translate }}" type=button class="btn btn-xs" ng-click=vm.clone(pipeline)></button> <button icon=remove title="{{ \'General.Buttons.Delete\' | translate }}" type=button class="btn btn-xs" ng-click=vm.delete(pipeline)></button></td></tr><tr ng-if=!vm.pipelines.length><td colspan=100 translate=General.Messages.NothingFound></td></tr></tbody></table></div></div>')}]),function(){function a(a,b,c,d,e,f){var g=this,h=a(d,e);g.edit=function(a){b.openItemEditWithEntityId(a.Id,h.liveListReload)},g.add=function(){b.openMetadataNew(d,"entity",h.PermissionTargetGuid,h.ctName,h.liveListReload)},g.items=h.liveList(),g.refresh=h.liveListReload,g.tryToDelete=function(a){confirm("Delete '"+a.Title+"' ("+a.Id+") ?")&&h["delete"](a.Id)},g.close=function(){f.dismiss("cancel")}}angular.module("PermissionsApp",["EavServices","EavConfiguration","EavAdminUi"]).controller("PermissionList",a),a.$inject=["permissionsSvc","eavAdminDialogs","eavConfig","appId","targetGuid","$modalInstance"]}(),angular.module("PipelineDesigner",["PipelineDesigner.filters","ngResource","toaster","EavConfiguration","eavDialogService","EavServices","eavTemplates"]).directive("datasource",["$timeout",function(a){return{restrict:"A",link:function(b,c){a(function(){b.makeDataSource(b.dataSource,c)}),b.$last===!0&&a(function(){b.$emit("ngRepeatFinished")})}}}]).factory("uiNotification",["toaster",function(a){"use strict";var b=function(b,c,d,e){angular.element(document).ready(function(){a.clear(),a.pop(b,c,d,e?null:0)})};return{clear:function(){a.clear()},error:function(a,c){var d;c&&c.data&&c.data.Message?(d=c.data.Message,c.data.ExceptionMessage&&(d+="\n"+c.data.ExceptionMessage)):d=c,b("error",a,d)},note:function(a,c,d){b("note",a,c,d)},success:function(a,c,d){b("success",a,c,d)},wait:function(a){b("note",a?a:"Please wait ..","This shouldn't take long",!1)}}}]),angular.module("PipelineDesigner.filters",[]).filter("typename",function(){return function(a,b){var c=a.match(/[^,\s]+/g);switch(b){case"classFullName":if(c)return c[0];break;case"className":if(c){var d=c[0].match(/[^\.]+/g);return d[d.length-1]}}return a}}),angular.module("PipelineDesigner").controller("PipelineDesignerController",["appId","pipelineId","$scope","pipelineService","$location","$timeout","$filter","uiNotification","eavDialogService","$log","eavConfig","$q",function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";h.wait(),c.readOnly=!0,c.dataSourcesCount=0,c.dataSourceIdPrefix="dataSource_",c.debug=!1,c.PipelineEntityId=b,d.setAppId(a),d.getPipeline(c.PipelineEntityId).then(function(a){c.pipelineData=a,c.readOnly=!a.Pipeline.AllowEdit,h.note("Ready",c.readOnly?"This pipeline is read only":"You can now design the Pipeline. \nNote that there are still a few UI bugs.\nVisit 2sxc.org/help for more.",!0),c.PipelineEntityId&&1!==c.pipelineData.DataSources.length||r()},function(a){h.error("Loading Pipeline failed",a)}),jsPlumb.ready(function(){c.jsPlumbInstance=jsPlumb.getInstance({Connector:["Bezier",{curviness:70}],HoverPaintStyle:{lineWidth:4,strokeStyle:"#216477",outlineWidth:2,outlineColor:"white"},PaintStyle:{lineWidth:4,strokeStyle:"#61B7CF",joinstyle:"round",outlineColor:"white",outlineWidth:2},Container:"pipelineContainer"}),c.jsPlumbInstance.bind("connectionDetached",function(a){if(a.targetId==c.dataSourceIdPrefix+"Out"){var b=angular.element(a.target).scope().dataSource.Definition().In,d=a.targetEndpoint.getOverlay("endpointLabel").label;-1==b.indexOf(d)&&f(function(){c.jsPlumbInstance.deleteEndpoint(a.targetEndpoint)})}}),c.jsPlumbInstance.bind("connection",function(a){if(c.connectionsInitialized)for(var b=0,d=function(b){var c=b.getOverlay("endpointLabel").getLabel();c===g&&a.targetEndpoint.id!==b.id&&angular.element(b.canvas).hasClass("targetEndpoint")&&(i=b)};;){b++;var e="Please name the Stream";b>1&&(e+=". Ensure the name is not used by any other Stream on this DataSource.");var f=a.targetEndpoint.getOverlay("endpointLabel"),g=prompt(e,f.getLabel());if(g){f.setLabel(g);var h=c.jsPlumbInstance.getEndpoints(a.target.id),i=null;if(angular.forEach(h,d),!i)break}}})});var m=function(a){return[["Label",{id:"endpointLabel",location:[.5,a?-.5:1.5],label:"Default",cssClass:a?"endpointSourceLabel":"endpointTargetLabel",events:{dblclick:function(a){if(!c.readOnly){var b=prompt("Rename Stream",a.label);b&&a.setLabel(b)}}}}]]},n={paintStyle:{fillStyle:"transparent",radius:10,lineWidth:0},cssClass:"sourceEndpoint",maxConnections:-1,isSource:!0,anchor:["Continuous",{faces:["top"]}],overlays:m(!0)},o={paintStyle:{fillStyle:"transparent",radius:10,lineWidth:0},cssClass:"targetEndpoint",maxConnections:1,isTarget:!0,anchor:["Continuous",{faces:["bottom"]}],overlays:m(!1),dropOptions:{hoverClass:"hover",activeClass:"active"}};c.makeDataSource=function(a,b){c.jsPlumbInstance.doWhileSuspended(function(){var d=a.Definition();if(null!==d){if(angular.forEach(d.Out,function(a){p(b,a,!1)}),angular.forEach(d.In,function(a){p(b,a,!0)}),d.In){var e=o;e.maxConnections=-1,c.jsPlumbInstance.makeTarget(b,e)}c.jsPlumbInstance.makeSource(b,n,{filter:".ep .glyphicon"})}c.readOnly||c.jsPlumbInstance.draggable(b,{grid:[20,20],drag:c.dataSourceDrag})}),c.dataSourcesCount++};var p=function(a,b,d){if(!a.length)return void j.error({message:"Element not found",selector:a.selector});var e=a.scope().dataSource,f=a.attr("id")+(d?"_in_":"_out_")+b,g={uuid:f,enabled:!e.ReadOnly||"Out"==e.EntityGuid},h=c.jsPlumbInstance.addEndpoint(a,d?o:n,g);h.getOverlay("endpointLabel").setLabel(b)};c.connectionsInitialized=!1,c.$on("ngRepeatFinished",function(){c.connectionsInitialized||(c.jsPlumbInstance.doWhileSuspended(function(){q(c.pipelineData.Pipeline.StreamWiring)}),c.repaint(),c.connectionsInitialized=!0)});var q=function(a){angular.forEach(a,function(a){var b=c.dataSourceIdPrefix+a.From,d=b+"_out_"+a.Out,e=c.dataSourceIdPrefix+a.To,f=e+"_in_"+a.In;c.jsPlumbInstance.getEndpoint(d)||p(jsPlumb.getSelector("#"+b),a.Out,!1),c.jsPlumbInstance.getEndpoint(f)||p(jsPlumb.getSelector("#"+e),a.In,!0);
try{c.jsPlumbInstance.connect({uuids:[d,f]})}catch(g){j.error({message:"Connection failed",from:d,to:f})}})},r=function(){angular.forEach(k.pipelineDesigner.defaultPipeline.dataSources,function(a){c.addDataSource(a.partAssemblyAndType,a.visualDesignerData,!1,a.entityGuid)});var a=c.$on("ngRepeatFinished",function(){c.connectionsInitialized=!1,q(k.pipelineDesigner.defaultPipeline.streamWiring),c.connectionsInitialized=!0,a()})};c.addDataSource=function(a,b,e,f){a||(a=c.addDataSourceType.PartAssemblyAndType,c.addDataSourceType=null),b||(b={Top:100,Left:100});var h={VisualDesignerData:b,Name:g("typename")(a,"className"),Description:"",PartAssemblyAndType:a,EntityGuid:f||"unsaved"+(c.dataSourcesCount+1)};h=angular.extend(h,d.getNewDataSource(c.pipelineData,h)),c.pipelineData.DataSources.push(h),e!==!1&&c.savePipeline()},c.remove=function(a){var b=c.pipelineData.DataSources[a];if(confirm('Delete DataSource "'+(b.Name||"(unnamed)")+'"?')){var d=c.dataSourceIdPrefix+b.EntityGuid;c.jsPlumbInstance.selectEndpoints({element:d}).remove(),c.pipelineData.DataSources.splice(a,1)}},c.editName=function(a){if(!a.ReadOnly){var b=prompt("Rename DataSource",a.Name);void 0!==b&&b.trim()&&(a.Name=b)}},c.editDescription=function(a){if(!a.ReadOnly){var b=prompt("Edit Description",a.Description);void 0!==b&&b.trim()&&(a.Description=b)}},c.dataSourceDrag=function(){var a=$(this),b=a.offset(),d=a.scope().dataSource;c.$apply(function(){d.VisualDesignerData.Top=Math.round(b.top),d.VisualDesignerData.Left=Math.round(b.left)})},c.configureDataSource=function(a){if(!a.ReadOnly){if(!s(a))return void c.savePipeline();h.wait(),d.getDataSourceConfigurationUrl(a).then(function(b){h.clear(),i.open({url:b,title:"Configure DataSource "+a.Name})},function(a){h.error("Open Configuration UI failed",a)})}};var s=function(a){return-1===a.EntityGuid.indexOf("unsaved")};c.showEndpointOverlays=!0,c.toggleEndpointOverlays=function(){c.showEndpointOverlays=!c.showEndpointOverlays;var a=c.jsPlumbInstance.selectEndpoints();c.showEndpointOverlays?a.showOverlays():a.hideOverlays()},c.editPipelineEntity=function(){c.savePipeline().then(function(){i.open({url:d.getPipelineUrl("edit",c.PipelineEntityId),title:"Edit Test Values",onClose:function(){d.getPipeline(c.PipelineEntityId).then(u)}})})};var t=function(){var a=[];angular.forEach(c.jsPlumbInstance.getAllConnections(),function(b){a.push({From:b.sourceId.substr(c.dataSourceIdPrefix.length),Out:b.endpoints[0].getOverlay("endpointLabel").label,To:b.targetId.substr(c.dataSourceIdPrefix.length),In:b.endpoints[1].getOverlay("endpointLabel").label})}),c.pipelineData.Pipeline.StreamWiring=a;var b=[];c.jsPlumbInstance.selectEndpoints({target:c.dataSourceIdPrefix+"Out"}).each(function(a){b.push(a.getOverlay("endpointLabel").label)}),c.pipelineData.Pipeline.StreamsOut=b.join(",")};c.savePipeline=function(a){h.wait("Saving..."),c.readOnly=!0,t();var b=l.defer();return"undefined"==typeof a&&(a=u),d.savePipeline(c.pipelineData.Pipeline,c.pipelineData.DataSources).then(a,function(a){h.error("Save Pipeline failed",a),c.readOnly=!1,b.reject()}).then(function(){b.resolve()}),b.promise};var u=function(a){c.pipelineData.Pipeline=a.Pipeline,c.PipelineEntityId=a.Pipeline.EntityId,e.search("PipelineId",a.Pipeline.EntityId),c.readOnly=!a.Pipeline.AllowEdit,c.pipelineData.DataSources=a.DataSources,d.postProcessDataSources(c.pipelineData),h.success("Saved","Pipeline "+a.Pipeline.EntityId+" saved and loaded",!0),c.jsPlumbInstance.reset(),c.connectionsInitialized=!1};c.repaint=function(){c.jsPlumbInstance.repaintEverything()},c.toogleDebug=function(){c.debug=!c.debug},c.queryPipeline=function(){var a=function(){h.wait("Running Query ..."),d.queryPipeline(c.PipelineEntityId).then(function(a){h.clear(),i.open({title:"Query result",content:"<div><div>The Full result was logged to the Browser Console. Further down you'll find more debug-infos. </div><h3>Parameters used</h3><div>"+(c.pipelineData.Pipeline.TestParameters.length>5?c.pipelineData.Pipeline.TestParameters.replace("\n","<br>"):"no test params specified")+"</div> <h3>Query result - executed in "+a.QueryTimer.Milliseconds+"ms ("+a.QueryTimer.Ticks+'tx)</h3><div> <pre id="pipelineQueryResult">'+g("json")(a.Query)+"</pre>"+b(a)+"</div></div"}),f(function(){e(a)}),j.debug(a)},function(a){h.error("Query failed",a)})},b=function(a){var b="<h3>Sources</h3><table><tr><th>Guid</th><th>Type</th><th>Config</th></tr>",c=a.Sources;for(var d in c)if("$"!=d[0]){b+="<tr><td><pre>"+d.substring(0,13)+"...</pre></td><td>"+c[d].Type+"</td><td>";var e=c[d].Configuration;for(var f in e)"$"!=f[0]&&(b+="<b>"+f+"</b>="+e[f]+"</br>");b+="</td></tr>"}b+="</table>",b+="<h3>Streams</h3><table><tr><th>Source</th><th>Target</th><th>Items</th><th>Err</th></tr>",c=a.Streams;for(var g in c)"$"!=g[0]&&(b+="<tr><td><pre>"+c[g].Source.substring(0,13)+":"+c[g].SourceOut+"</pre></td><td><pre>"+c[g].Target.substring(0,13)+":"+c[g].TargetIn+"</pre></td><td>"+c[g].Count+"</td><td>"+c[g].Error+"</td></tr>");return b+="</table>"},e=function(a){angular.forEach(a.Streams,function(a){var b=c.dataSourceIdPrefix+a.Source,d=c.dataSourceIdPrefix+a.Target;"00000000-0000-0000-0000-000000000000"===a.Target&&(d=c.dataSourceIdPrefix+"Out");var e=b+"_out_"+a.SourceOut,f=d+"_in_"+a.TargetIn,g=c.jsPlumbInstance.getEndpoint(e),h=!1;g&&angular.forEach(g.connections,function(b){return b.endpoints[1].getUuid()===f?(b.setLabel({label:a.Count.toString(),cssClass:"streamEntitiesCount"}),void(h=!0)):void 0}),h||j.error("Stream not found",a,g)})};c.savePipeline().then(a)},c.clonePipeline=function(){if(confirm("Clone Pipeline "+c.PipelineEntityId+"?")){var a=function(){return d.clonePipeline(c.PipelineEntityId)},b=function(a){return d.getPipeline(a.EntityId)};c.savePipeline(null).then(a).then(b).then(u)}}}]),angular.module("PipelineManagement",["EavServices","EavConfiguration","eavNgSvcs","EavAdminUi"]).controller("PipelineManagement",["$modalInstance","appId","pipelineService","eavAdminDialogs",function($modalInstance,appId,pipelineService,eavAdminDialogs){var vm=this;vm.appId=appId,pipelineService.setAppId(appId),pipelineService.initContentTypes(),vm.getPipelineUrl=pipelineService.getPipelineUrl,vm.refresh=function(){vm.pipelines=pipelineService.getPipelines(appId)},vm.refresh(),vm["delete"]=function(a){confirm('Delete Pipeline "'+a.Name+'" ('+a.Id+")?")&&pipelineService.deletePipeline(a.Id).then(function(){vm.refresh()},function(a){alert(a)})},vm.clone=function(a){pipelineService.clonePipeline(a.Id).then(function(){vm.refresh()},function(a){alert(a)})},vm.permissions=function(a){return eavAdminDialogs.openPermissionsForGuid(appId,a.Guid)},vm.add=function(){eavAdminDialogs.openItemNew(pipelineService.dataPipelineAttributeSetId,vm.refresh)},vm.edit=function(a){eavAdminDialogs.openItemEditWithEntityId(a.Id,vm.refresh)},vm.design=function(a){return eavAdminDialogs.editPipeline(vm.appId,a.Id,vm.refresh)},vm.liveEval=function admin(){var inp=prompt("This is for very advanced operations. Only use this if you know what you're doing. \n\n Enter admin commands:");inp&&eval(inp)},vm.close=function(){$modalInstance.dismiss("cancel")}}]),angular.module("eavDialogService",["EavConfiguration"]).factory("eavDialogService",["eavConfig",function(a){return{open:function(b){b=$.extend({url:"",width:950,height:600,onClose:function(){},title:null},b),null===window.top.EavEditDialogs&&(window.top.EavEditDialogs=[]);var c;c=b.url?'<div id="EavNewEditDialog"'+window.top.EavEditDialogs.length+'"><iframe style="position:absolute; top:0; right:0; left:0; bottom:0; height:100%; width:100%; border:0" src="'+b.url+'"></iframe></div>':b.content?b.content:"<div>no url and no content specified</div>",window.top.jQuery(c).dialog({title:b.title,autoOpen:!0,modal:!0,width:b.width,dialogClass:a.dialogClass,height:b.height,close:function(a,c){$(this).remove(),b.onClose(),window.top.EavEditDialogs.pop()}}),window.top.EavEditDialogs.push(c)}}}]),angular.module("EavServices",["ng","EavConfiguration","pascalprecht.translate","ngResource"]),angular.module("EavServices").factory("contentItemsSvc",["$http","entitiesSvc","eavManagementSvc","svcCreator",function(a,b,c,d){return function(c,e){var f={};return f.contentType=e,f.appId=c,f=angular.extend(f,d.implementLiveList(function(){return a.get("eav/entities/GetAllOfTypeForAdmin",{params:{appId:f.appId,contentType:f.contentType}})})),f["delete"]=function(a){return b["delete"](f.contentType,a).then(f.liveListReload)},f.getColumns=function(){return a.get("eav/contenttype/getfields/",{params:{appid:f.appId,staticName:f.contentType}})},f}}]),angular.module("EavServices").factory("contentTypeFieldSvc",["$http","eavConfig","svcCreator",function(a,b,c){return function(b,d){var e={};return e.appId=b,e.contentType=d,e.typeListRetrieve=function(){return a.get("eav/contenttype/datatypes/",{params:{appid:e.appId}})},e.getFields=function(){return a.get("eav/contenttype/getfields",{params:{appid:e.appId,staticName:e.contentType.StaticName}})},e=angular.extend(e,c.implementLiveList(e.getFields)),e.types=c.implementLiveList(e.typeListRetrieve),e.moveUp=function(b){return a.get("eav/contenttype/reorder",{params:{appid:e.appId,contentTypeId:e.contentType.Id,attributeId:b.Id,direction:"up"}}).then(e.liveListReload)},e.moveDown=function(b){return a.get("eav/contenttype/reorder",{params:{appid:e.appId,contentTypeId:e.contentType.Id,attributeId:b.Id,direction:"down"}}).then(e.liveListReload)},e["delete"]=function(b){return a["delete"]("eav/contenttype/delete",{params:{appid:e.appId,contentTypeId:e.contentType.Id,attributeId:b.Id}}).then(e.liveListReload)},e.addMany=function(b,c){return a.get("eav/contenttype/addfield/",{params:b[c]}).then(function(){b.length==++c?e.liveListReload():e.addMany(b,c)})},e.add=function(b){return a.get("eav/contenttype/addfield/",{params:b}).then(e.liveListReload)},e.newItemCount=0,e.newItem=function(){return{AppId:e.appId,ContentTypeId:e.contentType.Id,Id:0,Type:"String",StaticName:"",IsTitle:0===e.liveList().length,SortOrder:e.liveList().length+e.newItemCount++}},e["delete"]=function(b){if(b.IsTitle)throw"Can't delete Title";return a["delete"]("eav/contenttype/deletefield",{params:{appid:e.appId,contentTypeId:e.contentType.Id,attributeId:b.Id}}).then(e.liveListReload)},e.setTitle=function(b){return a.get("eav/contenttype/setTitle",{params:{appid:e.appId,contentTypeId:e.contentType.Id,attributeId:b.Id}}).then(e.liveListReload)},e}}]),angular.module("EavServices").factory("contentTypeSvc",["$http","eavConfig","svcCreator",function(a,b,c){return function(d,e){var f={};return f.scope=e||b.contentType.defaultScope,f.appId=d,f.retrieveContentTypes=function(){return a.get("eav/contenttype/get/",{params:{appid:f.appId,scope:f.scope}})},f=angular.extend(f,c.implementLiveList(f.retrieveContentTypes)),f.getDetails=function(b){return a.get("eav/contenttype/GetSingle",{params:{appid:f.appId,contentTypeStaticName:b}})},f.newItem=function(){return{StaticName:"",Name:"",Description:"",Scope:b.contentType.defaultScope}},f.save=function(b){return a.post("eav/contenttype/save/",b,{params:{appid:f.appId}}).then(f.liveListReload)},f["delete"]=function(b){return a["delete"]("eav/contenttype/delete",{params:{appid:f.appId,staticName:b.StaticName}}).then(f.liveListReload)},f.setScope=function(a){f.scope=a,f.liveListReload()},f}}]),angular.module("EavAdminUi",["ng","ui.bootstrap","EavServices","eavTemplates","PermissionsApp","ContentItemsApp","PipelineManagement","ContentImportApp","HistoryApp","eavEditEntity"]).factory("eavAdminDialogs",["$modal","eavConfig","eavManagementSvc","contentTypeSvc","$window",function(a,b,c,d,e){var f={};return f.openContentItems=function(a,b,c,d){var e=f.CreateResolve({appId:a,contentType:b,contentTypeId:c});return f.OpenModal("content-items/content-items.html","ContentItemsList as vm","xlg",e,d)},f.openContentImport=function(a,b,c){var d=f.CreateResolve({appId:a,contentType:b});return f.OpenModal("content-import-export/content-import.html","ContentImport as vm","lg",d,c)},f.openContentTypeEdit=function(a,b){var c=f.CreateResolve({item:a});return f.OpenModal("content-types/content-types-edit.html","Edit as vm","sm",c,b)},f.openContentTypeFields=function(a,b){var c=f.CreateResolve({contentType:a});return f.OpenModal("content-types/content-types-fields.html","FieldList as vm","lg",c,b)},f.openItemNew=function(a,b){return f.openItemEditWithEntityIdX(f.CreateResolve({mode:"new",entityId:null,contentTypeName:contentTypeId}),b)},f.openItemEditWithEntityId=function(a,b){return f.openItemEditWithEntityIdX(f.CreateResolve({mode:"edit",entityId:a,contentTypeName:null}),b)},f.openItemEditWithEntityIdX=function(a,b){return f.OpenModal("wrappers/edit-entity-wrapper.html","EditEntityWrapperCtrl as vm","lg",a,b)},f.openItemHistory=function(a,b){return f.OpenModal("content-items/history.html","History as vm","lg",f.CreateResolve({entityId:a}),b)},f.openMetadataNew=function(a,c,e,g,h){var i={};switch(c){case"entity":i.keyGuid=e,i.assignmentType=b.metadataOfEntity;break;case"attribute":i.keyNumber=e,i.assignmentType=b.metadataOfAttribute;break;default:throw"targetType unknown, only accepts entity or attribute"}return d(a).getDetails(g).then(function(a){var b=f.CreateResolve({mode:"new",entityId:null,contentTypeName:g});return alert(g),b=angular.extend(b,f.CreateResolve(i)),f.openItemEditWithEntityIdX(b,{close:h})})},f.openPermissionsForGuid=function(a,b,c){var d=f.CreateResolve({appId:a,targetGuid:b});return f.OpenModal("permissions/permissions.html","PermissionList as vm","lg",d,c)},f.editPipeline=function(a,c,d){var f=b.adminUrls.pipelineDesigner(a,c);e.open(f)},f._attachCallbacks=function(a,b){return"function"==typeof b&&(b={close:b}),a.result.then(b.success||b.close,b.error||b.close,b.notify||b.close)},f.OpenModal=function(b,c,d,e,g){var h=c.indexOf(" as "),i=h>0?c.substring(h+4):null;h>0&&(c=c.substring(0,h));var j=a.open({animation:!0,templateUrl:b,controller:c,controllerAs:i,size:d,resolve:e});return f._attachCallbacks(j,g)},f.CreateResolve=function(){var a={},b=arguments[0];for(var c in b)b.hasOwnProperty(c)&&(a[c]=f._create1Resolve(b[c]));return a},f._create1Resolve=function(a){return function(){return a}},f}]),angular.module("eavNgSvcs",["ng"]).config(["$locationProvider",function(a){a.html5Mode({enabled:!0,requireBase:!1})}]).factory("eavManagementDialog",["$location",function(a){var b={},c=a.search();return b.appId=c.AppId||c.appId||c.appid,b}]).factory("eavManagementSvc",["$http","eavManagementDialog",function(a,b){var c={};return c.getContentTypeDefinition=function(c){return alert("using the wrong method - should use the content-type controller. Will work for now, change code please"),a.get("eav/contenttype/get",{params:{appId:b.appId,contentTypeId:c}})},c.getAssignedItems=function(c,d,e){return a.get("eav/metadata/getassignedentities",{params:{appId:b.appId,assignmentObjectTypeId:c,keyType:"guid",key:d,contentType:e}})},c}]).factory("entitiesSvc",["$http","eavManagementDialog",function(a,b){var c={};return c.get=function(c,d){return d?a.get("eav/entities/getone",{params:{contentType:c,id:d,appId:b.appId}}):a.get("eav/entities/getentities",{params:{contentType:c,appId:b.appId}})},c.getMultiLanguage=function(b,c,d){return a.get("eav/entities/getone",{params:{contentType:c,id:d,appId:b,format:"multi-language"}})},c["delete"]=function(c,d){return a["delete"]("eav/entities/delete",{params:{contentType:c,id:d,appId:b.appId}})},c.newEntity=function(a){return{Id:null,Guid:null,Type:{Name:a},Attributes:{}}},c.save=function(b,c){return a.post("eav/entities/save",c,{params:{appId:b}})},c}]),angular.module("EavServices").factory("historySvc",["$http","svcCreator",function(a,b){return function(c,d){var e={appId:c,entityId:d};return e=angular.extend(e,b.implementLiveList(function(){return a.get("eav/entities/history",{params:{appId:e.appId,entityId:e.entityId}}).then(function(a){for(var b=a.data,c=0;c<b.length;c++)b[c].VirtualVersion=b.length-c;return a})})),e.getVersionDetails=function(b){return a.get("eav/entities/historydetails",{params:{appId:e.appId,entityId:e.entityId,changeId:b}})},e}}]),function(){angular.module("EavServices").config(["$translateProvider","languages","$translatePartialLoaderProvider",function(a,b,c){a.preferredLanguage(b.currentLanguage.split("-")[0]).useSanitizeValueStrategy("escapeParameters").fallbackLanguage(b.defaultLanguage.split("-")[0]).useLoader("$translatePartialLoader",{urlTemplate:b.i18nRoot+"{part}-{lang}.js"}).useLoaderCache(!0),c.addPart("admin").addPart("edit")}]).run(["$rootScope","$translate",function(a,b){a.$on("$translatePartialLoaderStructureChanged",function(){b.refresh()})}])}(),function(){function a(a){return window.$2sxc?window.$2sxc.urlParams.get(a):b(a)}function b(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)","i"),c=b.exec(location.search);if(null===c){var d=new RegExp("[#&]"+a+"=([^&#]*)","i");c=d.exec(location.hash)}if(null===c){var e=window.location.pathname.match(new RegExp("/"+a+"/([^/]+)","i"));null!==e&&e.length>1&&(c=e.reverse()[0])}else c=c[1];return null===c?"":decodeURIComponent(c.replace(/\+/g," "))}angular.module("InitParametersFromUrl",[]).factory("appId",function(){return a("appId")}).factory("zoneId",function(){return a("zoneId")}).factory("entityId",function(){return a("entityid")}).factory("contentTypeName",function(){return a("contenttypename")}).factory("pipelineId",function(){return a("pipelineId")}).factory("dialog",function(){return a("dialog")}).factory("$modalInstance",function(){return null})}(),angular.module("EavServices").factory("permissionsSvc",["$http","eavConfig","entitiesSvc","eavManagementSvc","svcCreator","contentTypeSvc",function(a,b,c,d,e,f){var g=b;return function(a,b){var h={PermissionTargetGuid:b,ctName:"PermissionConfiguration",ctId:0,EntityAssignment:g.metadataOfEntity,ctSvc:f(a)};return h=angular.extend(h,e.implementLiveList(function(){return d.getAssignedItems(h.EntityAssignment,h.PermissionTargetGuid,h.ctName).then(h.updateLiveAll)})),h.ctSvc.getDetails(h.ctName).then(function(a){h.ctId=a.data.AttributeSetId}),h["delete"]=function(a){return c["delete"](h.ctName,a).then(h.liveListReload)},h}}]),angular.module("EavServices").factory("pipelineService",["$resource","$q","$filter","eavConfig","$http","contentTypeSvc",function(a,b,c,d,e,f){"use strict";var g={};g.pipelineResource=a("eav/PipelineDesigner/:action"),g.entitiesResource=a("eav/Entities/:action"),g.dataPipelineAttributeSetId=0,g.appId=0,g.getDataSourceDefinitionProperty=function(a,b){return c("filter")(a.InstalledDataSources,function(a){return a.PartAssemblyAndType==b.PartAssemblyAndType})[0]};var h=function(a){a.DataSources.push({Name:d.pipelineDesigner.outDataSource.name,Description:d.pipelineDesigner.outDataSource.description,EntityGuid:"Out",PartAssemblyAndType:d.pipelineDesigner.outDataSource.className,VisualDesignerData:d.pipelineDesigner.outDataSource.visualDesignerData,ReadOnly:!0}),angular.forEach(a.DataSources,function(b){b.Definition=function(){return g.getDataSourceDefinitionProperty(a,b)},b.ReadOnly=b.ReadOnly||!a.Pipeline.AllowEdit})};return angular.extend(g,{getPipeline:function(a){var c=b.defer(),e=g.pipelineResource.get({action:"GetPipeline",id:a,appId:g.appId}),f=g.pipelineResource.query({action:"GetInstalledDataSources"});return b.all([e.$promise,f.$promise]).then(function(b){var e=JSON.parse(angular.toJson(b[0]));e.InstalledDataSources=JSON.parse(angular.toJson(b[1])),a||(e.Pipeline={AllowEdit:"True"}),e.InstalledDataSources.push({PartAssemblyAndType:d.pipelineDesigner.outDataSource.className,ClassName:d.pipelineDesigner.outDataSource.className,In:d.pipelineDesigner.outDataSource["in"],Out:null,allowNew:!1}),h(e),c.resolve(e)},function(a){c.reject(a)}),c.promise},postProcessDataSources:function(a){c("filter")(a.DataSources,function(a){return"Out"==a.EntityGuid})[0]||h(a)},getNewDataSource:function(a,b){return{Definition:function(){return g.getDataSourceDefinitionProperty(a,b)}}},savePipeline:function(a,c){if(!g.appId)return b.reject("appId must be set to save a Pipeline");var d=[];return angular.forEach(c,function(a){var b=angular.copy(a);delete b.ReadOnly,d.push(b)}),g.pipelineResource.save({action:"SavePipeline",appId:g.appId,Id:a.EntityId},{pipeline:a,dataSources:d}).$promise},clonePipeline:function(a){return g.pipelineResource.get({action:"ClonePipeline",appId:g.appId,Id:a}).$promise},getDataSourceConfigurationUrl:function(a){var e=c("typename")(a.PartAssemblyAndType,"classFullName"),f="|Config "+e,h=4,i=a.EntityGuid,j=!0,k=b.defer();return g.entitiesResource.query({action:"GetAssignedEntities",appId:g.appId,assignmentObjectTypeId:h,keyType:"guid",key:i,contentType:f},function(a){a.length?k.resolve(d.itemForm.getEditItemUrl(a[0].Id,null,j)):g.entitiesResource.get({action:"GetContentType",appId:g.appId,contentType:f},function(a){"n"==a[0]&&"u"==a[1]&&"l"==a[2]&&"l"==a[3]?k.reject("Content Type "+f+" not found."):k.resolve(d.itemForm.getNewItemUrl(a.AttributeSetId,h,{KeyGuid:i,ReturnUrl:null},j))},function(a){k.reject(a)})},function(a){k.reject(a)}),k.promise}}),angular.extend(g,{queryPipeline:function(a){return g.pipelineResource.get({action:"QueryPipeline",appId:g.appId,id:a}).$promise},setAppId:function(a){g.appId=a},initContentTypes:function(){return f(g.appId).getDetails("DataPipeline").then(function(a){g.dataPipelineAttributeSetId=a.data.AttributeSetId})},getPipelines:function(){return g.entitiesResource.query({action:"GetEntities",appId:g.appId,contentType:"DataPipeline"})},deletePipeline:function(a){return g.pipelineResource.get({action:"DeletePipeline",appId:g.appId,id:a}).$promise}}),g}]),angular.module("EavServices").factory("svcCreator",function(){var a={};return a.implementLiveList=function(a){var b={};return b.liveListCache=[],b.liveListCache.isLoaded=!1,b.liveList=function(){return 0===b.liveListCache.length&&b.liveListReload(),b.liveListCache},b._liveListUpdateWithResult=function(a){b.liveListCache.length=0;for(var c=0;c<a.data.length;c++)b.liveListCache.push(a.data[c]);return b.liveListCache.isLoaded=!0,a},b.liveListSourceRead=a,b.liveListReload=function(){return b.liveListSourceRead().then(b._liveListUpdateWithResult)},b.liveListReset=function(){b.liveListCache=[]},b},a});
//# sourceMappingURL=eav-admin.min.js.map