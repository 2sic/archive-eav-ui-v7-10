/*! tosic.eav 2015-10-07 03:08 */

function enhanceEntity(a){var b=this;return b.enhanceWithCount=function(a){a.count=function(){var a,b=0;for(a in this)this.hasOwnProperty(a)&&"function"!=typeof this[a]&&b++;return b}},b.enhanceVs=function(a){return a.hasLanguage=function(a){return this.Dimensions.hasOwnProperty(a)},a.setLanguage=function(a,b){this.Dimensions[a]=b},a.languageMode=function(a){return this.hasLanguage(a)?this.Dimensions[a]:null},a},b.enhanceAtt=function(a){a.getVsWithLanguage=function(a){for(var b=0;b<this.Values.length;b++)if(this.Values[b].hasLanguage(a))return this.Values[b];return null},a.setLanguageToVs=function(a,b,c){return a.hasLanguage(b)?a.setLanguage(b,c):(this.removeLanguage(b),a.setLanguage(b,c))},a.removeLanguage=function(a){var b=this.getVsWithLanguage(a);null!==b&&(delete b.Dimensions[a],0===Object.keys(b.Dimensions).length&&this.Values.length>0&&this.removeVs(b))},a.removeVs=function(a){for(var b=0;b<this.Values.length;b++)this.Values[b]===a&&this.Values.splice(b,1)},a.addVs=function(a,c,d){var e={};e[c]=null===d?!0:d;var f={Value:a,Dimensions:e};this.Values.push(b.enhanceVs(f))};for(var c=0;c<a.Values.length;c++)b.enhanceVs(a.Values[c]);return a},b.enhanceEntity=function(a){a.getTitle=function(){a.getAttribute(a.TitleAttributeName)},a.hasAttribute=function(b){return void 0!==a.Attributes[b]},a.getAttribute=function(b){return a.Attributes[b]},a.Attributes.addAttribute=function(c){a.Attributes[c]={Values:[]},b.enhanceAtt(a.Attributes[c])};for(var c in a.Attributes)a.Attributes.hasOwnProperty(c)&&"function"!=typeof a.Attributes[c]&&b.enhanceAtt(a.Attributes[c]);return a},b.enhanceEntity(a)}!function(){"use strict";angular.module("eavEditEntity",["formly","ui.bootstrap","eavFieldTemplates","EavServices","eavEditTemplates"])}(),Date.prototype.toJSON=function(){var a=new Date(this);return a.setHours(a.getHours()-a.getTimezoneOffset()/60),a.toISOString()},function(){"use strict";var a=angular.module("eavFieldTemplates",["formly","formlyBootstrap","ui.bootstrap","eavLocalization","eavEditTemplates","ui.tree"]).config(["formlyConfigProvider",function(a){a.setType({name:"string-default",template:'<input class="form-control" ng-model="value.Value">',wrapper:["eavLabel","bootstrapHasError","eavLocalization"]}),a.setType({name:"string-dropdown",template:'<select class="form-control" ng-model="value.Value"></select>',wrapper:["eavLabel","bootstrapHasError","eavLocalization"],defaultOptions:function(a){function b(a,b,c){return Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0})}if(!a.templateOptions.options&&a.templateOptions.settings.String.DropdownValues){var c=a.templateOptions.settings.String.DropdownValues;c=c.replace(/\r/g,"").split("\n"),c=c.map(function(a,b){var c=a.split(":");return{name:c[0],value:c[1]?c[1]:c[0]}}),a.templateOptions.options=c}var d=a.templateOptions.ngOptions||"option[to.valueProp || 'value'] as option[to.labelProp || 'name'] group by option[to.groupProp || 'group'] for option in to.options";return{ngModelAttrs:b({},d,{value:"ng-options"})}}}),a.setType({name:"string-textarea",template:'<textarea class="form-control" ng-model="value.Value"></textarea>',wrapper:["eavLabel","bootstrapHasError","eavLocalization"],defaultOptions:{ngModelAttrs:{"{{to.settings.String.RowCount}}":{value:"rows"},cols:{attribute:"cols"}}}}),a.setType({name:"number-default",template:'<input type="number" class="form-control" ng-model="value.Value">{{vm.isGoogleMap}}',wrapper:["eavLabel","bootstrapHasError","eavLocalization"],defaultOptions:{ngModelAttrs:{"{{to.settings.Number.Min}}":{value:"min"},"{{to.settings.Number.Max}}":{value:"max"},'{{to.settings.Number.Decimals ? "^[0-9]+(.[0-9]{1," + to.settings.Number.Decimals + "})?$" : null}}':{value:"pattern"}}},controller:"FieldTemplate-NumberCtrl as vm"}),a.setType({name:"boolean-default",template:'<div class="checkbox">\n	<label>\n		<input type="checkbox"\n           class="formly-field-checkbox"\n		       ng-model="value.Value">\n		{{to.label}}\n		{{to.required ? \'*\' : \'\'}}\n	</label>\n</div>\n',wrapper:["eavLabel","bootstrapHasError","eavLocalization"]}),a.setType({name:"datetime-default",wrapper:["eavLabel","bootstrapHasError","eavLocalization"],template:'<div><div class="input-group"><div class="input-group-addon" style="cursor:pointer;" ng-click="to.isOpen = true;"><i class="glyphicon glyphicon-calendar"></i></div><input class="form-control" ng-model="value.Value" is-open="to.isOpen" datepicker-options="to.datepickerOptions" datepicker-popup /><timepicker ng-show="to.settings.DateTime.UseTimePicker" ng-model="value.Value" show-meridian="ismeridian"></timepicker></div>',defaultOptions:{templateOptions:{datepickerOptions:{},datepickerPopup:"dd.MM.yyyy"}},link:function(a,b,c){function d(a){return new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds())}a.value&&a.value.Value&&"string"==typeof a.value.Value&&(a.value.Value=d(new Date(a.value.Value)))}}),a.setType({name:"entity-default",templateUrl:"fields/templates/entity-default.html",wrapper:["eavLabel","bootstrapHasError"],controller:"FieldTemplate-EntityCtrl"}),a.setWrapper({name:"eavLabel",templateUrl:"fields/eav-label.html"})}]);a.controller("FieldTemplate-NumberCtrl",function(){}),a.controller("FieldTemplate-EntityCtrl",["$scope","$http","$filter","$modal","appId",function(a,b,c,d,e){a.to.settings.Entity||(a.to.settings.Entity={}),a.availableEntities=[],(void 0===a.model[a.options.key]||""===a.model[a.options.key].Values[0].Value)&&(a.model[a.options.key]={Values:[{Value:[],Dimensions:{}}]}),a.chosenEntities=a.model[a.options.key].Values[0].Value,a.addEntity=function(){"new"==a.selectedEntity?a.openNewEntityDialog():a.chosenEntities.push(a.selectedEntity),a.selectedEntity=""},a.createEntityAllowed=function(){return null!==a.to.settings.Entity.EntityType&&""!==a.to.settings.Entity.EntityType},a.openNewEntityDialog=function(){var b=d.open({template:'<div style="padding:20px;"><edit-content-group edit="vm.edit"></edit-content-group></div>',controller:["entityType",function(a){var b=this;b.edit={contentTypeName:a}}],controllerAs:"vm",resolve:{entityType:function(){return a.to.settings.Entity.EntityType}}});b.result.then(function(){a.getAvailableEntities()})},a.getAvailableEntities=function(){b({method:"GET",url:"eav/EntityPicker/getavailableentities",params:{contentTypeName:a.to.settings.Entity.EntityType,appId:e}}).then(function(b){a.availableEntities=b.data})},a.getEntityText=function(b){var d=c("filter")(a.availableEntities,{Value:b});return d.length>0?d[0].Text:"(Entity not found)"},a.remove=function(b){var c=a.chosenEntities.indexOf(b);a.chosenEntities.splice(c,1)},a.getAvailableEntities()}])}(),function(){"use strict";var a=angular.module("eavEditEntity");a.controller("EditEntities",["appId","$http","$scope","entitiesSvc","uiNotification","debugState",function(a,b,c,d,e,f){var g=this;g.debug=f,g.registeredControls=[],g.registerEditControl=function(a){g.registeredControls.push(a)},g.afterSaveEvent=c.afterSaveEvent,g.isValid=function(){var a=!0;return angular.forEach(g.registeredControls,function(b,c){b.isValid()||(a=!1)}),a},c.state.isDirty=function(){var a=!1;return angular.forEach(g.registeredControls,function(b,c){b.isDirty()&&(a=!0)}),a},c.state.setPristine=function(){angular.forEach(g.registeredControls,function(a,b){a.setPristine()})},g.save=function(){d.saveMany(a,g.items).then(function(a){c.state.setPristine(),g.afterSaveEvent(a)})},g.saveAndKeepOpen=function(){e.note("Saving","",!0),d.saveMany(a,g.items).then(function(){c.state.setPristine(),e.note("Saved","",!0)})},g.items=null,d.getManyForEditing(a,c.itemList).then(function(a){g.items=a.data,angular.forEach(g.items,function(a,b){!g.items[b].Entity&&g.items[b].Header.ContentTypeName?g.items[b].Entity=d.newEntity(g.items[b].Header.ContentTypeName):d.ensureGuid(g.items[b]),g.items[b].Entity=enhanceEntity(g.items[b].Entity)}),g.willPublish=g.items[0].Entity.IsPublished}),g.willPublish=!1,g.togglePublish=function(){g.willPublish=!g.willPublish,angular.forEach(g.items,function(a,b){g.items[b].Entity.IsPublished=g.willPublish})},g.toggleSlotIsEmpty=function(a){a.Header.Group||(a.Header.Group={}),a.Header.Group.SlotIsEmpty=!a.Header.Group.SlotIsEmpty}}])}(),function(){"use strict";var a=angular.module("eavEditEntity");a.directive("eavEditEntities",function(){return{templateUrl:"form/edit-many-entities.html",restrict:"E",scope:{itemList:"=",afterSaveEvent:"=",state:"="},controller:"EditEntities",controllerAs:"vm"}})}(),function(){"use strict";var a=angular.module("eavEditEntity");a.controller("EditEntityFormCtrl",["appId","$http","$scope","formlyConfig","contentTypeFieldSvc","$sce","debugState",function(a,b,c,d,e,f,g){var h=this;h.editInDefaultLanguageFirst=function(){return!1},h.control={isValid:function(){return 0===h.formFields.length||h.form&&h.form.$valid},isDirty:function(){return h.form&&h.form.$dirty},setPristine:function(){h.form&&h.form.$setPristine()}},c.registerEditControl&&c.registerEditControl(h.control),h.model=null,h.entity=c.entity,h.formFields=[];var i=function(){e(a,{StaticName:h.entity.Type.StaticName}).getFields().then(function(a){h.debug=a,angular.forEach(a.data,function(a,b){void 0===a.Metadata.All&&(a.Metadata.All={}),h.formFields.push({key:a.StaticName,type:j(a),templateOptions:{required:!!a.Metadata.All.Required,label:void 0===a.Metadata.All.Name?a.StaticName:a.Metadata.All.Name,description:f.trustAsHtml(a.Metadata.All.Notes),settings:a.Metadata,header:c.header,langReadOnly:!1},hide:a.Metadata.All.VisibleInEditUI===!1?!g.on:!1,expressionProperties:{"templateOptions.disabled":"options.templateOptions.disabled"},watcher:{expression:function(a,b,c){return a.templateOptions.header.Group&&a.templateOptions.header.Group.SlotIsEmpty||a.templateOptions.langReadOnly},listener:function(a,b,c,d,e){a.templateOptions.disabled=b}}})})})};null!==h.entity&&i();var j=function(a){var b=a,c=b.Type.toLowerCase(),e=b.Metadata.String?b.Metadata.String.InputType:null;return e=e?e.toLowerCase():null,"string"===c&&b.Metadata.String&&b.Metadata.String.RowCount>1&&(e="textarea"),e&&d.getType(c+"-"+e)||(e="default"),c+"-"+e}}])}(),function(){"use strict";angular.module("eavEditEntity").directive("eavEditEntityForm",function(){return{templateUrl:"form/edit-single-entity.html",restrict:"E",scope:{entity:"=",header:"=",registerEditControl:"="},controller:"EditEntityFormCtrl",controllerAs:"vm"}})}(),angular.module("eavEditTemplates",[]).run(["$templateCache",function(a){"use strict";a.put("fields/eav-label.html","<div><label for={{id}} class=\"control-label {{to.labelSrOnly ? 'sr-only' : ''}}\" ng-if=to.label>{{to.label}} {{to.required ? '*' : ''}} <a tabindex=-1 ng-click=\"to.showDescription = !to.showDescription\" href=javascript:void(0); ng-if=\"to.description && to.description != ''\" title={{to.description}}><i icon=info-sign></i></a></label><p ng-if=to.showDescription class=bg-info style=\"padding: 5px\" ng-bind-html=to.description></p><formly-transclude></formly-transclude></div>"),a.put("fields/templates/entity-default.html",'<div class=eav-entityselect><div ui-tree=options data-empty-placeholder-enabled=false><ol ui-tree-nodes ng-model=chosenEntities><li ng-repeat="item in chosenEntities" ui-tree-node class=eav-entityselect-item><div ui-tree-handle><i icon=move class="pull-left eav-entityselect-sort" ng-show=to.settings.Entity.AllowMultiValue></i> <span title="{{getEntityText(item) + \' (\' + item + \')\'}}">{{getEntityText(item)}}</span> <a data-nodrag title="Remove this item" ng-click=remove(this) class=eav-entityselect-item-remove><i icon=remove-circle></i></a></div></li></ol></div><select class="eav-entityselect-selector form-control" ng-model=selectedEntity ng-change=addEntity() ng-show="to.settings.Entity.AllowMultiValue || chosenEntities.length < 1"><option value="">-- choose --</option><option value=new ng-if=createEntityAllowed()>-- new --</option><option ng-repeat="item in availableEntities" ng-disabled="chosenEntities.indexOf(item.Value) != -1" value={{item.Value}}>{{item.Text}}</option></select></div>'),a.put("form/edit-many-entities.html",'<div ng-if="vm.items != null" ng-click=vm.debug.autoEnableAsNeeded($event)><eav-language-switcher></eav-language-switcher><div ng-repeat="p in vm.items"><h4>{{p.Header.Title ? p.Header.Title : \'Edit\'}} <span ng-if=p.Header.Group.SlotCanBeEmpty><span ng-if=p.Header.Group.SlotIsEmpty icon=ban-circle ng-click=vm.toggleSlotIsEmpty(p) tooltip="this item is locked and will stay empty/default. The values are shown for your convenience. Click here to unlock if needed."></span> <span ng-if=!p.Header.Group.SlotIsEmpty icon=ok-circle ng-click=vm.toggleSlotIsEmpty(p) tooltip="this item is open for editing. Click here to lock / remove it and revert to default."></span></span> <span class="pull-right btn-sm" ng-click="p.collapse = !p.collapse"><span ng-if=p.collapse icon=plus-sign></span> <span ng-if=!p.collapse icon=minus-sign></span></span></h4><eav-edit-entity-form entity=p.Entity header=p.Header register-edit-control=vm.registerEditControl ng-hide=p.collapse></eav-edit-entity-form></div><button ng-disabled=!vm.isValid() ng-click=vm.save() class="btn btn-primary submit-button"><span icon=ok tooltip="{{ \'Button.Save\' | translate }}"></span></button> <button class=btn ng-click=vm.saveAndKeepOpen()><span icon=check tooltip="{{ \'Button.SaveAndKeepOpen\' | translate }}"></span></button> <span ng-if=vm.willPublish icon=eye-open tooltip="{{ \'Status.Published\' | translate }} - {{ \'Message.WillPublish\' | translate }}" ng-click=vm.togglePublish()></span> <span ng-if=!vm.willPublish icon=eye-close tooltip="{{ \'Status.Unpublished\' | translate }} - {{ \'Message.WontPublish\' | translate }}" ng-click=vm.togglePublish()></span> <span ng-if=vm.debug.on><button tooltip=debug icon=zoom-in class=btn ng-click="vm.showDebugItems = !vm.showDebugItems"></button></span> <span class=pull-right ng-if=false>todo: show more buttons... <button class=btn><span icon=option-horizontal tooltip="{{ \'Button.MoreOptions\' | translate }}"></span></button></span><div ng-if="vm.debug.on && vm.showDebugItems"><pre>{{ vm.items | json }}</pre></div></div>'),a.put("form/edit-single-entity.html",'<div ng-show=vm.editInDefaultLanguageFirst()>Please edit this in the default language first.</div><div ng-show=!vm.editInDefaultLanguageFirst()><formly-form ng-if="vm.formFields && vm.formFields.length" ng-submit=vm.onSubmit() form=vm.form model=vm.entity.Attributes fields=vm.formFields></formly-form></div>'),a.put("localization/formly-localization-wrapper.html","<eav-localization-scope-control></eav-localization-scope-control><div ng-if=!!value><eav-localization-menu field-model=model[options.key] options=options value=value></eav-localization-menu><formly-transclude></formly-transclude></div><p class=bg-info style=padding:12px ng-if=!value>Please create the value for <i>'{{to.label}}'</i> in the default language before translating it.</p>"),a.put("localization/language-switcher.html",'<ul class="nav nav-pills" style="margin-left:0; margin-bottom: 15px"><li ng-repeat="l in languages.languages" ng-class="{ active: languages.currentLanguage == l.key }"><a ng-click="languages.currentLanguage = l.key;" href=javascript:void(0);>{{l.name}}</a></li></ul>'),a.put("localization/localization-menu.html",'<div dropdown is-open=status.isopen class=eav-localization><a class=eav-localization-lock ng-if=vm.isDefaultLanguage() title={{vm.tooltip()}} ng-class="{ \'eav-localization-lock-open\': !options.templateOptions.disabled }" dropdown-toggle href=javascript:void(0)>{{vm.infoMessage()}} <i class="glyphicon glyphicon-globe"></i></a><ul class="dropdown-menu multi-level pull-right eav-localization-dropdown" role=menu aria-labelledby=single-button><li role=menuitem><a ng-disabled=vm.enableTranslate() ng-click=vm.actions.translate()>Translate (unlink)</a></li><li role=menuitem><a ng-click=vm.actions.linkDefault()>Use default</a></li><li role=menuitem class=dropdown-submenu><a href=#>Google-Translate from</a><ul class=dropdown-menu><li ng-repeat="language in vm.languages.languages" class=disabled role=menuitem><a ng-click=vm.actions.autoTranslate(language.key) title={{language.name}} href=#>{{language.key}}</a></li></ul></li><li role=menuitem class=dropdown-submenu><a href=#>Copy from</a><ul class=dropdown-menu><li ng-repeat="language in vm.languages.languages" ng-class="{ disabled: options.templateOptions.disabled || !vm.hasLanguage(language.key) }" role=menuitem><a ng-click=vm.actions.copyFrom(language.key) title={{language.name}} href=#>{{language.key}}</a></li></ul></li><li role=menuitem class=dropdown-submenu><a href=#>Use from</a><ul class=dropdown-menu><li ng-repeat="language in vm.languages.languages" ng-class="{ disabled: !vm.hasLanguage(language.key) }" role=menuitem><a ng-click=vm.actions.useFrom(language.key) title={{language.name}} href=#>{{language.key}}</a></li></ul></li><li role=menuitem class=dropdown-submenu><a href=#>Share from</a><ul class=dropdown-menu><li ng-repeat="language in vm.languages.languages" ng-class="{ disabled: !vm.hasLanguage(language.key) }" role=menuitem><a ng-click=vm.actions.shareFrom(language.key) title={{language.name}} href=#>{{language.key}}</a></li></ul></li></ul></div>'),a.put("wrappers/edit-entity-wrapper.html",'<div class=modal-header><button class="btn pull-right" type=button icon=remove ng-click=vm.close()></button><h3 class=modal-title translate=EditEntity.Title></h3></div><div class=modal-body><eav-edit-entities item-list=vm.itemList after-save-event=vm.afterSave state=vm.state></eav-edit-entities></div>')}]),function(){"use strict";var a=angular.module("eavLocalization",["formly","EavConfiguration"],["formlyConfigProvider",function(a){a.setWrapper([{name:"eavLocalization",templateUrl:"localization/formly-localization-wrapper.html"}])}]);a.directive("eavLanguageSwitcher",function(){return{restrict:"E",templateUrl:"localization/language-switcher.html",controller:["$scope","languages",function(a,b){a.languages=b}]}}),a.directive("eavLocalizationScopeControl",function(){return{restrict:"E",transclude:!0,template:"",link:function(a,b,c){},controller:["$scope","$filter","eavDefaultValueService","languages",function(a,b,c,d){var e=a,f=d,g=function(){e.model[e.options.key]||e.model.addAttribute(e.options.key);var d=e.model[e.options.key];if(0===d.Values.length){if(f.currentLanguage!=f.defaultLanguage)return;var g=c(e.options);d.addVs(g,f.currentLanguage)}0===Object.keys(d.Values[0].Dimensions).length&&f.languages.length>0&&(d.Values[0].Dimensions[f.defaultLanguage]=!1);var h;if(h=b("filter")(d.Values,function(a,b){return void 0!==a.Dimensions[f.currentLanguage]})[0],void 0===h&&(h=b("filter")(d.Values,function(a,b){return void 0!==a.Dimensions[f.defaultLanguage]})[0]),void 0===h){if(d.Values.length>1)throw"Default language value not found, but found multiple values - can't handle editing for "+a.options.key;h=d.Values[0]}d._currentValue=h,e.value=d._currentValue;var i=f.currentLanguage==f.defaultLanguage||e.value&&e.value.Dimensions[f.currentLanguage]===!1;e.to.langReadOnly=!i};g(),e.langConf=f,e.$watch("langConf.currentLanguage",function(a,b){void 0!==b&&a!=b&&(g(),console.log("switched language from "+b+" to "+a))}),e.$watch("model[options.key].Values",function(a,b){g()},!0),e.model[e.options.key]._initCurrentValue=g}]}}),a.directive("eavLocalizationMenu",function(){return{restrict:"E",scope:{fieldModel:"=fieldModel",options:"=options",value:"=value"},templateUrl:"localization/localization-menu.html",link:function(a,b,c){},controllerAs:"vm",controller:["$scope","languages",function(a,b){var c=this;c.fieldModel=a.fieldModel,c.languages=b,c.hasLanguage=function(a){return null!==c.fieldModel.getVsWithLanguage(a)},c.isDefaultLanguage=function(){return b.currentLanguage!=b.defaultLanguage},c.enableTranslate=function(){return!0},c.infoMessage=function(){return 1===Object.keys(a.value.Dimensions).length&&a.value.Dimensions[b.defaultLanguage]===!1?"auto (default)":1===Object.keys(a.value.Dimensions).length&&a.value.Dimensions[b.currentLanguage]===!1?"":"in "+Object.keys(a.value.Dimensions).join(", ")},c.tooltip=function(){var b=[],c=[];angular.forEach(a.value.Dimensions,function(a,d){(a?c:b).push(d)});var d="editable in "+b.join(", ");return c.length>0&&(d+=", also used in "+c.join(", ")),d},c.actions={translate:function(){c.fieldModel.removeLanguage(b.currentLanguage),c.fieldModel.addVs(a.value.Value,b.currentLanguage,!1)},linkDefault:function(){c.fieldModel.removeLanguage(b.currentLanguage)},autoTranslate:function(a){alert("This action is not implemented yet.")},copyFrom:function(b){a.options.templateOptions.disabled&&alert("Copy not possible: the field is disabled.");var d=c.fieldModel.getVsWithLanguage(b).Value;a.value.Value=d},useFrom:function(a){c.fieldModel.removeLanguage(b.currentLanguage);var d=c.fieldModel.getVsWithLanguage(a);d.setLanguage(b.currentLanguage,!0)},shareFrom:function(a){c.fieldModel.removeLanguage(b.currentLanguage);var d=c.fieldModel.getVsWithLanguage(a);d.setLanguage(b.currentLanguage,!1)}}}]}}),a.directive("eavTreatTimeUtc",function(){function a(a,b){}function b(a,b,c,d){d[0].$formatters.push(function(a){return a}),d[0].parsers.push(function(a){return a})}var c={restrict:"A",require:["ngModel"],compile:a,link:b};return c})}(),function(){"use strict";angular.module("eavEditEntity").service("eavDefaultValueService",function(){return function(a){var b=a,c=b.templateOptions.settings.All.DefaultValue;switch(b.templateOptions.header.Prefill&&b.templateOptions.header.Prefill[b.key]&&(c=b.templateOptions.header.Prefill[b.key]),b.type.split("-")[0]){case"boolean":return void 0!==c?"true"==c.toLowerCase():!1;case"datetime":return void 0!==c?new Date(c):null;case"entity":return[];case"number":return null;default:return c?c:""}}})}(),function(){"use strict";function a(){var a=(new Date).getTime(),b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:3&c|8).toString(16)});return b}angular.module("eavEditEntity").factory("entitiesSvc",["$http","appId",function(b,c){var d={};return d.getManyForEditing=function(a,c){return b.post("eav/entities/getmanyforediting",c,{params:{appId:a}})},d.saveMany=function(a,c){for(var d=function(a,b){delete a._currentValue},e=angular.copy(c),f=0;f<e.length;f++)angular.forEach(e[f].Entity.Attributes,d);return b.post("eav/entities/savemany",e,{params:{appId:a}}).then(function(a){var b=function(b,c){var d=b.Entity;if(!(null!==d.Id&&0!==d.Id||null===d.Guid&&"undefined"==typeof d.Guid&&"00000000-0000-0000-0000-000000000000"===d.Guid)){var e=a.data[d.Guid];b.Entity.Id=e,b.Header.ID=e}};return angular.forEach(c,b),a})},d["delete"]=function(a,d){return b["delete"]("eav/entities/delete",{params:{contentType:a,id:d,appId:c}})},d.newEntity=function(b){return{Id:null,Guid:a(),Type:{StaticName:b},Attributes:{},IsPublished:!0}},d.ensureGuid=function(b){var c=b.Entity;null!==c.Id&&0!==c.Id||null!==c.Guid&&"undefined"!=typeof c.Guid&&"00000000-0000-0000-0000-000000000000"!==c.Guid||(b.Entity.Guid=a(),b.Header.Guid=b.Entity.Guid)},d.save=function(a,c){return b.post("eav/entities/save",c,{params:{appId:a}})},d}])}(),function(){"use strict";var a=angular.module("eavEditEntity");a.controller("EditEntityWrapperCtrl",["$q","$http","$scope","items","$modalInstance",function(a,b,c,d,e){var f=this;f.itemList=d,f.afterSave=function(a){200===a.status?f.close():alert("Something went wrong - maybe parts worked, maybe not. Sorry :(")},f.state={isDirty:function(){throw"Inner control must override this function."}},f.close=function(){e.dismiss("cancel")},c.$on("modal.closing",function(a){f.state.isDirty()&&!confirm("You have unsaved changes. Do you really want to exit?")&&a.preventDefault()})}])}();
//# sourceMappingURL=eav-edit.min.js.map