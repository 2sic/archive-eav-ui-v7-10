/*! tosic.eav 2015-10-27 10:33 */

!function(){"use strict";var a=angular.module("ToSicEavCustomGps",["uiGmapgoogle-maps"]);a.config(["formlyConfigProvider","defaultFieldWrappers",function(a,b){a.setType({name:"custom-gps",templateUrl:"fields/custom-gps/custom-gps.html",wrapper:b,controller:"FieldTemplate-CustomGpsController"})}]),a.config(["uiGmapGoogleMapApiProvider",function(a){a.configure({})}]),a.controller("FieldTemplate-CustomGpsController",["$scope","$filter","$modal","appId","debugState","eavAdminDialogs","addtemplatestocache","uiGmapGoogleMapApi",function(a,b,c,d,e,f,g,h){var i,j,k=a.to.settings["custom-gps"];k&&(i=k.LatField||null,j=k.LongField||null);a.hasAddressMask=k&&k["Address Mask"]&&""!==k["Address Mask"];console.log(k);var l={latitude:47,longitude:9};a.position=angular.extend({},l),a.showMap=!1,a.map={center:angular.extend({},a.position),zoom:15},a.$watch("value.Value",function(){if(a.value&&"string"==typeof a.value.Value&&""!==a.value.Value){var b=JSON.parse(a.value.Value);angular.extend(a.position,b),angular.extend(a.map.center,a.position)}}),a.$watch("position",function(){m(a.position)},!0);var m=function(b){i&&a.model.hasOwnProperty(i)&&a.model[i]&&a.model[i]._currentValue&&(a.model[i]._currentValue.Value=b.latitude),j&&a.model.hasOwnProperty(j)&&a.model[j]&&a.model[j]._currentValue&&(a.model[j]._currentValue.Value=b.longitude),angular.extend(a.map.center,b),b!==a.position&&angular.extend(a.position,b),a.value&&(a.value.Value=JSON.stringify(b))};a.marker={position:a.position,options:{draggable:!0},events:{dragend:function(b){m(a.position)}}},a.formattedAddress=function(){var b=k["Address Mask"],c=/\[.*?\]/gi,d=b.match(c);return angular.forEach(d,function(c,d){var e=c.replace(/[\[\]]/gi,""),f=a.model.hasOwnProperty(e)&&null!==a.model[e]?a.model[e]._currentValue.Value:"";b=b.replace(c,f)}),b},a.autoSelect=function(){var b=a.formattedAddress();(new google.maps.Geocoder).geocode({address:b},function(c,d){if(d==google.maps.GeocoderStatus.OK){var e=c[0].geometry.location;m({latitude:e.lat(),longitude:e.lng()}),a.showMap=!0}else alert("Could not locate address: "+b)})},a.debug=e}]),a.service("addtemplatestocache",["$templateCache",function(a){a.put("fields/custom-gps/custom-gps.html","<div>Lat: <input type='number' ng-model='marker.position.latitude'/>, Lng: <input type='number' ng-model='marker.position.longitude'/><br><a ng-click='showMap = !showMap' class='btn btn-default' ng-click='autoSelect'><span icon='map-marker'></span></a><a class='btn btn-default' ng-click='autoSelect()' ng-show='hasAddressMask'><span icon='search'></span></a> {{formattedAddress()}}<br><ui-gmap-google-map center='map.center' zoom='map.zoom' ng-if='showMap'><ui-gmap-marker idkey='\"mapMarker1\"' coords='marker.position' options='marker.options' events='marker.events'></ui-gmap-marker></ui-gmap-google-map><div><div ng-if=\"debug.on\"><h4>debug info</h4><div>lat field name: '{{latField}}' lng field name: '{{longField}}'<br><pre>{{value | json}}</pre></div></div></div></div>")}])}();
//# sourceMappingURL=custom-gps.min.js.map