/*! tosic.eav 2016-02-23 06:27 */

function enhanceEntity(a){var b=this;return b.enhanceWithCount=function(a){a.count=function(){var a,b=0;for(a in this)this.hasOwnProperty(a)&&"function"!=typeof this[a]&&b++;return b}},b.enhanceVs=function(a){return a.hasLanguage=function(a){return this.Dimensions.hasOwnProperty(a)},a.setLanguage=function(a,b){this.Dimensions[a]=b},a.languageMode=function(a){return this.hasLanguage(a)?this.Dimensions[a]:null},a},b.enhanceAtt=function(a){a.getVsWithLanguage=function(a){for(var b=0;b<this.Values.length;b++)if(this.Values[b].hasLanguage(a))return this.Values[b];return null},a.setLanguageToVs=function(a,b,c){return a.hasLanguage(b)?a.setLanguage(b,c):(this.removeLanguage(b),a.setLanguage(b,c))},a.removeLanguage=function(a){var b=this.getVsWithLanguage(a);null!==b&&(delete b.Dimensions[a],0===Object.keys(b.Dimensions).length&&this.Values.length>0&&this.removeVs(b))},a.removeVs=function(a){for(var b=0;b<this.Values.length;b++)this.Values[b]===a&&this.Values.splice(b,1)},a.addVs=function(a,c,d){var e={};null!==c&&(e[c]=null===d||void 0===d?!1:d);var f={Value:a,Dimensions:e};this.Values.push(b.enhanceVs(f))};for(var c=0;c<a.Values.length;c++)b.enhanceVs(a.Values[c]);return a},b.enhanceEntity=function(a){a.getTitle=function(){a.getAttribute(a.TitleAttributeName)},a.hasAttribute=function(b){return void 0!==a.Attributes[b]},a.getAttribute=function(b){return a.Attributes[b]},a.Attributes.addAttribute=function(c){a.Attributes[c]={Values:[]},b.enhanceAtt(a.Attributes[c])};for(var c in a.Attributes)a.Attributes.hasOwnProperty(c)&&"function"!=typeof a.Attributes[c]&&b.enhanceAtt(a.Attributes[c]);return a},b.enhanceEntity(a)}!function(){"use strict";angular.module("eavCustomFields",["oc.lazyLoad"]).config(["$ocLazyLoadProvider",function(a){a.config({debug:!0})}])}(),function(){"use strict";angular.module("eavEditEntity",["formly","ui.bootstrap","uiSwitch","toastr","ngAnimate","EavServices","eavEditTemplates","eavFieldTemplates","eavCustomFields","oc.lazyLoad"])}(),angular.module("eavFieldTemplates",["formly","formlyBootstrap","ui.bootstrap","eavLocalization","eavEditTemplates","ui.tree"]).constant("defaultFieldWrappers",["eavLabel","bootstrapHasError","disablevisually","eavLocalization","collapsible"]),angular.module("eavFieldTemplates").config(["formlyConfigProvider",function(a){a.setType({name:"boolean-default",templateUrl:"fields/boolean/boolean-default.html",wrapper:["bootstrapHasError","disablevisually","eavLocalization","collapsible"]})}]),angular.module("eavFieldTemplates").config(["formlyConfigProvider","defaultFieldWrappers",function(a,b){a.setType({name:"custom-default",templateUrl:"fields/custom/custom-default.html",wrapper:b})}]),Date.prototype.toJSON=function(){var a=new Date(this);return a.setHours(a.getHours()-a.getTimezoneOffset()/60),a.toISOString()},angular.module("eavFieldTemplates").config(["formlyConfigProvider","defaultFieldWrappers",function(a,b){a.setType({name:"datetime-default",wrapper:b,template:'<div><div class="input-group"><div class="input-group-addon" style="cursor:pointer;" ng-click="to.isOpen = true;"><i class="glyphicon glyphicon-calendar"></i></div><input class="form-control input-lg" ng-model="value.Value" is-open="to.isOpen" datepicker-options="to.datepickerOptions" datepicker-popup /><timepicker ng-show="to.settings.merged.UseTimePicker" ng-model="value.Value" show-meridian="ismeridian"></timepicker></div>',defaultOptions:{templateOptions:{datepickerOptions:{},datepickerPopup:"dd.MM.yyyy"}},link:function(a,b,c){function d(a){return new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds())}a.value&&a.value.Value&&"string"==typeof a.value.Value&&(a.value.Value=d(new Date(a.value.Value)))}})}]),angular.module("eavFieldTemplates").config(["formlyConfigProvider",function(a){a.setType({name:"empty-default",templateUrl:"fields/empty/empty-default.html",wrapper:["fieldGroup"]})}]),angular.module("eavFieldTemplates").config(["formlyConfigProvider",function(a){a.setType({name:"entity-default",templateUrl:"fields/entity/entity-default.html",wrapper:["eavLabel","bootstrapHasError","collapsible"],controller:"FieldTemplate-EntityCtrl"})}]).controller("FieldTemplate-EntityCtrl",["$scope","$http","$filter","$translate","$modal","appId","eavAdminDialogs","eavDefaultValueService",function(a,b,c,d,e,f,g,h){a.to.settings.merged||(a.to.settings.merged={}),a.availableEntities=[],(void 0===a.model[a.options.key]||""===a.model[a.options.key].Values[0].Value)&&(a.model[a.options.key]={Values:[{Value:h(a.options),Dimensions:{}}]}),a.chosenEntities=a.model[a.options.key].Values[0].Value,a.addEntity=function(){"new"===a.selectedEntity?a.openNewEntityDialog():a.chosenEntities.push(a.selectedEntity),a.selectedEntity=""},a.createEntityAllowed=function(){return null!==a.to.settings.merged.EntityType&&""!==a.to.settings.merged.EntityType},a.openNewEntityDialog=function(){function b(b){null!==b.data&&void 0!==b.data&&a.getAvailableEntities().then(function(){a.chosenEntities.push(Object.keys(b.data)[0])})}g.openItemNew(a.to.settings.merged.EntityType,b)},a.getAvailableEntities=function(){return b({method:"GET",url:"eav/EntityPicker/getavailableentities",params:{contentTypeName:a.to.settings.merged.EntityType,appId:f}}).then(function(b){a.availableEntities=b.data})},a.getEntityText=function(b){if(null===b)return"empty slot";var e=c("filter")(a.availableEntities,{Value:b});return e.length>0?e[0].Text:d.instant("FieldType.Entity.EntityNotFound")},a.removeSlot=function(b,c){a.chosenEntities.splice(c,1)},a.edit=function(b,d){if(null===b)return alert("no can do");var e=c("filter")(a.availableEntities,{Value:b}),f=e[0].Id;g.openItemEditWithEntityId(f,a.getAvailableEntities)},a.getAvailableEntities()}]).directive("entityValidation",[function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){d&&(d.$validators.required=function(b,c){if(!a.$parent.$parent.to.required)return!0;var d=b||c;return d&&Array.isArray(d)?d.length>0:!0},a.$watch(function(){return d.$viewValue},function(a){d.$validate()},!0))}}}]),angular.module("eavFieldTemplates").config(["formlyConfigProvider","defaultFieldWrappers",function(a,b){a.setType({name:"number-default",template:'<input type="number" class="form-control input-lg" ng-model="value.Value">{{vm.isGoogleMap}}',wrapper:b,defaultOptions:{ngModelAttrs:{"{{to.settings.merged.Min}}":{value:"min"},"{{to.settings.merged.Max}}":{value:"max"},'{{to.settings.merged.Decimals ? "^[0-9]+(.[0-9]{1," + to.settings.merged.Decimals + "})?$" : null}}':{value:"pattern"}}},controller:"FieldTemplate-NumberCtrl as vm"})}]).controller("FieldTemplate-NumberCtrl",function(){}),angular.module("eavFieldTemplates").config(["formlyConfigProvider","defaultFieldWrappers",function(a,b){a.setType({name:"string-default",template:'<div><input class="form-control input-lg" ng-if="!(options.templateOptions.settings.merged.RowCount > 1)" ng-pattern="vm.regexPattern" ng-model="value.Value"><textarea ng-if="options.templateOptions.settings.merged.RowCount > 1" rows="{{options.templateOptions.settings.merged.RowCount}}" class="form-control input-lg" ng-model="value.Value"></textarea></div>',wrapper:b,controller:"FieldTemplate-StringCtrl as vm"})}]).controller("FieldTemplate-StringCtrl",["$scope",function(a){var b=this,c=".*",d=a.options.templateOptions.settings.merged;d&&d.ValidationRegExJavaScript&&(c=d.ValidationRegExJavaScript),b.regexPattern=new RegExp(c,"i"),console.log(a.options.templateOptions)}]),angular.module("eavFieldTemplates").config(["formlyConfigProvider","defaultFieldWrappers",function(a,b){a.setType({name:"string-dropdown",template:'<select class="form-control input-lg" ng-model="value.Value"></select>',wrapper:b,defaultOptions:function(a){function b(a,b,c){return Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0})}if(a.templateOptions.settings&&a.templateOptions.settings.merged&&a.templateOptions.settings.merged.DropdownValues){var c=a.templateOptions.settings.merged.DropdownValues;c=c.replace(/\r/g,"").split("\n"),c=c.map(function(a,b){var c=a.split(":");return{name:c[0],value:c[1]||""===c[1]?c[1]:c[0]}}),a.templateOptions.options=c}var d=a.templateOptions.ngOptions||"option[to.valueProp || 'value'] as option[to.labelProp || 'name'] group by option[to.groupProp || 'group'] for option in to.options";return{ngModelAttrs:b({},d,{value:"ng-options"})}}})}]),function(){"use strict";var a=angular.module("eavEditEntity");a.controller("EditEntities",["appId","$http","$scope","entitiesSvc","toastr","saveToastr","$translate","debugState","ctrlS",function(a,b,c,d,e,f,g,h,i){function j(){l.saveShortcut=i(function(){l.save()}),l.loadAll()}function k(){l.saveShortcut.unbind()}var l=this;l.debug=h,l.isWorking=0,l.registeredControls=[],l.items=null,l.willPublish=!1,c.$on("$destroy",function(){k()}),l.registerEditControl=function(a){l.registeredControls.push(a)},l.loadAll=function(){d.getManyForEditing(a,c.itemList).then(function(a){l.items=a.data,angular.forEach(l.items,function(a,b){!l.items[b].Entity&&l.items[b].Header.ContentTypeName&&(l.items[b].Entity=d.newEntity(l.items[b].Header)),l.items[b].Entity=enhanceEntity(l.items[b].Entity);var c=l.items[b].Header.Group;l.items[b].slotIsUsed=null===c||c.SlotIsEmpty!==!0}),l.willPublish=l.items[0].Entity.IsPublished})},l.showFormErrors=function(){for(var a=l.formErrors(),b=[],c=g.instant("Message.FieldErrorList"),d=0;d<a.length;d++)if(a[d].required){var f=a[d].required.map(function(a){return{field:a.$name,error:"required"}});b=b.concat(f)}var h=b.map(function(a){var b=a.field.split("_");return c.replace("{form}",b[1]).replace("{field}",b[3]).replace("{error}",a.error)}),i=h.join("<br/>");return e.error(g.instant("Message.CantSaveInvalid").replace("{0}",i),g.instant("Message.Error"),{allowHtml:!0})},l.save=function(b){return l.isValid()?l.isWorking>0?e.error(g.instant("Message.CantSaveProcessing")):(l.isWorking++,void f(d.saveMany(a,l.items)).then(function(a){c.state.setPristine(),b&&l.afterSaveEvent(a),l.isWorking--},function(a){l.isWorking--})):l.showFormErrors()},l.afterSaveEvent=c.afterSaveEvent,l.isValid=function(){var a=!0;return angular.forEach(l.registeredControls,function(b,c){b.isValid()||(a=!1)}),a},l.formErrors=function(){var a=[];return angular.forEach(l.registeredControls,function(b,c){b.isValid()||a.push(b.error())}),a},c.state.isDirty=function(){var a=!1;return angular.forEach(l.registeredControls,function(b,c){b.isDirty()&&(a=!0)}),a},c.state.setPristine=function(){angular.forEach(l.registeredControls,function(a,b){a.setPristine()})},c.$watch("vm.willPublish",function(a,b){angular.forEach(l.items,function(a,b){l.items[b].Entity.IsPublished=l.willPublish})}),l.toggleSlotIsEmpty=function(a){a.Header.Group||(a.Header.Group={}),a.Header.Group.SlotIsEmpty=!a.Header.Group.SlotIsEmpty,a.slotIsUsed=!a.Header.Group.SlotIsEmpty},j()}])}(),function(){"use strict";var a=angular.module("eavEditEntity");a.directive("eavEditEntities",function(){return{templateUrl:"form/edit-many-entities.html",restrict:"E",scope:{itemList:"=",afterSaveEvent:"=",state:"="},controller:"EditEntities",controllerAs:"vm"}})}(),function(){"use strict";var a=angular.module("eavEditEntity");a.controller("EditEntityFormCtrl",["appId","$http","$scope","formlyConfig","contentTypeFieldSvc","$sce","debugState","customInputTypes","eavConfig",function(a,b,c,d,e,f,g,h,i){var j=this;j.editInDefaultLanguageFirst=function(){return!1},j.control={isValid:function(){return 0===j.formFields.length||j.form&&j.form.$valid},isDirty:function(){return j.form&&j.form.$dirty},setPristine:function(){j.form&&j.form.$setPristine()},error:function(){return j.form.$error}},c.registerEditControl&&c.registerEditControl(j.control),j.model=null,j.entity=c.entity,j.formFields=[];var k=function(){e(a,{StaticName:j.entity.Type.StaticName}).getFields().then(function(a){j.debug=a,angular.forEach(a.data,function(a,b){a.InputType=j.getType(a),i.formly.inputTypeReconfig(a),a.InputTypeConfig&&h.addInputType(a)});var b=h.loadWithPromise();b.then(function(b){j.registerAllFieldsFromReturnedDefinition(a)})})};j.registerAllFieldsFromReturnedDefinition=function(a){var b=0;angular.forEach(a.data,function(a,d){void 0===a.Metadata.All&&(a.Metadata.All={});var e=a.InputType,h="empty-default"===e;h&&(b=d);var i={key:a.StaticName,type:e,templateOptions:{required:!!a.Metadata.All.Required,label:void 0===a.Metadata.All.Name?a.StaticName:a.Metadata.All.Name,description:f.trustAsHtml(a.Metadata.All.Notes),settings:a.Metadata,header:c.header,canCollapse:b>0&&!h,fieldGroup:j.formFields[b],disabled:a.Metadata.All.Disabled,langReadOnly:!1},className:"type-"+a.Type.toLowerCase()+" input-"+e+" field-"+a.StaticName.toLowerCase(),hide:a.Metadata.All.VisibleInEditUI===!1?!g.on:!1,expressionProperties:{"templateOptions.disabled":"options.templateOptions.disabled"},watcher:[{expression:function(b,c,d){return a.Metadata.All.Disabled||b.templateOptions.header.Group&&b.templateOptions.header.Group.SlotIsEmpty||b.templateOptions.langReadOnly},listener:function(a,b,c,d,e){a.templateOptions.disabled=b}},{expression:function(a,b,c){return a.templateOptions.canCollapse?a.templateOptions.fieldGroup.templateOptions.collapseGroup:null},listener:function(a,b,c,d,e){a.templateOptions.canCollapse&&(a.templateOptions.collapse=b)}}]};j.formFields.push(i)})},null!==j.entity&&k(),j.getType=function(a){var b=a,c=b.Type.toLowerCase(),e="";"unknown"!==b.InputType?e=b.InputType:b.Metadata.merged&&b.Metadata.merged.InputType&&(e=b.Metadata.merged.InputType),e&&-1===e.indexOf("-")&&(e=c+"-"+e);var f=e&&i.formly.inputTypeReplacementMap[e];if(!f){var g=d.getType(e),h=b.InputTypeConfig?!!b.InputTypeConfig.Assets:!1;e&&(g||h)||(e=c+"-default"),f=e&&i.formly.inputTypeReplacementMap[e]}return f&&(e=i.formly.inputTypeReplacementMap[e]),e}}])}(),function(){"use strict";angular.module("eavEditEntity").directive("eavEditEntityForm",function(){return{templateUrl:"form/edit-single-entity.html",restrict:"E",scope:{entity:"=",header:"=",registerEditControl:"="},controller:"EditEntityFormCtrl",controllerAs:"vm"}})}(),function(){"use strict";var a=angular.module("eavEditEntity");a.controller("EditEntityWrapperCtrl",["$q","$http","$scope","items","$modalInstance","$window","$translate",function(a,b,c,d,e,f,g){var h=this;h.itemList=d,h.afterSave=function(a){200===a.status?h.close(a):alert(g.instant("Errors.UnclearError"))},h.state={isDirty:function(){throw g.instant("Errors.InnerControlMustOverride")}},h.close=function(a){e.close(a)},h.maybeLeave=function(a){var b=g.instant("Errors.UnsavedChanges");h.state.isDirty()&&!confirm(b+" "+g.instant("Message.ExitOk"))&&a.preventDefault()},c.$on("modal.closing",h.maybeLeave),f.addEventListener("beforeunload",function(a){var b=g.instant("Errors.UnsavedChanges");return h.state.isDirty()?((a||window.event).returnValue=b,b):null})}])}(),angular.module("eavEditTemplates",[]).run(["$templateCache",function(a){"use strict";a.put("fields/boolean/boolean-default.html",'<div class="checkbox checkbox-labeled"><switch class="tosic-green pull-left" ng-model=value.Value></switch><div ng-include="\'wrappers/eav-label.html\'"></div></div>'),a.put("fields/custom/custom-default.html",'<div class="alert alert-danger">ERROR - This is a custom field, you shouldn\'t see this. You only see this because the custom-dialog is missing.</div><input class="form-control input-lg" ng-pattern=vm.regexPattern ng-model=value.Value>'),a.put("fields/empty/empty-default.html","<span></span>"),a.put("fields/entity/entity-default.html",'<div class=eav-entityselect><div ui-tree=options data-empty-placeholder-enabled=false><ol ui-tree-nodes ng-model=chosenEntities entity-validation ng-required=false><li ng-repeat="item in chosenEntities track by $index" ui-tree-node class=eav-entityselect-item><div ui-tree-handle><i icon=move title="{{ \'FieldType.Entity.DragMove\' | translate }}" class="pull-left eav-entityselect-sort" ng-show=to.settings.Entity.AllowMultiValue></i> <span title="{{getEntityText(item) + \' (\' + item + \')\'}}">{{getEntityText(item)}}</span> <span class=eav-entityselect-item-actions><span data-nodrag title="{{ \'FieldType.Entity.Edit\' | translate }}" ng-click="edit(item, index)"><i icon=pencil></i></span> <span data-nodrag title="{{ \'FieldType.Entity.Remove\' | translate }}" ng-click="removeSlot(item, $index)" class=eav-entityselect-item-remove><i icon=minus></i></span></span></div></li></ol></div><select class="eav-entityselect-selector form-control input-lg" formly-skip-ng-model-attrs-manipulator ng-model=selectedEntity ng-change=addEntity() ng-show="to.settings.merged.AllowMultiValue || chosenEntities.length < 1"><option value="" translate=FieldType.Entity.Choose></option><option value=new ng-if=createEntityAllowed() translate=FieldType.Entity.New></option><option ng-repeat="item in availableEntities" ng-disabled="chosenEntities.indexOf(item.Value) != -1" value={{item.Value}}>{{item.Text}}</option></select></div>'),a.put("form/edit-many-entities.html",'<div ng-if="vm.items != null" ng-click=vm.debug.autoEnableAsNeeded($event)><eav-language-switcher is-disabled=!vm.isValid()></eav-language-switcher><div ng-repeat="p in vm.items" class=group-entity><h3 class=clickable ng-click="p.collapse = !p.collapse">{{p.Header.Title ? p.Header.Title : \'EditEntity.DefaultTitle\' | translate }}&nbsp; <span ng-if=p.Header.Group.SlotCanBeEmpty ng-click=vm.toggleSlotIsEmpty(p) stop-event=click><switch ng-model=p.slotIsUsed class=tosic-blue style="top: 6px" tooltip="{{\'EditEntity.SlotUsed\' + p.slotIsUsed | translate}}"></switch></span> <span class="pull-right clickable" style="font-size: smaller"><span class="low-priority collapse-entity-button" ng-if=p.collapse icon=plus-sign></span> <span class=collapse-entity-button ng-if=!p.collapse icon=minus-sign></span></span></h3><eav-edit-entity-form entity=p.Entity header=p.Header register-edit-control=vm.registerEditControl ng-hide=p.collapse></eav-edit-entity-form></div><div><button ng-class="{ \'disabled\': !vm.isValid() || vm.isWorking > 0}" ng-click=vm.save(true) type=button class="btn btn-primary btn-lg submit-button"><span icon=ok tooltip="{{ \'Button.Save\' | translate }}"></span> &nbsp;<span translate=Button.Save></span></button> &nbsp; <button ng-class="{ \'disabled\': !vm.isValid() || vm.isWorking > 0}" class="btn btn-default btn-lg btn-square" type=button ng-click=vm.save(false)><span icon=check tooltip="{{ \'Button.SaveAndKeepOpen\' | translate }}"></span></button> &nbsp;<switch ng-model=vm.willPublish class=tosic-blue style="top: 13px"></switch>&nbsp; <span ng-click="vm.willPublish = !vm.willPublish;" class=save-published-icon><i ng-if=vm.willPublish icon=eye-open tooltip="{{ \'Status.Published\' | translate }} - {{ \'Message.WillPublish\' | translate }}"></i> <i ng-if=!vm.willPublish icon=eye-close tooltip="{{ \'Status.Unpublished\' | translate }} - {{ \'Message.WontPublish\' | translate }}"></i></span> <span ng-if=vm.debug.on><button tooltip=debug icon=zoom-in class=btn ng-click="vm.showDebugItems = !vm.showDebugItems"></button></span><show-debug-availability class=pull-right style="margin-top: 20px"></show-debug-availability></div><div ng-if="vm.debug.on && vm.showDebugItems"><div>isValid: {{vm.isValid()}}<br>isWorking: {{vm.isWorking}}</div><pre>{{ vm.items | json }}</pre></div></div>'),a.put("form/edit-single-entity.html",'<div ng-show=vm.editInDefaultLanguageFirst() translate=Message.PleaseCreateDefLang></div><div ng-show=!vm.editInDefaultLanguageFirst()><formly-form ng-if="vm.formFields && vm.formFields.length" ng-submit=vm.onSubmit() form=vm.form model=vm.entity.Attributes fields=vm.formFields></formly-form></div>'),a.put("form/main-form.html",'<div class=modal-body><span class=pull-right><span style="display: inline-block; position: relative; left:15px"><button class="btn btn-default btn-square btn-subtle" type=button ng-click=vm.close()><i icon=remove></i></button></span></span><eav-edit-entities item-list=vm.itemList after-save-event=vm.afterSave state=vm.state></eav-edit-entities></div>'),a.put("localization/formly-localization-wrapper.html","<eav-localization-scope-control></eav-localization-scope-control><div ng-if=!!value><formly-transclude></formly-transclude><eav-localization-menu field-model=model[options.key] options=options value=value index=index></eav-localization-menu></div><p class=bg-info style=padding:12px ng-if=!value translate=LangWrapper.CreateValueInDefFirst translate-values=\"{ fieldname: '{{to.label}}' }\">Please... <i>'{{to.label}}'</i> in the def...</p>"),a.put("localization/language-switcher.html",'<tabset><tab ng-repeat="l in languages.languages" heading="{{ l.name.substring(0, l.name.indexOf(\'(\') > 0 ? l.name.indexOf(\'(\') - 1 : 100 ) }}" ng-click="!isDisabled ? languages.currentLanguage = l.key : false;" disable=isDisabled active="languages.currentLanguage == l.key" tooltip={{l.name}}></tab></tabset>'),a.put("localization/localization-menu.html",'<div dropdown is-open=status.isopen class=eav-localization><a class=eav-localization-lock ng-click=vm.actions.toggleTranslate(); ng-if=vm.isDefaultLanguage() title={{vm.tooltip()}} ng-class="{ \'eav-localization-lock-open\': !options.templateOptions.disabled }" dropdown-toggle>{{vm.infoMessage()}} <i class="glyphicon glyphicon-globe"></i></a><ul class="dropdown-menu multi-level pull-right eav-localization-dropdown" role=menu aria-labelledby=single-button><li role=menuitem><a ng-click=vm.actions.translate() translate=LangMenu.Unlink></a></li><li role=menuitem><a ng-click=vm.actions.linkDefault() translate=LangMenu.LinkDefault></a></li><li role=menuitem class=dropdown-submenu><a href=# translate=LangMenu.Copy></a><ul class=dropdown-menu><li ng-repeat="language in vm.languages.languages" ng-class="{ disabled: options.templateOptions.disabled || !vm.hasLanguage(language.key) }" role=menuitem><a ng-click=vm.actions.copyFrom(language.key) title={{language.name}} href=#>{{language.key}}</a></li></ul></li><li role=menuitem class=dropdown-submenu><a href=# translate=LangMenu.Use></a><ul class=dropdown-menu><li ng-repeat="language in vm.languages.languages" ng-class="{ disabled: !vm.hasLanguage(language.key) }" role=menuitem><a ng-click=vm.actions.useFrom(language.key) title={{language.name}} href=#>{{language.key}}</a></li></ul></li><li role=menuitem class=dropdown-submenu><a href=# translate=LangMenu.Share></a><ul class=dropdown-menu><li ng-repeat="language in vm.languages.languages" ng-class="{ disabled: !vm.hasLanguage(language.key) }" role=menuitem><a ng-click=vm.actions.shareFrom(language.key) title={{language.name}} href=#>{{language.key}}</a></li></ul></li></ul></div>'),a.put("wrappers/collapsible.html","<div ng-show=!to.collapse class=group-field-set><formly-transclude></formly-transclude></div>"),a.put("wrappers/disablevisually.html","<div visually-disabled={{to.disabled}}><formly-transclude></formly-transclude></div>"),a.put("wrappers/eav-label.html","<div><label for={{id}} class=\"control-label eav-label {{to.labelSrOnly ? 'sr-only' : ''}} {{to.type}}\" ng-if=to.label>{{to.label}} {{to.required ? '*' : ''}} <a tabindex=-1 ng-click=\"to.showDescription = !to.showDescription\" href=javascript:void(0); ng-if=\"to.description && to.description != ''\"><i icon=info-sign class=low-priority></i></a></label><p ng-if=to.showDescription class=bg-info style=\"padding: 5px\" ng-bind-html=to.description></p><formly-transclude></formly-transclude></div>"),a.put("wrappers/field-group.html",'<div><h4 class=clickable ng-click="to.collapseGroup = !to.collapseGroup">{{to.label}} <span class="pull-right btn-sm"><span ng-if=to.collapseGroup class="low-priority collapse-fieldgroup-button" icon=plus-sign></span> <span ng-if=!to.collapseGroup class="low-priority collapse-fieldgroup-button" icon=minus-sign></span></span></h4><div ng-if=!to.collapseGroup style="padding: 5px" ng-bind-html=to.description></div><formly-transclude></formly-transclude></div>')}]),function(){"use strict";var a=angular.module("eavLocalization",["formly","EavConfiguration"],["formlyConfigProvider",function(a){a.setWrapper([{name:"eavLocalization",templateUrl:"localization/formly-localization-wrapper.html"}])}]);a.directive("eavLanguageSwitcher",function(){return{restrict:"E",templateUrl:"localization/language-switcher.html",controller:["$scope","languages",function(a,b){a.languages=b}],scope:{isDisabled:"=isDisabled"}}}),a.directive("eavLocalizationScopeControl",function(){return{restrict:"E",transclude:!0,template:"",link:function(a,b,c){},controller:["$scope","$filter","$translate","eavDefaultValueService","languages",function(a,b,c,d,e){var f=a,g=e,h=function(){f.model[f.options.key]||f.model.addAttribute(f.options.key);var e=f.model[f.options.key];if(0===e.Values.length){if(g.currentLanguage!=g.defaultLanguage)return;var h=d(f.options),i=g.languages.length>0?g.currentLanguage:null;e.addVs(h,i)}0===Object.keys(e.Values[0].Dimensions).length&&g.languages.length>0&&(e.Values[0].Dimensions[g.defaultLanguage]=!1);var j;if(j=b("filter")(e.Values,function(a,b){return void 0!==a.Dimensions[g.currentLanguage]})[0],void 0===j&&(j=b("filter")(e.Values,function(a,b){return void 0!==a.Dimensions[g.defaultLanguage]})[0]),void 0===j){if(e.Values.length>1)throw c.instant("Errors.DefLangNotFound")+" "+a.options.key;j=e.Values[0]}e._currentValue=j,f.value=e._currentValue;var k=g.currentLanguage==g.defaultLanguage||f.value&&f.value.Dimensions[g.currentLanguage]===!1;f.to.langReadOnly=!k};h(),f.langConf=g,f.$watch("langConf.currentLanguage",function(a,b){void 0!==b&&a!=b&&(h(),console.log("switched language from "+b+" to "+a))}),f.$watch("model[options.key].Values",function(a,b){h()},!0),f.model[f.options.key]._initCurrentValue=h}]}}),a.directive("eavLocalizationMenu",function(){return{restrict:"E",scope:{fieldModel:"=fieldModel",options:"=options",value:"=value",index:"=index"},templateUrl:"localization/localization-menu.html",link:function(a,b,c){},controllerAs:"vm",controller:["$scope","languages","$translate",function(a,b,c){var d=this,e=c.instant("LangMenu.UseDefault");c.instant("LangMenu.In");d.fieldModel=a.fieldModel,d.languages=b,d.hasLanguage=function(a){return null!==d.fieldModel.getVsWithLanguage(a)},d.isDefaultLanguage=function(){return b.currentLanguage!=b.defaultLanguage},d.enableTranslate=function(){return null===d.fieldModel.getVsWithLanguage(b.currentLanguage)},d.infoMessage=function(){return 1===Object.keys(a.value.Dimensions).length&&a.value.Dimensions[b.defaultLanguage]===!1?e:1===Object.keys(a.value.Dimensions).length&&a.value.Dimensions[b.currentLanguage]===!1?"":c.instant("LangMenu.In",{languages:Object.keys(a.value.Dimensions).join(", ")})},d.tooltip=function(){var b=[],d=[];angular.forEach(a.value.Dimensions,function(a,c){(a?d:b).push(c)});var e=c.instant("LangMenu.EditableIn",{languages:b.join(", ")});return d.length>0&&(e+=c.instant("LangMenu.AlsoUsedIn",{languages:d.join(", ")})),e},d.actions={toggleTranslate:function(){d.enableTranslate()?d.actions.translate():d.actions.linkDefault()},translate:function(){d.enableTranslate()&&(d.fieldModel.removeLanguage(b.currentLanguage),d.fieldModel.addVs(a.value.Value,b.currentLanguage,!1))},linkDefault:function(){d.fieldModel.removeLanguage(b.currentLanguage)},autoTranslate:function(a){alert(translate("LangMenu.NotImplemented"))},copyFrom:function(b){a.options.templateOptions.disabled&&alert(translate("LangMenu.CopyNotPossible"));var c=d.fieldModel.getVsWithLanguage(b).Value;a.value.Value=c},useFrom:function(a){d.fieldModel.removeLanguage(b.currentLanguage);var c=d.fieldModel.getVsWithLanguage(a);c.setLanguage(b.currentLanguage,!0)},shareFrom:function(a){d.fieldModel.removeLanguage(b.currentLanguage);var c=d.fieldModel.getVsWithLanguage(a);c.setLanguage(b.currentLanguage,!1)}}}]}}),a.directive("eavTreatTimeUtc",function(){function a(a,b){}function b(a,b,c,d){d[0].$formatters.push(function(a){return a}),d[0].parsers.push(function(a){return a})}var c={restrict:"A",require:["ngModel"],compile:a,link:b};return c})}(),function(){"use strict";angular.module("eavEditEntity").service("customInputTypes",["eavConfig","toastr","formlyConfig","$q","$interval","$ocLazyLoad",function(a,b,c,d,e,f){var g={};return g.inputTypesOnPage={},g.allLoaded=!0,g.assetsToLoad=[],g.addInputType=function(a){var b=a.InputTypeConfig;void 0!==b&&null!==b&&(g.inputTypesOnPage[b.Type]=b,g.addToLoadQueue(b))},g.addToLoadQueue=function(a){if(void 0===a.Assets||null===a.Assets||!a.Assets)return void(a.assetsLoaded=!0);for(var b=a.Assets.split("\n"),c=0;c<b.length;c++){var d=b[c].trim();d.length>5&&g.assetsToLoad.push(g.resolveSpecialPaths(d))}},g.loadWithPromise=function(){return f.load(g.assetsToLoad)},g.resolveSpecialPaths=function(b){return b=b.replace(/\[System:Path\]/i,a.getUrlPrefix("system")).replace(/\[Zone:Path\]/i,a.getUrlPrefix("zone")).replace(/\[App:Path\]/i,a.getUrlPrefix("app"))},g.checkDependencyArrival=function(a){return!!c.getType(a)},g}])}(),function(){"use strict";angular.module("eavEditEntity").service("eavDefaultValueService",function(){return function(a){var b=a,c=b.templateOptions.settings.All.DefaultValue;switch(b.templateOptions.header.Prefill&&b.templateOptions.header.Prefill[b.key]&&(c=b.templateOptions.header.Prefill[b.key]),b.type.split("-")[0]){case"boolean":return void 0!==c&&null!==c?"true"===c.toLowerCase():!1;case"datetime":return void 0!==c&&null!==c&&""!==c?new Date(c):null;case"entity":return void 0!==c&&null!==c&&""!==c?c:[];case"number":return void 0!==c&&null!==c&&""!==c?Number(c):"";default:return c?c:""}}})}(),function(){"use strict";angular.module("eavEditEntity").factory("entitiesSvc",["$http","appId","toastrWithHttpErrorHandling","promiseToastr",function(a,b,c,d){var e={toastr:c};return e.getManyForEditing=function(b,c){return a.post("eav/entities/getmanyforediting",c,{params:{appId:b}})},e.saveMany=function(b,c){for(var d=function(a,b){delete a._currentValue},e=angular.copy(c),f=0;f<e.length;f++)angular.forEach(e[f].Entity.Attributes,d);return a.post("eav/entities/savemany",e,{params:{appId:b}}).then(function(a){var b=function(b,c){var d=b.Entity;if(!(null!==d.Id&&0!==d.Id||null===d.Guid&&"undefined"==typeof d.Guid&&"00000000-0000-0000-0000-000000000000"===d.Guid)){var e=a.data[d.Guid];b.Entity.Id=e,b.Header.ID=e}};return angular.forEach(c,b),a})},e["delete"]=function(c,e){console.log("try to delete");var f=a.get("eav/entities/delete",{ignoreErrors:!0,params:{contentType:c,id:e,appId:b}});return d(f,"Message.Deleting","Message.Ok","Message.Error")},e.newEntity=function(a){return{Id:null,Guid:a.Guid,Type:{StaticName:a.ContentTypeName},Attributes:{},IsPublished:!0}},e.save=function(b,c){return a.post("eav/entities/save",c,{params:{appId:b}})},e}])}(),function(){"use strict";angular.module("eavFieldTemplates").config(["formlyConfigProvider",function(a){a.setWrapper({name:"collapsible",templateUrl:"wrappers/collapsible.html"})}])}(),function(){"use strict";angular.module("eavFieldTemplates").config(["formlyConfigProvider",function(a){a.setWrapper({name:"disablevisually",templateUrl:"wrappers/disablevisually.html"})}])}(),function(){"use strict";angular.module("eavFieldTemplates").config(["formlyConfigProvider",function(a){a.setWrapper({name:"eavLabel",templateUrl:"wrappers/eav-label.html"})}])}(),function(){"use strict";angular.module("eavFieldTemplates").config(["formlyConfigProvider",function(a){a.setWrapper({name:"fieldGroup",templateUrl:"wrappers/field-group.html"})}])}();
//# sourceMappingURL=eav-edit.min.js.map