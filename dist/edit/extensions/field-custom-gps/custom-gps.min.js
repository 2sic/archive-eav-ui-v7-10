angular.module("customGpsTemplates",[]).run(["$templateCache",function(e){e.put("fields/custom-gps/custom-gps.html","<div>\r\n    <div ng-if=\"debug.on\">\r\n        <h4>debug info</h4>\r\n        <div>lat field name: '{{latField}}' long-field name: '{{longField}}' </div>\r\n    </div>\r\n</div>")}]),function(){"use strict";var e=angular.module("ToSicEavCustomGps",["uiGmapgoogle-maps"]);e.config(["formlyConfigProvider","defaultFieldWrappers",function(e,a){e.setType({name:"custom-gps",templateUrl:"fields/custom-gps/custom-gps.html",wrapper:a,controller:"FieldTemplate-CustomGpsController"})}]),e.config(["uiGmapGoogleMapApiProvider",function(e){e.configure({key:"AIzaSyDPhnNKpEg8FmY8nooE7Zwnue6SusxEnHE"})}]),e.controller("FieldTemplate-CustomGpsController",["$scope","$filter","$uibModal","appId","debugState","eavAdminDialogs","addtemplatestocache","uiGmapGoogleMapApi",function(e,a,o,t,n,l,i,r){var s,d,u=e.to.settings["custom-gps"];u&&(s=u.LatField||null,d=u.LongField||null);e.hasAddressMask=u&&u.AddressMask&&""!==u.AddressMask;console.log(u);var p={latitude:47.17465989999999,longitude:9.469142499999975};e.position=angular.extend({},p),e.showMap=!1,e.map={center:angular.extend({},e.position),zoom:15},e.$watch("value.Value",function(){if(e.value&&"string"==typeof e.value.Value&&""!==e.value.Value){var a=JSON.parse(e.value.Value);angular.extend(e.position,a),angular.extend(e.map.center,e.position)}}),e.$watch("position",function(){m(e.position)},!0);var m=function(a){s&&e.model.hasOwnProperty(s)&&e.model[s]&&e.model[s]._currentValue&&(e.model[s]._currentValue.Value=a.latitude),d&&e.model.hasOwnProperty(d)&&e.model[d]&&e.model[d]._currentValue&&(e.model[d]._currentValue.Value=a.longitude),angular.extend(e.map.center,a),a!==e.position&&angular.extend(e.position,a),e.value&&(e.value.Value=JSON.stringify(a))};e.marker={position:e.position,options:{draggable:!0},events:{dragend:function(a){m(e.position)}}},e.formattedAddress=function(){if(!u)return"";var a=u.AddressMask;if(void 0===a)return"";var o=/\[.*?\]/gi,t=a.match(o);return angular.forEach(t,function(o,t){var n=o.replace(/[\[\]]/gi,""),l=e.model.hasOwnProperty(n)&&null!==e.model[n]?e.model[n]._currentValue.Value:"";a=a.replace(o,l)}),a},e.autoSelect=function(){var a=e.formattedAddress();(new google.maps.Geocoder).geocode({address:a},function(o,t){if(t==google.maps.GeocoderStatus.OK){var n=o[0].geometry.location;m({latitude:n.lat(),longitude:n.lng()}),e.showMap=!0,e.$apply()}else alert("Could not locate address: "+a)})},e.debug=n}]),e.service("addtemplatestocache",["$templateCache",function(e){e.put("fields/custom-gps/custom-gps.html","<div>Lat: <input type='number' ng-model='marker.position.latitude'/>, Lng: <input type='number' ng-model='marker.position.longitude'/><br><a ng-click='showMap = !showMap' class='btn btn-default' ng-click='autoSelect'><span icon='map-marker'></span></a><a class='btn btn-default' ng-click='autoSelect()' ng-show='hasAddressMask'><span icon='search'></span></a> {{formattedAddress()}}<br><ui-gmap-google-map center='map.center' zoom='map.zoom' ng-if='showMap'><ui-gmap-marker idkey='\"mapMarker1\"' coords='marker.position' options='marker.options' events='marker.events'></ui-gmap-marker></ui-gmap-google-map><div><div ng-if=\"debug.on\"><h4>debug info</h4><div>lat field name: '{{latField}}' lng field name: '{{longField}}'<br><pre>{{value | json}}</pre></div></div></div></div>")}])}();