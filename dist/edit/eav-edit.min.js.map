{"version":3,"sources":["eav-edit.min.js"],"names":["enhanceEntity","entity","enhancer","this","enhanceWithCount","obj","count","key","hasOwnProperty","enhanceVs","vs","hasLanguage","language","Dimensions","setLanguage","shareMode","languageMode","enhanceAtt","att","getVsWithLanguage","v","Values","length","setLanguageToVs","removeLanguage","value","Object","keys","removeVs","splice","addVs","dimensions","undefined","newVs","Value","push","ent","getTitle","getAttribute","TitleAttributeName","hasAttribute","attrName","Attributes","addAttribute","attKey","angular","module","config","$ocLazyLoadProvider","debug","constant","formlyConfigProvider","setType","name","templateUrl","wrapper","defaultFieldWrappers","Date","prototype","toJSON","x","setHours","getHours","getTimezoneOffset","toISOString","template","defaultOptions","templateOptions","datepickerOptions","datepickerPopup","link","scope","el","attrs","convertDateToUTC","date","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","controller","$scope","$http","$filter","$translate","$modal","appId","eavAdminDialogs","eavDefaultValueService","to","settings","merged","availableEntities","model","options","chosenEntities","selectedEntity","addEntity","createEntityAllowed","EntityType","EnableCreate","openNewEntityDialog","reload","result","data","getAvailableEntities","then","openItemNew","method","url","params","contentTypeName","getEntityText","entityId","entities","Text","instant","removeSlot","itemGuid","index","deleteItemInSlot","alert","edit","id","Id","openItemEditWithEntityId","directive","restrict","require","element","ngModel","$validators","required","modelValue","viewValue","$parent","Array","isArray","$watch","$viewValue","newValue","$validate","ngModelAttrs","{{to.settings.merged.Min}}","{{to.settings.merged.Max}}","{{to.settings.merged.Decimals ? \"^[0-9]+(.[0-9]{1,\" + to.settings.merged.Decimals + \"})?$\" : null}}","vm","validationRegexString","stringSettings","ValidationRegExJavaScript","regexPattern","RegExp","console","log","_defineProperty","defineProperty","enumerable","configurable","writable","DropdownValues","o","replace","split","map","e","i","s","ngOptions","debugState","stripNonUrlCharacters","sourcesChangedTryToUpdate","lastAutoCopy","orig","getFieldContentBasedOnMask","cleaned","sourceMask","autoGenerateLink","controlSettings","AutoGenerateMask","fieldMask","maskRegEx","mask","forEach","getFieldsOfMask","replaceValue","_currentValue","matches","match","staticName","finalClean","factory","inputValue","allowPath","trimEnd","rexAllowed","rexSeparators","rexMult","rexTrim","cleanInputValue","modelCtrl","$parsers","$setViewValue","$render","app","entitiesSvc","toastr","saveToastr","ctrlS","activate","saveShortcut","save","loadAll","deactivate","unbind","isWorking","registeredControls","items","willPublish","$on","registerEditControl","control","getManyForEditing","itemList","Entity","Header","ContentTypeName","newEntity","grp","Group","slotIsUsed","SlotIsEmpty","IsPublished","showFormErrors","errors","formErrors","msgs","msgTemplate","set","req","itm","field","$name","error","concat","nice","err","specs","msg","join","allowHtml","close","isValid","saveMany","state","setPristine","afterSaveEvent","response","valid","list","isDirty","dirty","oldValue","toggleSlotIsEmpty","item","controllerAs","formlyConfig","contentTypeFieldSvc","$sce","customInputTypes","eavConfig","editInDefaultLanguageFirst","formFields","form","$valid","$dirty","$setPristine","$error","loadContentType","StaticName","Type","getFields","InputType","getType","formly","inputTypeReconfig","InputTypeConfig","addInputType","promiseToLoad","loadWithPromise","dependencyResult","registerAllFieldsFromReturnedDefinition","lastGroupHeadingId","Metadata","All","fieldType","isFieldHeading","nextField","type","Required","label","Name","description","trustAsHtml","Notes","header","canCollapse","fieldGroup","disabled","Disabled","langReadOnly","className","toLowerCase","hide","VisibleInEditUI","on","expressionProperties","templateOptions.disabled","watcher","expression","stop","listener","stopWatching","collapseGroup","collapse","attributeConfiguration","inputType","indexOf","willBeRewrittenByConfig","inputTypeReplacementMap","typeAlreadyRegistered","typeWillRegisterLaterWithAssets","Assets","$q","$modalInstance","$window","afterSave","status","maybeLeave","unsavedChangesText","confirm","preventDefault","addEventListener","window","event","returnValue","eavLocalization","setWrapper","languages","isDisabled","transclude","langConf","initCurrentValue","fieldModel","currentLanguage","defaultLanguage","defaultValue","languageToAdd","valueToEdit","_initCurrentValue","formModel","lblDefault","languageKey","isDefaultLanguage","enableTranslate","infoMessage","tooltip","editableIn","usedIn","actions","toggleTranslate","translate","linkDefault","autoTranslate","copyFrom","useFrom","shareFrom","all","forAllMenus","localizationMenus","action","compile","attributes","modelController","$formatters","parsers","service","$interval","$ocLazyLoad","svc","inputTypesOnPage","allLoaded","assetsToLoad","addToLoadQueue","assetsLoaded","a","asset","trim","resolveSpecialPaths","load","getUrlPrefix","checkDependencyArrival","typeName","fieldConfig","d","DefaultValue","Prefill","Number","toastrWithHttpErrorHandling","promiseToastr","post","removeTempValue","itmCopy","copy","ei","serverKeys","syncUpdatedKeys","Guid","newId","ID","delPromise","get","ignoreErrors","contentType","newData","run","$templateCache","put"],"mappings":"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","file":"eav-edit.min.js","sourcesContent":["/* \r\n * Custom Fields skelleton to allow later, lazy loaded fields\r\n */\r\n(function() {\r\n    \"use strict\";\r\n    var module = angular.module(\"eavCustomFields\", [\"oc.lazyLoad\"])\r\n\r\n    .config([\"$ocLazyLoadProvider\", function ($ocLazyLoadProvider) {\r\n        $ocLazyLoadProvider.config({\r\n            debug: true\r\n        });\r\n    }]);\r\n\r\n})();\n/* Main object with dependencies, used in wrappers and other places */\r\n(function () {\r\n\t\"use strict\";\r\n\r\n    angular.module(\"eavEditEntity\", [\r\n        \"formly\",\r\n        \"ui.bootstrap\",\r\n        \"uiSwitch\",\r\n        \"toastr\",\r\n        \"ngAnimate\",\r\n        \"EavServices\",\r\n        \"eavEditTemplates\",\r\n        \"eavFieldTemplates\",\r\n        \"eavCustomFields\",\r\n\r\n        // new...\r\n        \"oc.lazyLoad\"\r\n    ]);\r\n\r\n\r\n\r\n})();\n/* \r\n * Field-Templates app initializer\r\n */\r\n\r\nangular.module(\"eavFieldTemplates\",\r\n    [\r\n        \"formly\",\r\n        \"formlyBootstrap\",\r\n        \"ui.bootstrap\",\r\n        \"eavLocalization\",\r\n        \"eavEditTemplates\",\r\n        \"ui.tree\"\r\n    ]\r\n)\r\n    // important: order of use is backwards, so the last is around the second-last, etc.\r\n    .constant(\"defaultFieldWrappers\", [\r\n        \"eavLabel\",\r\n        \"bootstrapHasError\",\r\n        \"disablevisually\",\r\n        \"eavLocalization\",\r\n        \"collapsible\"\r\n    ])\r\n;\n/* \r\n * Field: Boolean - Default\r\n */\r\n\r\nangular.module(\"eavFieldTemplates\")\r\n    .config([\"formlyConfigProvider\", function(formlyConfigProvider) {\r\n        formlyConfigProvider.setType({\r\n            name: \"boolean-default\",\r\n            templateUrl: \"fields/boolean/boolean-default.html\",\r\n            wrapper: [\"bootstrapHasError\", \"disablevisually\", \"eavLocalization\", \"collapsible\"]\r\n        });\r\n    }]);\n/* \r\n * Field: Custom - Default (basically something you should never see)\r\n */\r\n\r\nangular.module(\"eavFieldTemplates\")\r\n    .config([\"formlyConfigProvider\", \"defaultFieldWrappers\", function (formlyConfigProvider, defaultFieldWrappers) {\r\n\r\n        formlyConfigProvider.setType({\r\n            name: \"custom-default\",\r\n            templateUrl: \"fields/custom/custom-default.html\",\r\n            wrapper: defaultFieldWrappers\r\n        });\r\n\r\n    }]);\n// this changes JSON-serialization for dates, \r\n// because we usually want the time to be the same across time zones and NOT keeping the same moment\r\nDate.prototype.toJSON = function() {\r\n    var x = new Date(this);\r\n    x.setHours(x.getHours() - x.getTimezoneOffset() / 60);\r\n    return x.toISOString();\r\n};\n/* \r\n * Field: DateTime - Default\r\n */\r\n\r\nangular.module(\"eavFieldTemplates\")\r\n    .config([\"formlyConfigProvider\", \"defaultFieldWrappers\", function (formlyConfigProvider, defaultFieldWrappers) {\r\n\r\n        formlyConfigProvider.setType({\r\n            name: \"datetime-default\",\r\n            wrapper: defaultFieldWrappers,\r\n            template: \"<div>\" +\r\n                \"<div class=\\\"input-group\\\">\" +\r\n                    \"<div class=\\\"input-group-addon\\\" style=\\\"cursor:pointer;\\\" ng-click=\\\"to.isOpen = true;\\\">\" +\r\n                        \"<i class=\\\"glyphicon glyphicon-calendar\\\"></i>\" +\r\n                    \"</div>\" +\r\n                    \"<input class=\\\"form-control input-lg\\\" ng-model=\\\"value.Value\\\" is-open=\\\"to.isOpen\\\" datepicker-options=\\\"to.datepickerOptions\\\" datepicker-popup />\" +\r\n\t\t\t\t    \"<timepicker ng-show=\\\"to.settings.merged.UseTimePicker\\\" ng-model=\\\"value.Value\\\" show-meridian=\\\"ismeridian\\\"></timepicker>\" +\r\n                \"</div>\",\r\n            defaultOptions: {\r\n                templateOptions: {\r\n                    datepickerOptions: {},\r\n                    datepickerPopup: \"dd.MM.yyyy\"\r\n                }\r\n            },\r\n            link: function (scope, el, attrs) {\r\n                // Server delivers value as string, so convert it to UTC date\r\n                function convertDateToUTC(date) { return new Date(date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate(), date.getUTCHours(), date.getUTCMinutes(), date.getUTCSeconds()); }\r\n                if (scope.value && scope.value.Value && typeof (scope.value.Value) === 'string')\r\n                    scope.value.Value = convertDateToUTC(new Date(scope.value.Value));\r\n            }\r\n        });\r\n\r\n    }]);\n/* \r\n * Field: Empty - Default: this is usually a title/group section\r\n */\r\n\r\nangular.module(\"eavFieldTemplates\")\r\n    .config([\"formlyConfigProvider\", function(formlyConfigProvider) {\r\n        formlyConfigProvider.setType({\r\n            name: \"empty-default\",\r\n            templateUrl: \"fields/empty/empty-default.html\",\r\n            wrapper: [\"fieldGroup\"]\r\n        });\r\n    }]);\n/* \r\n * Field: Entity - Default\r\n * Also contains much business logic and the necessary controller\r\n * \r\n */\r\n\r\nangular.module(\"eavFieldTemplates\")\r\n    .config([\"formlyConfigProvider\", function(formlyConfigProvider) {\r\n\r\n        formlyConfigProvider.setType({\r\n            name: \"entity-default\",\r\n            templateUrl: \"fields/entity/entity-default.html\",\r\n            wrapper: [\"eavLabel\", \"bootstrapHasError\", \"collapsible\"],\r\n            controller: \"FieldTemplate-EntityCtrl\",\r\n            //defaultOptions: {\r\n            //    validators: {\r\n            //        required: function (viewValue, modelValue, scope) {\r\n            //            var value = viewValue || modelValue;\r\n            //            if (!Array.isArray(value))\r\n            //                return true;\r\n            //            return value.length > 0;\r\n            //        }\r\n            //    }\r\n            //}\r\n        });\r\n\r\n\r\n    }])\r\n    .controller(\"FieldTemplate-EntityCtrl\", [\"$scope\", \"$http\", \"$filter\", \"$translate\", \"$modal\", \"appId\", \"eavAdminDialogs\", \"eavDefaultValueService\", function ($scope, $http, $filter, $translate, $modal, appId, eavAdminDialogs, eavDefaultValueService) {\r\n        if (!$scope.to.settings.merged)\r\n            $scope.to.settings.merged = {};\r\n\r\n        $scope.availableEntities = [];\r\n        //$scope.options = {};\r\n\r\n        if ($scope.model[$scope.options.key] === undefined || $scope.model[$scope.options.key].Values[0].Value === \"\")\r\n            $scope.model[$scope.options.key] = { Values: [{ Value: eavDefaultValueService($scope.options), Dimensions: {} }] };\r\n\r\n        $scope.chosenEntities = $scope.model[$scope.options.key].Values[0].Value;\r\n        $scope.selectedEntity = null;\r\n\r\n        $scope.addEntity = function () {\r\n            if ($scope.selectedEntity !== null) {\r\n                $scope.chosenEntities.push($scope.selectedEntity);\r\n                $scope.selectedEntity = null;\r\n            }\r\n        };\r\n\r\n        $scope.createEntityAllowed = function() {\r\n            var settings = $scope.to.settings.merged;\r\n            return settings.EntityType !== null && settings.EntityType !== \"\" && settings.EnableCreate;\r\n        };\r\n\r\n        $scope.openNewEntityDialog = function() {\r\n            function reload(result) {\r\n                if (!result || result.data === null || result.data === undefined)\r\n                    return;\r\n\r\n                $scope.getAvailableEntities().then(function () {\r\n                    $scope.chosenEntities.push(Object.keys(result.data)[0]);\r\n                });\r\n            }\r\n\r\n            eavAdminDialogs.openItemNew($scope.to.settings.merged.EntityType, reload);\r\n\r\n        };\r\n\r\n        $scope.getAvailableEntities = function() {\r\n            return $http({\r\n                method: \"GET\",\r\n                url: \"eav/EntityPicker/getavailableentities\",\r\n                params: {\r\n                    contentTypeName: $scope.to.settings.merged.EntityType,\r\n                    appId: appId\r\n                    // ToDo: dimensionId: $scope.configuration.DimensionId\r\n                }\r\n            }).then(function(data) {\r\n                $scope.availableEntities = data.data;\r\n            });\r\n        };\r\n\r\n        $scope.getEntityText = function (entityId) {\r\n            if (entityId === null)\r\n                return \"empty slot\"; // todo: i18n\r\n            var entities = $filter(\"filter\")($scope.availableEntities, { Value: entityId });\r\n            return entities.length > 0 ? entities[0].Text : $translate.instant(\"FieldType.Entity.EntityNotFound\"); \r\n        };\r\n\r\n        // remove needs the index --> don't name \"remove\" - causes problems\r\n        $scope.removeSlot = function(itemGuid, index) {\r\n            $scope.chosenEntities.splice(index, 1);\r\n        };\r\n\r\n        $scope.deleteItemInSlot = function(itemGuid, index) {\r\n            alert('this feature is not implemented yet, sorry. it will be added some day...');\r\n        };\r\n\r\n        // edit needs the Guid - the index isn't important\r\n        $scope.edit = function (itemGuid, index) {\r\n            if (itemGuid === null)\r\n                return alert('no can do'); // todo: i18n\r\n            var entities = $filter(\"filter\")($scope.availableEntities, { Value: itemGuid });\r\n            var id = entities[0].Id;\r\n\r\n            eavAdminDialogs.openItemEditWithEntityId(id, $scope.getAvailableEntities);\r\n        };\r\n\r\n        // Initialize entities\r\n        $scope.getAvailableEntities();\r\n\r\n    }]).directive('entityValidation', [function() {\r\n        return {\r\n            restrict: 'A',\r\n            require: '?ngModel',\r\n            link: function(scope, element, attrs, ngModel) {\r\n                if (!ngModel) return;\r\n\r\n                ngModel.$validators.required = function (modelValue, viewValue) {\r\n\r\n                    if (!scope.$parent.$parent.to.required)\r\n                        return true;\r\n                    var value = modelValue || viewValue;\r\n                    if (!value || !Array.isArray(value))\r\n                        return true;\r\n                    return value.length > 0;\r\n                };\r\n\r\n                scope.$watch(function () {\r\n                    return ngModel.$viewValue;\r\n                }, function (newValue) {\r\n                    ngModel.$validate();\r\n                }, true);\r\n            }\r\n        };\r\n    }]);\r\n\n/* \r\n * Field: Number - Default\r\n */\r\n\r\nangular.module(\"eavFieldTemplates\")\r\n    .config([\"formlyConfigProvider\", \"defaultFieldWrappers\", function (formlyConfigProvider, defaultFieldWrappers) {\r\n        formlyConfigProvider.setType({\r\n            name: \"number-default\",\r\n            template: \"<input type=\\\"number\\\" class=\\\"form-control input-lg\\\" ng-model=\\\"value.Value\\\">{{vm.isGoogleMap}}\",\r\n            wrapper: defaultFieldWrappers,\r\n            defaultOptions: {\r\n                ngModelAttrs: {\r\n                    '{{to.settings.merged.Min}}': { value: \"min\" },\r\n                    '{{to.settings.merged.Max}}': { value: \"max\" },\r\n                    '{{to.settings.merged.Decimals ? \"^[0-9]+(\\.[0-9]{1,\" + to.settings.merged.Decimals + \"})?$\" : null}}': { value: \"pattern\" }\r\n                }\r\n            },\r\n            controller: \"FieldTemplate-NumberCtrl as vm\"\r\n        });\r\n    }]).controller(\"FieldTemplate-NumberCtrl\", function () {\r\n        var vm = this;\r\n    });\n/* \r\n * Field: String - Default\r\n */\r\n\r\nangular.module(\"eavFieldTemplates\")\r\n    .config([\"formlyConfigProvider\", \"defaultFieldWrappers\", function (formlyConfigProvider, defaultFieldWrappers) {\r\n\r\n        formlyConfigProvider.setType({\r\n            name: \"string-default\",\r\n            template: \"<div><input class=\\\"form-control input-lg\\\" ng-if=\\\"!(options.templateOptions.settings.merged.RowCount > 1)\\\" ng-pattern=\\\"vm.regexPattern\\\" ng-model=\\\"value.Value\\\">\" +\r\n                \"<textarea ng-if=\\\"options.templateOptions.settings.merged.RowCount > 1\\\" rows=\\\"{{options.templateOptions.settings.merged.RowCount}}\\\" class=\\\"form-control input-lg\\\" ng-model=\\\"value.Value\\\"></textarea></div>\",\r\n            wrapper: defaultFieldWrappers, \r\n            controller: \"FieldTemplate-StringCtrl as vm\"\r\n        });\r\n\r\n    }]).controller(\"FieldTemplate-StringCtrl\", [\"$scope\", function ($scope) {\r\n        var vm = this;\r\n        var validationRegexString = \".*\";\r\n        var stringSettings = $scope.options.templateOptions.settings.merged;\r\n        if (stringSettings && stringSettings.ValidationRegExJavaScript)\r\n            validationRegexString = stringSettings.ValidationRegExJavaScript;\r\n        vm.regexPattern = new RegExp(validationRegexString, 'i');\r\n\r\n        console.log($scope.options.templateOptions);\r\n    }]);\n/* \r\n * Field: String - Dropdown\r\n */\r\n\r\nangular.module(\"eavFieldTemplates\")\r\n    .config([\"formlyConfigProvider\", \"defaultFieldWrappers\", function (formlyConfigProvider, defaultFieldWrappers) {\r\n\r\n        formlyConfigProvider.setType({\r\n            name: \"string-dropdown\",\r\n            template: \"<select class=\\\"form-control input-lg\\\" ng-model=\\\"value.Value\\\"></select>\",\r\n            wrapper: defaultFieldWrappers,\r\n            defaultOptions: function defaultOptions(options) {\r\n\r\n                // DropDown field: Convert string configuration for dropdown values to object, which will be bound to the select\r\n                if (options.templateOptions.settings && options.templateOptions.settings.merged && options.templateOptions.settings.merged.DropdownValues) {\r\n                    var o = options.templateOptions.settings.merged.DropdownValues;\r\n                    o = o.replace(/\\r/g, \"\").split(\"\\n\");\r\n                    o = o.map(function (e, i) {\r\n                        var s = e.split(\":\");\r\n                        return {\r\n                            name: s[0],\r\n                            value: (s[1] || s[1] === '') ? s[1] : s[0]\r\n                        };\r\n                    });\r\n                    options.templateOptions.options = o;\r\n                }\r\n\r\n                function _defineProperty(obj, key, value) { return Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); }\r\n\r\n                var ngOptions = options.templateOptions.ngOptions || \"option[to.valueProp || 'value'] as option[to.labelProp || 'name'] group by option[to.groupProp || 'group'] for option in to.options\";\r\n                return {\r\n                    ngModelAttrs: _defineProperty({}, ngOptions, {\r\n                        value: \"ng-options\"\r\n                    })\r\n                };\r\n\r\n            }\r\n        });\r\n    }]);\n/* \r\n * Field: String - url-item\r\n */\r\n\r\nangular.module(\"eavFieldTemplates\")\r\n    .config([\"formlyConfigProvider\", \"defaultFieldWrappers\", function(formlyConfigProvider, defaultFieldWrappers) {\r\n\r\n        formlyConfigProvider.setType({\r\n            name: \"string-url-path\",\r\n            template: \"<div><input class=\\\"form-control input-lg\\\" only-simple-url-chars ng-pattern=\\\"vm.regexPattern\\\" ng-model=\\\"value.Value\\\" ng-blur=\\\"vm.finalClean()\\\"></div>\",\r\n            wrapper: defaultFieldWrappers,\r\n            controller: \"FieldTemplate-String-Url-Item-Ctrl as vm\"\r\n        });\r\n\r\n    }]).controller(\"FieldTemplate-String-Url-Item-Ctrl\", [\"$scope\", \"debugState\", \"stripNonUrlCharacters\", function($scope, debugState, stripNonUrlCharacters) {\r\n        var vm = this;\r\n\r\n        // todo: \r\n        // 3. auto-pickup the address if this is still blank and a / the source-field changed\r\n\r\n        // get configured\r\n        var autoGenerateLink = false, sourceMask;\r\n        var controlSettings = $scope.to.settings[\"string-url-path\"];\r\n        if (controlSettings) {\r\n            sourceMask = controlSettings.AutoGenerateMask || null;\r\n        };\r\n        sourceMask = \"[Name]\";\r\n        // we have specs...\r\n        if (sourceMask && $scope.model.hasOwnProperty(sourceMask) && $scope.model[sourceMask]) // && $scope.model[sourceField]._currentValue) {\r\n            autoGenerateLink = true;\r\n\r\n        autoGenerateLink = true;\r\n        autoGenerateLink = autoGenerateLink && !($scope.value && $scope.value.Value); // only auto-generate if the initial value was blank...\r\n\r\n        // todo: setup watch\r\n        if (autoGenerateLink) {\r\n            // todo\r\n            $scope.$watch('model.Name._currentValue.Value', function() {\r\n                console.log('changed...');\r\n                sourcesChangedTryToUpdate();\r\n            });\r\n            // 1. check the fields we rely on\r\n            // 2. watch them\r\n            // 3. if anything changes...call sourcesChangedTryToUpdate\r\n            // 4. check if the current value.Value is empty - if not, return;\r\n            // 5. otherwise use the new value, clean it, apply. \r\n        }\r\n\r\n        vm.lastAutoCopy = \"\";\r\n        vm.fieldMask = sourceMask;\r\n        function sourcesChangedTryToUpdate() {\r\n            // don't do anything if the current field is not empty and doesn't have the last copy of the stripped value\r\n            if($scope.value && $scope.value.Value && $scope.value.Value !== vm.lastAutoCopy)\r\n                return;\r\n            \r\n            var orig = vm.getFieldContentBasedOnMask();\r\n            var cleaned = stripNonUrlCharacters(orig, false, true);\r\n            if (cleaned) {\r\n                vm.lastAutoCopy = cleaned;\r\n                $scope.value.Value = cleaned;\r\n            }\r\n        }\r\n\r\n        vm.maskRegEx = /\\[.*?\\]/ig;\r\n        vm.getFieldContentBasedOnMask = function getNewAutoValue() {\r\n            var mask = vm.fieldMask; // controlSettings.AddressMask;\r\n            //if (!mask) return \"\";\r\n            ////var tokenRe = /\\[.*?\\]/ig;\r\n            //var matches = mask.match(vm.maskRegEx);\r\n            //angular.forEach(matches, function(e, i) {\r\n            //    var staticName = e.replace(/[\\[\\]]/ig, \"\");\r\n            //    var replaceValue = ($scope.model.hasOwnProperty(staticName) && $scope.model[staticName] !== null) ? $scope.model[staticName]._currentValue.Value : \"\";\r\n            //    mask = mask.replace(e, replaceValue);\r\n            //});\r\n\r\n            angular.forEach(vm.getFieldsOfMask(), function (e, i) {\r\n                //var e = e.replace(/[\\[\\]]/ig, \"\");\r\n                var replaceValue = ($scope.model.hasOwnProperty(e) && $scope.model[e] !== null) ? $scope.model[e]._currentValue.Value : \"\";\r\n                mask = mask.replace(e, replaceValue);\r\n            });\r\n\r\n            return mask;\r\n        };\r\n\r\n        vm.getFieldsOfMask = function () {\r\n            var result = [];\r\n            var mask = vm.fieldMask; \r\n            if (!mask) return \"\";\r\n            var matches = mask.match(vm.maskRegEx);\r\n            angular.forEach(matches, function (e, i) {\r\n                var staticName = e.replace(/[\\[\\]]/ig, \"\");\r\n                result.push(staticName);\r\n                //var replaceValue = ($scope.model.hasOwnProperty(staticName) && $scope.model[staticName] !== null) ? $scope.model[staticName]._currentValue.Value : \"\";\r\n                //mask = mask.replace(e, replaceValue);\r\n            });\r\n            return result;\r\n        };\r\n\r\n\r\n        //#region enforce custom regex - copied from string-default\r\n        var validationRegexString = \".*\";\r\n        var stringSettings = $scope.options.templateOptions.settings.merged;\r\n        if (stringSettings && stringSettings.ValidationRegExJavaScript)\r\n            validationRegexString = stringSettings.ValidationRegExJavaScript;\r\n        vm.regexPattern = new RegExp(validationRegexString, 'i');\r\n\r\n        //#endregion\r\n\r\n        //#region do final cleaning; mainly remove trailing \"/\"\r\n        vm.finalClean = function() {\r\n            var orig = $scope.value.Value;\r\n            var cleaned = stripNonUrlCharacters(orig, false, true);\r\n            if (orig !== cleaned)\r\n                $scope.value.Value = cleaned;\r\n        };\r\n        //#endregion\r\n\r\n        $scope.debug = debugState;\r\n        console.log($scope.options.templateOptions);\r\n    }])\r\n\r\n    // this is a helper which cleans up the url and is used in various places\r\n    .factory(\"stripNonUrlCharacters\", function() {\r\n        return function(inputValue, allowPath, trimEnd) {\r\n            if (inputValue == null)\r\n                return '';\r\n            var rexAllowed = /[^a-z0-9-_]/gi,\r\n                rexSeparators = /[^a-z0-9-_]+/gi,\r\n                rexMult = /-+/gi,\r\n                rexTrim = trimEnd ? /^-|-+$/gi : /^-/gi;\r\n            // allow only lower-case, numbers and _/- characters\r\n            var cleanInputValue = inputValue.replace(rexSeparators, \"-\");\r\n            cleanInputValue = cleanInputValue.replace(rexMult, \"-\");\r\n            cleanInputValue = cleanInputValue.replace(rexAllowed, \"\"); ///[^\\w\\s]/gi, '');\r\n            cleanInputValue = cleanInputValue.replace(rexTrim, \"\");\r\n            return cleanInputValue;\r\n        }\r\n    })\r\n\r\n    // this monitors an input-field and ensures that only allowed characters are typed\r\n    .directive('onlySimpleUrlChars', [\"stripNonUrlCharacters\", function(stripNonUrlCharacters) {\r\n        return {\r\n            require: 'ngModel',\r\n            restrict: 'A',\r\n            link: function(scope, element, attrs, modelCtrl) {\r\n                modelCtrl.$parsers.push(function(inputValue) {\r\n                    if (inputValue == null)\r\n                        return '';\r\n                    var cleanInputValue = stripNonUrlCharacters(inputValue, false, false);\r\n\r\n                    if (cleanInputValue !== inputValue) {\r\n                        modelCtrl.$setViewValue(cleanInputValue);\r\n                        modelCtrl.$render();\r\n                    }\r\n                    return cleanInputValue;\r\n                });\r\n            }\r\n        }\r\n    }]);\r\n\n/* global angular */\r\n(function () {\r\n    /* jshint laxbreak:true*/\r\n    \"use strict\";\r\n\r\n    var app = angular.module(\"eavEditEntity\");\r\n\r\n    // The controller for the main form directive\r\n    app.controller(\"EditEntities\", [\"appId\", \"$http\", \"$scope\", \"entitiesSvc\", \"toastr\", \"saveToastr\", \"$translate\", \"debugState\", \"ctrlS\", function editEntityCtrl(appId, $http, $scope, entitiesSvc, toastr, saveToastr, $translate, debugState, ctrlS) {\r\n\r\n        var vm = this;\r\n        vm.debug = debugState;\r\n        vm.isWorking = 0;           // isWorking is > 0 when any $http request runs\r\n        vm.registeredControls = []; // array of input-type controls used in these forms\r\n        vm.items = null;            // array of items to edit\r\n        vm.willPublish = false;     // default is won't publish, but will usually be overridden\r\n\r\n        //#region activate / deactivate + bindings\r\n        // the activate-command, to intialize everything. Must be called later, when all methods have been attached\r\n        function activate() {\r\n            // bind ctrl+S\r\n            vm.saveShortcut = ctrlS(function () { vm.save(); });\r\n\r\n            // load all data\r\n            vm.loadAll();\r\n        }\r\n\r\n        // clean-up call when the dialog is closed\r\n        function deactivate() {\r\n            vm.saveShortcut.unbind();\r\n        }\r\n\r\n        // bind the clean-up call to when the dialog is removed\r\n        $scope.$on(\"$destroy\", function () {\r\n            deactivate();\r\n        });\r\n        //#endregion\r\n\r\n        // add an additional input-type control for lazy-loading etc.\r\n        vm.registerEditControl = function (control) {\r\n            vm.registeredControls.push(control);\r\n        };\r\n\r\n        //#region load / save\r\n\r\n        // load all data\r\n        vm.loadAll = function() {\r\n            entitiesSvc.getManyForEditing(appId, $scope.itemList)\r\n                .then(function(result) {\r\n                    vm.items = result.data;\r\n                    angular.forEach(vm.items, function(v, i) {\r\n\r\n                        // If the entity is null, it does not exist yet. Create a new one\r\n                        if (!vm.items[i].Entity && !!vm.items[i].Header.ContentTypeName)\r\n                            vm.items[i].Entity = entitiesSvc.newEntity(vm.items[i].Header);\r\n\r\n                        vm.items[i].Entity = enhanceEntity(vm.items[i].Entity);\r\n\r\n                        // set slot value - must be inverte for boolean-switch\r\n                        var grp = vm.items[i].Header.Group;\r\n                        vm.items[i].slotIsUsed = (grp === null\r\n                            || grp.SlotIsEmpty !== true);\r\n                    });\r\n                    vm.willPublish = vm.items[0].Entity.IsPublished;\r\n                });\r\n        };\r\n\r\n        vm.showFormErrors = function() {\r\n                var errors = vm.formErrors();\r\n                var msgs = [], msgTemplate = $translate.instant(\"Message.FieldErrorList\");\r\n                for (var set = 0; set < errors.length; set++) {\r\n                    if (errors[set].required) {\r\n                        var req = errors[set].required.map(function (itm) { return { field: itm.$name, error: \"required\" }; });\r\n                        msgs = msgs.concat(req);\r\n                    }\r\n                }\r\n                var nice = msgs.map(function (err) {\r\n                    var specs = err.field.split(\"_\");\r\n\r\n                    return msgTemplate.replace(\"{form}\", specs[1])\r\n                        .replace(\"{field}\", specs[3])\r\n                        .replace(\"{error}\", err.error);\r\n                });\r\n            var msg = nice.join(\"<br/>\");\r\n            return toastr.error($translate.instant(\"Message.CantSaveInvalid\").replace(\"{0}\", msg),\r\n                $translate.instant(\"Message.Error\"), { allowHtml: true }); \r\n        };\r\n\r\n        // the save-call\r\n        vm.save = function (close) {\r\n            // check if saving is allowed\r\n            if (!vm.isValid()) \r\n                return vm.showFormErrors();\r\n\r\n            if (vm.isWorking > 0)\r\n                return toastr.error($translate.instant(\"Message.CantSaveProcessing\")); // todo: i18n\r\n\r\n            // save\r\n            vm.isWorking++;\r\n            saveToastr(entitiesSvc.saveMany(appId, vm.items)).then(function (result) {\r\n                $scope.state.setPristine();\r\n                if (close)\r\n                    vm.afterSaveEvent(result);\r\n                vm.isWorking--;\r\n            }, function errorWhileSaving(response) {\r\n                vm.isWorking--;\r\n            });\r\n        };\r\n\r\n        // things to do after saving\r\n        vm.afterSaveEvent = $scope.afterSaveEvent;\r\n\r\n        //#endregion\r\n\r\n        //#region state check/set for valid/dirty/pristine\r\n        // check if form is valid\r\n        vm.isValid = function () {\r\n            var valid = true;\r\n            angular.forEach(vm.registeredControls, function (e, i) {\r\n                if (!e.isValid())\r\n                    valid = false;\r\n            });\r\n            return valid;\r\n        };\r\n\r\n        vm.formErrors = function () {\r\n            var list = [];\r\n            angular.forEach(vm.registeredControls, function (e, i) {\r\n                if (!e.isValid())\r\n                    list.push(e.error());\r\n            });\r\n            return list;\r\n        };\r\n\r\n        // check if dirty\r\n        $scope.state.isDirty = function() {\r\n            var dirty = false;\r\n            angular.forEach(vm.registeredControls, function(e, i) {\r\n                if (e.isDirty())\r\n                    dirty = true;\r\n            });\r\n            return dirty;\r\n        };\r\n\r\n        // set to not-dirty (pristine)\r\n        $scope.state.setPristine = function() {\r\n            angular.forEach(vm.registeredControls, function(e, i) {\r\n                e.setPristine();\r\n            });\r\n        };\r\n        //#endregion\r\n\r\n        // monitor for changes in publish-state and set it for all items being edited\r\n        $scope.$watch('vm.willPublish', function (newValue, oldValue) {\r\n            angular.forEach(vm.items, function (v, i) {\r\n                vm.items[i].Entity.IsPublished = vm.willPublish;\r\n            });\r\n        });\r\n\r\n        /// toggle / change if a section (slot) is in use or not (like an unused presentation)\r\n        vm.toggleSlotIsEmpty = function (item) {\r\n            if (!item.Header.Group)\r\n                item.Header.Group = {};\r\n            item.Header.Group.SlotIsEmpty = !item.Header.Group.SlotIsEmpty;\r\n            item.slotIsUsed = !item.Header.Group.SlotIsEmpty;\r\n        };\r\n\r\n        activate();\r\n\r\n    }]);\r\n\r\n\r\n\r\n})();\n\r\n(function () {\r\n    \"use strict\";\r\n\r\n    var app = angular.module(\"eavEditEntity\");\r\n\r\n    app.directive(\"eavEditEntities\", function () {\r\n        return {\r\n            templateUrl: \"form/edit-many-entities.html\",\r\n            restrict: \"E\",\r\n            scope: {\r\n                itemList: \"=\",\r\n                afterSaveEvent: \"=\",\r\n                state: \"=\"\r\n            },\r\n            controller: \"EditEntities\",\r\n            controllerAs: \"vm\"\r\n        };\r\n    });\r\n\r\n\r\n})();\n\r\n(function () {\r\n    /* jshint laxbreak:true */\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module(\"eavEditEntity\"); \r\n\r\n\t// The controller for the main form directive\r\n\tapp.controller(\"EditEntityFormCtrl\", [\"appId\", \"$http\", \"$scope\", \"formlyConfig\", \"contentTypeFieldSvc\", \"$sce\", \"debugState\", \"customInputTypes\", \"eavConfig\", function editEntityCtrl(appId, $http, $scope, formlyConfig, contentTypeFieldSvc, $sce, debugState, customInputTypes, eavConfig) {\r\n\r\n\t\tvar vm = this;\r\n\t\tvm.editInDefaultLanguageFirst = function () {\r\n\t\t\treturn false; // ToDo: Use correct language information, e.g. eavLanguageService.currentLanguage != eavLanguageService.defaultLanguage && !$scope.entityId;\r\n\t\t};\r\n\r\n\t\t// The control object is available outside the directive\r\n\t\t// Place functions here that should be available from the parent of the directive\r\n\t\tvm.control = {\r\n\t\t    isValid: function () { return vm.formFields.length === 0 || vm.form && vm.form.$valid; },\r\n\t\t    isDirty: function () { return (vm.form && vm.form.$dirty); },\r\n\t\t    setPristine: function () { if (vm.form) vm.form.$setPristine(); },\r\n            error: function () { return vm.form.$error; }\r\n\t\t};\r\n\r\n\t\t// Register this control in the parent control\r\n\t\tif($scope.registerEditControl)\r\n\t\t\t$scope.registerEditControl(vm.control);\r\n\r\n\t\tvm.model = null;\r\n\t\tvm.entity = $scope.entity;\r\n\r\n\t\tvm.formFields = [];\r\n\r\n\r\n\t\tvar loadContentType = function () {\r\n\r\n\t\t    contentTypeFieldSvc(appId, { StaticName: vm.entity.Type.StaticName }).getFields()\r\n\t\t        .then(function(result) {\r\n\t\t            vm.debug = result;\r\n\r\n\t\t            // Transform EAV content type configuration to formFields (formly configuration)\r\n\r\n                    // first: add all custom types to re-load these scripts and styles\r\n\t\t            angular.forEach(result.data, function (e, i) {\r\n\t\t                // check in config input-type replacement map if the specified type should be replaced by another\r\n\t\t                //if (e.InputType && eavConfig.formly.inputTypeReplacementMap[e.InputType]) \r\n\t\t                //    e.InputType = eavConfig.formly.inputTypeReplacementMap[e.InputType];\r\n\r\n\r\n\t\t                // review type and get additional configs!\r\n\t\t                e.InputType = vm.getType(e);\r\n\t\t                eavConfig.formly.inputTypeReconfig(e);  // provide custom overrides etc. if necessary\r\n\r\n\t\t                if (e.InputTypeConfig)\r\n\t\t                    customInputTypes.addInputType(e);\r\n\t\t            });\r\n\r\n\t\t            // load all assets before continuing with formly-binding\r\n\t\t            var promiseToLoad = customInputTypes.loadWithPromise();\r\n\t\t            promiseToLoad.then(function(dependencyResult) {\r\n\t\t                vm.registerAllFieldsFromReturnedDefinition(result);\r\n\t\t            });\r\n\r\n\r\n\t\t        });\r\n\t\t};\r\n\r\n\t    vm.registerAllFieldsFromReturnedDefinition = function raffrd(result) {\r\n\t        var lastGroupHeadingId = 0;\r\n\t        angular.forEach(result.data, function (e, i) {\r\n\r\n\t            if (e.Metadata.All === undefined)\r\n\t                e.Metadata.All = {};\r\n\r\n\t            var fieldType = e.InputType;\r\n\r\n\t            // always remember the last heading so all the following fields know to look there for collapse-setting\r\n\t            var isFieldHeading = (fieldType === \"empty-default\");\r\n\t            if (isFieldHeading)\r\n\t                lastGroupHeadingId = i;\r\n                \r\n\t            var nextField = {\r\n\t                key: e.StaticName,\r\n\t                type: fieldType,\r\n\t                templateOptions: {\r\n\t                    required: !!e.Metadata.All.Required,\r\n\t                    label: e.Metadata.All.Name === undefined ? e.StaticName : e.Metadata.All.Name,\r\n\t                    description: $sce.trustAsHtml(e.Metadata.All.Notes),\r\n\t                    settings: e.Metadata,\r\n\t                    header: $scope.header,\r\n\t                    canCollapse: lastGroupHeadingId > 0 && !isFieldHeading,\r\n\t                    fieldGroup: vm.formFields[lastGroupHeadingId],\r\n\t                    disabled: e.Metadata.All.Disabled,\r\n\t                    langReadOnly: false // Will be set by the language directive to override the disabled state\r\n\t                },\r\n\t                className: \"type-\" + e.Type.toLowerCase() + \" input-\" + fieldType + \" field-\" + e.StaticName.toLowerCase(),\r\n\t                hide: (e.Metadata.All.VisibleInEditUI === false ? !debugState.on : false),\r\n\t                expressionProperties: {\r\n\t                    // Needed for dynamic update of the disabled property\r\n\t                    'templateOptions.disabled': 'options.templateOptions.disabled' // doesn't set anything, just here to ensure formly causes update-binding\r\n\t                },\r\n\t                watcher: [\r\n                        {\r\n                            // changes when a entity becomes enabled / disabled\r\n                            expression: function (field, scope, stop) {\r\n                                return e.Metadata.All.Disabled ||\r\n                                    (field.templateOptions.header.Group && field.templateOptions.header.Group.SlotIsEmpty) ||\r\n                                    field.templateOptions.langReadOnly;\r\n                            },\r\n                            listener: function (field, newValue, oldValue, scope, stopWatching) {\r\n                                field.templateOptions.disabled = newValue;\r\n                            }\r\n                        },\r\n                        {\r\n                            // handle collapse / open\r\n                            expression: function (field, scope, stop) {\r\n                                // only change values if it can collapse...\r\n                                return (field.templateOptions.canCollapse) ? field.templateOptions.fieldGroup.templateOptions.collapseGroup : null;\r\n                            },\r\n                            listener: function (field, newValue, oldValue, scope, stopWatching) {\r\n                                if (field.templateOptions.canCollapse)\r\n                                    field.templateOptions.collapse = newValue;\r\n                            }\r\n                        }\r\n\t                ]\r\n\t            };\r\n\r\n\t            vm.formFields.push(nextField);\r\n\t        });\r\n\t    };\r\n\r\n\r\n\t    // Load existing entity if defined\r\n\t\tif (vm.entity !== null)\r\n\t\t    loadContentType();\r\n\r\n\r\n\t    // Returns the field type for an attribute configuration\r\n\t\tvm.getType = function (attributeConfiguration) {\r\n\t\t    var e = attributeConfiguration;\r\n\t\t    var type = e.Type.toLowerCase();\r\n\t\t    var inputType = \"\";\r\n\r\n\t\t    // new: the All can - and should - have an input-type which doesn't change\r\n\t\t    // First look in Metadata.All if an InputType is defined (All should override the setting, which is not the case when using only merged)\r\n\t\t    if (e.InputType !== \"unknown\") // the input type of @All is here from the web service // Metadata.All && e.Metadata.All.InputType)\r\n\t\t        inputType = e.InputType;\r\n\t\t        // If not, look in merged\r\n\t\t    else if (e.Metadata.merged && e.Metadata.merged.InputType)\r\n\t\t        inputType = e.Metadata.merged.InputType;\r\n\r\n\t\t    if (inputType && inputType.indexOf(\"-\") === -1) // has input-type, but missing main type, this happens with old types like string wysiyg\r\n\t\t        inputType = type + \"-\" + inputType;\r\n\r\n\t\t    var willBeRewrittenByConfig = (inputType && eavConfig.formly.inputTypeReplacementMap[inputType]);\r\n\t\t    if (!willBeRewrittenByConfig) {\r\n\t\t        // this type may have assets, so the definition may be late-loaded\r\n\t\t        var typeAlreadyRegistered = formlyConfig.getType(inputType);    // check if this input-type actually exists - so \"string-i-made-this-up\" will return undefined\r\n\t\t        var typeWillRegisterLaterWithAssets = (e.InputTypeConfig ? !!e.InputTypeConfig.Assets : false); // if it will load assets later, then it may still be defined then\r\n\r\n\t\t        // Use subtype 'default' if none is specified - or type does not exist\r\n\t\t        if (!inputType || (!typeAlreadyRegistered && !typeWillRegisterLaterWithAssets))\r\n\t\t            inputType = type + \"-default\";\r\n\r\n\t\t        // but re-check if it's in the config! since the name might have changed\r\n\t\t        willBeRewrittenByConfig = (inputType && eavConfig.formly.inputTypeReplacementMap[inputType]);\r\n\t\t    }\r\n\r\n\t\t    // check in config input-type replacement map if the specified type should be replaced by another\r\n\t\t    // like \"string-wysiwyg\" replaced by \"string-wysiwyg-tinymce\"\r\n\t\t    if (willBeRewrittenByConfig)\r\n\t\t        inputType = eavConfig.formly.inputTypeReplacementMap[inputType];\r\n\r\n\t\t    return (inputType);\r\n\t\t};\r\n\t}]);\r\n    \r\n\t\r\n\r\n})();\n\r\n(function () {\r\n\t\"use strict\";\r\n\r\n\tangular.module(\"eavEditEntity\")\r\n        .directive(\"eavEditEntityForm\", function () {\r\n\t\treturn {\r\n\t\t    templateUrl: \"form/edit-single-entity.html\",\r\n\t\t\trestrict: \"E\",\r\n\t\t\tscope: {\r\n\t\t\t    entity: \"=\",\r\n                header: \"=\",\r\n                registerEditControl: \"=\"\r\n\t\t\t},\r\n\t\t\tcontroller: \"EditEntityFormCtrl\",\r\n\t\t\tcontrollerAs: \"vm\"\r\n\t\t};\r\n\t});\r\n\t\r\n\r\n})();\n/* global angular */\r\n(function () {\r\n\t\"use strict\";\r\n\r\n\tvar app = angular.module(\"eavEditEntity\");\r\n\r\n\t// The controller for the main form directive\r\n\tapp.controller(\"EditEntityWrapperCtrl\", [\"$q\", \"$http\", \"$scope\", \"items\", \"$modalInstance\", \"$window\", \"$translate\", function editEntityCtrl($q, $http, $scope, items, $modalInstance, $window, $translate) {\r\n\r\n\t    var vm = this;\r\n\t    vm.itemList = items;\r\n\r\n\t    // this is the callback after saving - needed to close everything\r\n\t    vm.afterSave = function(result) {\r\n\t        if (result.status === 200)\r\n\t            vm.close(result);\r\n\t        else {\r\n\t            alert($translate.instant(\"Errors.UnclearError\"));\r\n\t        }\r\n\t    };\r\n\r\n\t    vm.state = {\r\n\t        isDirty: function() {\r\n\t            throw $translate.instant(\"Errors.InnerControlMustOverride\");\r\n\t        }\r\n\t    };\r\n\r\n\t    vm.close = function (result) {\r\n\t\t    $modalInstance.close(result);\r\n\t\t};\r\n\r\n\r\n\t    vm.maybeLeave = function maybeLeave(e) {\r\n\t        var unsavedChangesText = $translate.instant(\"Errors.UnsavedChanges\");\r\n\t        if (vm.state.isDirty() && !confirm(unsavedChangesText + \" \" + $translate.instant(\"Message.ExitOk\")))\r\n\t            e.preventDefault();\r\n\t    };\r\n\r\n\t    $scope.$on('modal.closing', vm.maybeLeave);\r\n\t    $window.addEventListener('beforeunload', function (e) {\r\n\t        var unsavedChangesText = $translate.instant(\"Errors.UnsavedChanges\");\r\n\t        if (vm.state.isDirty()) {\r\n\t            (e || window.event).returnValue = unsavedChangesText; //Gecko + IE\r\n\t            return unsavedChangesText; //Gecko + Webkit, Safari, Chrome etc.\r\n\t        }\r\n\t        return null;\r\n\t    });\r\n\t}]);\r\n\r\n})();\n\r\n(function () {\r\n\t\"use strict\";\r\n\r\n\r\n\t/* This app handles all aspectes of the multilanguage features of the field templates */\r\n\r\n\tvar eavLocalization = angular.module(\"eavLocalization\", [\"formly\", \"EavConfiguration\"], [\"formlyConfigProvider\", function (formlyConfigProvider) {\r\n\r\n\t\t// Field templates that use this wrapper must bind to value.Value instead of model[...]\r\n\t\tformlyConfigProvider.setWrapper([\r\n\t\t\t{\r\n\t\t\t\tname: \"eavLocalization\",\r\n\t\t\t\ttemplateUrl: \"localization/formly-localization-wrapper.html\"\r\n\t\t\t}\r\n\t\t]);\r\n\r\n\t}]);\r\n\r\n\teavLocalization.directive(\"eavLanguageSwitcher\", function () {\r\n\t\treturn {\r\n\t\t\trestrict: \"E\",\r\n\t\t\ttemplateUrl: \"localization/language-switcher.html\",\r\n\t\t\tcontroller: [\"$scope\", \"languages\", function($scope, languages) {\r\n\t\t\t\t$scope.languages = languages;\r\n\t\t\t}],\r\n\t\t\tscope: {\r\n\t\t\t    isDisabled: \"=isDisabled\"\r\n\t\t\t}\r\n\t\t};\r\n\t});\r\n\r\n\teavLocalization.directive(\"eavLocalizationScopeControl\", function () {\r\n\t\treturn {\r\n\t\t\trestrict: \"E\",\r\n\t\t\ttransclude: true,\r\n\t\t\ttemplate: \"\",\r\n\t\t\tlink: function (scope, element, attrs) {\r\n\t\t\t},\r\n\t\t\tcontroller: [\"$scope\", \"$filter\", \"$translate\", \"eavDefaultValueService\", \"languages\", function ($scope, $filter, $translate, eavDefaultValueService, languages) { // Can't use controllerAs because of transcluded scope\r\n\r\n\t\t\t\tvar scope = $scope;\r\n\t\t\t\tvar langConf = languages;\r\n\r\n\t\t\t\tvar initCurrentValue = function() {\r\n\r\n\t\t\t\t\t// Set base value object if not defined\r\n\t\t\t\t\tif (!scope.model[scope.options.key])\r\n\t\t\t\t\t\tscope.model.addAttribute(scope.options.key);\r\n\r\n\t\t\t\t\tvar fieldModel = scope.model[scope.options.key];\r\n\r\n\t\t\t\t\t// If current language = default language and there are no values, create an empty value object\r\n\t\t\t\t\tif (fieldModel.Values.length === 0) {\r\n\t\t\t\t\t    if (langConf.currentLanguage == langConf.defaultLanguage) {\r\n\t\t\t\t\t        var defaultValue = eavDefaultValueService(scope.options);\r\n                            // Add default language if we are in a ml environment, else don't add any\r\n\t\t\t\t\t        var languageToAdd = langConf.languages.length > 0 ? langConf.currentLanguage : null;\r\n\t\t\t\t\t        fieldModel.addVs(defaultValue, languageToAdd);\r\n\t\t\t\t\t    }\r\n\t\t\t\t\t    else { // There are no values - value must be edited in default language first\r\n\t\t\t\t\t        return;\r\n\t\t\t\t\t    }\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t    // Assign default language if no dimension is set - new: if multiple languages are in use!!!\r\n\t\t\t\t\tif (Object.keys(fieldModel.Values[0].Dimensions).length === 0)\r\n                        if(langConf.languages.length > 0)\r\n\t\t\t\t            fieldModel.Values[0].Dimensions[langConf.defaultLanguage] = false; // set to \"not-read-only\"\r\n\r\n\t\t\t\t\tvar valueToEdit;\r\n\r\n\t\t\t\t\t// Decide which value to edit:\r\n\t\t\t\t\t// 1. If there is a value with current dimension on it, use it\r\n\t\t\t\t\tvalueToEdit = $filter(\"filter\")(fieldModel.Values, function(v, i) {\r\n\t\t\t\t\t\treturn v.Dimensions[langConf.currentLanguage] !== undefined;\r\n\t\t\t\t\t})[0];\r\n\r\n\t\t\t\t\t// 2. Use default language value\r\n\t\t\t\t\tif (valueToEdit === undefined)\r\n\t\t\t\t\t\tvalueToEdit = $filter(\"filter\")(fieldModel.Values, function(v, i) {\r\n\t\t\t\t\t\t\treturn v.Dimensions[langConf.defaultLanguage] !== undefined;\r\n\t\t\t\t\t\t})[0];\r\n\r\n\t\t\t\t\t// 3. Use the first value if there is only one\r\n\t\t\t\t\tif (valueToEdit === undefined) {\r\n\t\t\t\t\t\tif (fieldModel.Values.length > 1)\r\n\t\t\t\t\t\t    throw $translate.instant(\"Errors.DefLangNotFound\") + \" \" + $scope.options.key;\r\n\t\t\t\t\t\t// Use the first value\r\n\t\t\t\t\t\tvalueToEdit = fieldModel.Values[0];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfieldModel._currentValue = valueToEdit;\r\n\r\n\t\t\t\t\t// Set scope variable 'value' to simplify binding\r\n\t\t\t\t\tscope.value = fieldModel._currentValue;\r\n\r\n\t\t\t\t    // Decide whether the value is writable or not\r\n\t\t\t\t\tvar writable = (langConf.currentLanguage == langConf.defaultLanguage) ||\r\n                        (scope.value && scope.value.Dimensions[langConf.currentLanguage] === false);\r\n\r\n\t\t\t\t\tscope.to.langReadOnly = !writable;\r\n\t\t\t\t};\r\n\r\n\t\t\t\tinitCurrentValue();\r\n\r\n\t\t\t\t// Handle language switch\r\n\t\t\t\tscope.langConf = langConf; // Watch does only work on scope variables\r\n\t\t\t\tscope.$watch(\"langConf.currentLanguage\", function (newValue, oldValue) {\r\n\t\t\t\t\tif (oldValue === undefined || newValue == oldValue)\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\tinitCurrentValue();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// ToDo: Could cause performance issues (deep watch array)...\r\n\t\t\t\tscope.$watch(\"model[options.key].Values\", function(newValue, oldValue) {\r\n\t\t\t\t\tinitCurrentValue();\r\n\t\t\t\t}, true);\r\n\r\n\t\t\t\t// The language menu must be able to trigger an update of the _currentValue property\r\n\t\t\t\tscope.model[scope.options.key]._initCurrentValue = initCurrentValue;\r\n\t\t\t}]\r\n\t\t};\r\n\t});\r\n\r\n\teavLocalization.directive(\"eavLocalizationMenu\", function () {\r\n\t\treturn {\r\n\t\t\trestrict: \"E\",\r\n\t\t\tscope: {\r\n\t\t\t\tfieldModel: \"=fieldModel\",\r\n\t\t\t\toptions: \"=options\",\r\n\t\t\t\tvalue: \"=value\",\r\n\t\t\t\tindex: \"=index\",\r\n                formModel: \"=formModel\"\r\n\t\t\t},\r\n\t\t\ttemplateUrl: \"localization/localization-menu.html\",\r\n\t\t\tlink: function (scope, element, attrs) { },\r\n\t\t\tcontrollerAs: \"vm\",\r\n\t\t\tcontroller: [\"$scope\", \"languages\", \"$translate\", function ($scope, languages, $translate) {\r\n\r\n\t\t\t    var vm = this;\r\n\t\t\t    var lblDefault = $translate.instant(\"LangMenu.UseDefault\");\r\n\t\t\t    var lblIn = $translate.instant(\"LangMenu.In\");\r\n\r\n\t\t\t\tvm.fieldModel = $scope.fieldModel;\r\n\t\t\t\tvm.languages = languages;\r\n\t\t\t\tvm.hasLanguage = function(languageKey) {\r\n\t\t\t\t    return vm.fieldModel.getVsWithLanguage(languageKey) !== null;\r\n\t\t\t\t};\r\n\r\n\t\t\t\tvm.isDefaultLanguage = function () { return languages.currentLanguage != languages.defaultLanguage; };\r\n\t\t\t\tvm.enableTranslate = function () { return vm.fieldModel.getVsWithLanguage(languages.currentLanguage) === null; };\r\n\r\n\t\t\t\tvm.infoMessage = function () {\r\n\t\t\t\t    if (Object.keys($scope.value.Dimensions).length === 1 && $scope.value.Dimensions[languages.defaultLanguage] === false)\r\n\t\t\t\t        return lblDefault;\r\n\t\t\t\t    if (Object.keys($scope.value.Dimensions).length === 1 && $scope.value.Dimensions[languages.currentLanguage] === false)\r\n\t\t\t\t        return \"\";\r\n\t\t\t\t    return $translate.instant(\"LangMenu.In\", { languages: Object.keys($scope.value.Dimensions).join(\", \") });\r\n\t\t\t\t    // \"in \" + Object.keys($scope.value.Dimensions).join(\", \");\r\n\t\t\t\t};\r\n\r\n\t\t\t\tvm.tooltip = function () {\r\n\t\t\t\t    var editableIn = [];\r\n\t\t\t\t    var usedIn = [];\r\n\t\t\t\t    angular.forEach($scope.value.Dimensions, function (value, key) {\r\n\t\t\t\t        (value ? usedIn : editableIn).push(key);\r\n\t\t\t\t    });\r\n\t\t\t\t    var tooltip = $translate.instant(\"LangMenu.EditableIn\", { languages: editableIn.join(\", \") }); // \"editable in \" + editableIn.join(\", \");\r\n\t\t\t\t    if (usedIn.length > 0)\r\n\t\t\t\t        tooltip += $translate.instant(\"LangMenu.AlsoUsedIn\", { languages: usedIn.join(\", \") });// \", also used in \" + usedIn.join(\", \");\r\n\t\t\t\t    return tooltip;\r\n\t\t\t\t};\r\n\r\n\t\t\t\tvm.actions = {\r\n\t\t\t\t    toggleTranslate: function toggleTranslate() {\r\n\t\t\t\t        if (vm.enableTranslate())\r\n\t\t\t\t            vm.actions.translate();\r\n\t\t\t\t        else\r\n\t\t\t\t            vm.actions.linkDefault();\r\n\t\t\t\t    },\r\n\t\t\t\t    translate: function translate() {\r\n\t\t\t\t        if (vm.enableTranslate()) {\r\n\t\t\t\t            vm.fieldModel.removeLanguage(languages.currentLanguage);\r\n\t\t\t\t            vm.fieldModel.addVs($scope.value.Value, languages.currentLanguage, false);\r\n\t\t\t\t        }\r\n\t\t\t\t    },\r\n\t\t\t\t    linkDefault: function linkDefault() {\r\n\t\t\t\t        vm.fieldModel.removeLanguage(languages.currentLanguage);\r\n\t\t\t\t    },\r\n\t\t\t\t    autoTranslate: function (languageKey) {\r\n\t\t\t\t        // Google translate is not implemented yet, because\r\n                        // there is no longer a free api.\r\n\t\t\t\t        alert($translate.instant(\"LangMenu.NotImplemented\"));\r\n\t\t\t\t    },\r\n\t\t\t\t    copyFrom: function (languageKey) {\r\n\t\t\t\t        if ($scope.options.templateOptions.disabled)\r\n\t\t\t\t            alert($translate.instant(\"LangMenu.CopyNotPossible\"));\r\n\t\t\t\t        else {\r\n\t\t\t\t            var value = vm.fieldModel.getVsWithLanguage(languageKey).Value;\r\n\t\t\t\t            if (vs === null || vs === undefined)\r\n\t\t\t\t                console.log($scope.options.key + \": Can't copy value from \" + languageKey + ' because that value does not exist.');\r\n\t\t\t\t            else\r\n\t\t\t\t                $scope.value.Value = value;\r\n\t\t\t\t        }\r\n\t\t\t\t    },\r\n\t\t\t\t    useFrom: function (languageKey) {\r\n\t\t\t\t        var vs = vm.fieldModel.getVsWithLanguage(languageKey);\r\n\t\t\t\t        if (vs === null || vs === undefined)\r\n\t\t\t\t            console.log($scope.options.key + \": Can't use value from \" + languageKey + ' because that value does not exist.');\r\n\t\t\t\t        else {\r\n\t\t\t\t            vm.fieldModel.removeLanguage(languages.currentLanguage);\r\n\t\t\t\t            vs.setLanguage(languages.currentLanguage, true);\r\n\t\t\t\t        }\r\n\t\t\t\t    },\r\n\t\t\t\t    shareFrom: function (languageKey) {\r\n\t\t\t\t        var vs = vm.fieldModel.getVsWithLanguage(languageKey);\r\n\t\t\t\t        if (vs === null || vs === undefined)\r\n\t\t\t\t            console.log($scope.options.key + \": Can't share value from \" + languageKey + ' because that value does not exist.');\r\n\t\t\t\t        else {\r\n\t\t\t\t            vm.fieldModel.removeLanguage(languages.currentLanguage);\r\n\t\t\t\t            vs.setLanguage(languages.currentLanguage, false);\r\n\t\t\t\t        }\r\n\t\t\t\t    },\r\n\t\t\t\t    all: {\r\n\t\t\t\t        translate: function translate() {\r\n\t\t\t\t            forAllMenus('translate');\r\n\t\t\t\t        },\r\n\t\t\t\t        linkDefault: function linkDefault() {\r\n\t\t\t\t            forAllMenus('linkDefault');\r\n\t\t\t\t        },\r\n\t\t\t\t        copyFrom: function (languageKey) {\r\n\t\t\t\t            forAllMenus('copyFrom', languageKey);\r\n\t\t\t\t        },\r\n\t\t\t\t        useFrom: function (languageKey) {\r\n\t\t\t\t            forAllMenus('useFrom', languageKey);\r\n\t\t\t\t        },\r\n\t\t\t\t        shareFrom: function (languageKey) {\r\n\t\t\t\t            forAllMenus('shareFrom', languageKey);\r\n\t\t\t\t        }\r\n\t\t\t\t    }\r\n\t\t\t\t};\r\n\r\n\t\t\t    // Collect all localizationMenus (to enable \"all\" actions)\r\n\t\t\t\tif ($scope.formModel.localizationMenus === undefined)\r\n\t\t\t\t    $scope.formModel.localizationMenus = [];\r\n\t\t\t\t$scope.formModel.localizationMenus.push(vm.actions);\r\n\r\n\t\t\t\tvar forAllMenus = function (action, languageKey) {\r\n\t\t\t\t    for (var i = 0; i < $scope.formModel.localizationMenus.length; i++) {\r\n\t\t\t\t        $scope.formModel.localizationMenus[i][action](languageKey);\r\n\t\t\t\t    }\r\n\t\t\t\t};\r\n\t\t\t}]\r\n\t\t};\r\n\t});\r\n\r\n\teavLocalization.directive(\"eavTreatTimeUtc\", function () {\r\n\t    var directive = {\r\n\t        restrict: \"A\",\r\n\t        require: [\"ngModel\"],\r\n            compile: compile,\r\n\t        link: link\r\n\t    };\r\n\t    return directive;\r\n\r\n\t    function compile(element, attributes) {\r\n\r\n\t    }\r\n\r\n\t    function link(scope, element, attributes, modelController) {     \r\n\t        modelController[0].$formatters.push(function (modelValue) {\r\n\r\n\t            return modelValue;\r\n\t        });\r\n\r\n\t        modelController[0].parsers.push(function (viewValue) {\r\n\r\n\t            return viewValue;\r\n\t        });\r\n\t    }\r\n\t});\r\n})();\n\r\n\r\n// Note: the entity-reader is meant for admin-purposes. \r\n// It does not try to do fallback, because the admin-UI MUST know the real data\r\nfunction enhanceEntity(entity) {\r\n    var enhancer = this; \r\n\r\n    enhancer.enhanceWithCount = function (obj) {\r\n        obj.count = function () {\r\n            var key, count = 0;\r\n            for (key in this)\r\n                if (this.hasOwnProperty(key) && typeof this[key] != 'function')\r\n                    count++;\r\n            return count;\r\n        };\r\n    }; \r\n\r\n    // this will enhance a Values with necessary methods\r\n    enhancer.enhanceVs = function (vs) {\r\n        vs.hasLanguage = function (language) { return this.Dimensions.hasOwnProperty(language); };\r\n        vs.setLanguage = function (language, shareMode) { this.Dimensions[language] = shareMode; };\r\n        vs.languageMode = function(language) { return (this.hasLanguage(language)) ? this.Dimensions[language] : null; };\r\n\r\n        // ToDo: Fix enhance dimensions - or use alternative Object.keys(vs.Dimensions).length\r\n        //if(typeof vs.Dimensions != \"undefined\")\r\n            //enhancer.enhanceWithCount(vs.Dimensions);\r\n        return vs;\r\n    };\r\n\r\n    // this will enhance an attribute\r\n    enhancer.enhanceAtt = function(att) {\r\n        att.getVsWithLanguage = function(language) {\r\n            // try to find it based on the language - it then has a property matching the language\r\n            for (var v = 0; v < this.Values.length; v++)\r\n                if (this.Values[v].hasLanguage(language))\r\n                    return this.Values[v];\r\n\r\n            // if we don't find it, we must report it back as such\r\n            return null;\r\n        };\r\n\r\n        att.setLanguageToVs = function(vs, language, shareMode) {\r\n            // check if it's already there, if yes, just ensure shareMode, then done\r\n            if (vs.hasLanguage(language))\r\n                return vs.setLanguage(language, shareMode);\r\n\r\n            // otherwise find the language if it's anywhere else and remove that first; \r\n            // note that this might delete a value set, so we should only do it after checking if it wasn't already right\r\n            this.removeLanguage(language);\r\n\r\n            // now set it anew\r\n            return vs.setLanguage(language, shareMode);\r\n        };\r\n\r\n        att.removeLanguage = function(language) {\r\n            var value = this.getVsWithLanguage(language);\r\n            if (value === null)\r\n                return;\r\n            delete value.Dimensions[language];\r\n\r\n            // check if the vs still has any properties left, if not, remove it entirely - unless it's the last one...\r\n            if (Object.keys(value.Dimensions).length === 0 && this.Values.length > 0)\r\n                this.removeVs(value);\r\n        };\r\n\r\n        att.removeVs = function(vs) {\r\n            for (var v = 0; v < this.Values.length; v++)\r\n                if (this.Values[v] === vs)\r\n                    this.Values.splice(v, 1);\r\n        };\r\n\r\n        // todo: when adding VS - ensure the events are added too...\r\n        att.addVs = function(value, language, shareMode) {\r\n            var dimensions = {};\r\n            if(language !== null)\r\n                dimensions[language] = ((shareMode === null || shareMode === undefined) ? false : shareMode);\r\n            var newVs = { \"Value\": value, \"Dimensions\": dimensions };\r\n            // ToDo: enhancer.enhanceWithCount(newVs.Dimensions);\r\n            this.Values.push(enhancer.enhanceVs(newVs));\r\n        };\r\n\r\n        // Now go through the Values and give them more commands\r\n        for (var v = 0; v < att.Values.length; v++)\r\n            enhancer.enhanceVs(att.Values[v]);\r\n\r\n        return att;\r\n    };\r\n\r\n    // this will enhance an entity\r\n    enhancer.enhanceEntity = function(ent) {\r\n        ent.getTitle = function() {\r\n            ent.getAttribute(ent.TitleAttributeName);\r\n        };\r\n\r\n        ent.hasAttribute = function(attrName) {\r\n            return ent.Attributes[attrName] !== undefined;\r\n        };\r\n\r\n        ent.getAttribute = function(attrName) {\r\n            return ent.Attributes[attrName];\r\n        };\r\n\r\n        // ToDo: Discuss with 2dm \r\n        ent.Attributes.addAttribute = function (attrName) {\r\n            ent.Attributes[attrName] = { Values: [] };\r\n            enhancer.enhanceAtt(ent.Attributes[attrName]);\r\n        };\r\n\r\n        for (var attKey in ent.Attributes)\r\n            if(ent.Attributes.hasOwnProperty(attKey) && typeof(ent.Attributes[attKey]) != 'function')\r\n                enhancer.enhanceAtt(ent.Attributes[attKey]);\r\n\r\n        return ent;\r\n    };\r\n\r\n    return enhancer.enhanceEntity(entity);\r\n}\n/* service to manage input types */\r\n(function () {\r\n\t\"use strict\";\r\n\r\n    // notes: this has not been tested extensively\r\n    // I'm guessing that it's not optimal yet, and I'm guessing that if the dialog is opened multiple times, that the list of dependencies just\r\n    // keeps on growing and the UI might just get heavier with time ... must test once we have a few custom input types\r\n\r\n\tangular.module(\"eavEditEntity\")\r\n        .service(\"customInputTypes\", [\"eavConfig\", \"toastr\", \"formlyConfig\", \"$q\", \"$interval\", \"$ocLazyLoad\", function (eavConfig, toastr, formlyConfig, $q, $interval, $ocLazyLoad) {\r\n            // Returns a typed default value from the string representation\r\n            var svc = {};\r\n            svc.inputTypesOnPage = {};\r\n            svc.allLoaded = true;\r\n            svc.assetsToLoad = [];\r\n\r\n\t        svc.addInputType = function addInputType(field) {\r\n\t            var config = field.InputTypeConfig;\r\n                // check if anything defined - older configurations don't have anything and will default to string-default anyhow\r\n\t            if (config === undefined || config === null)\r\n\t                return;\r\n\r\n\t            svc.inputTypesOnPage[config.Type] = config;\r\n\r\n\t            svc.addToLoadQueue(config);\r\n\t        };\r\n\r\n\t        svc.addToLoadQueue = function loadNewAssets(config) {\r\n\t            if (config.Assets === undefined || config.Assets === null || !config.Assets) {\r\n\t                config.assetsLoaded = true;\r\n\t                return;\r\n\t            }\r\n\r\n\t            // split by new-line, ensuring nothing blank\r\n\t            var list = config.Assets.split(\"\\n\");\r\n\r\n\t            for (var a = 0; a < list.length; a++) {\r\n\t                var asset = list[a].trim();\r\n\t                if (asset.length > 5) { // ensure we skip empty lines etc.\r\n\t                    svc.assetsToLoad.push(svc.resolveSpecialPaths(asset));\r\n\t                }\r\n\t            }\r\n\t        };\r\n\r\n\t        // now create promise and wait for everything to load\r\n\t        svc.loadWithPromise = function loadWithPromise() {\r\n\t            return $ocLazyLoad.load(svc.assetsToLoad);\r\n\r\n\t        };\r\n\r\n\t        svc.resolveSpecialPaths = function resolve(url) {\r\n\t            url = url.replace(/\\[System:Path\\]/i, eavConfig.getUrlPrefix(\"system\"))\r\n\t                .replace(/\\[Zone:Path\\]/i, eavConfig.getUrlPrefix(\"zone\"))\r\n\t                .replace(/\\[App:Path\\]/i, eavConfig.getUrlPrefix(\"app\"));\r\n\t            return url;\r\n\t        };\r\n\r\n\t        svc.checkDependencyArrival = function cda(typeName) {\r\n\t            return !!formlyConfig.getType(typeName);\r\n\t        };\r\n\r\n\t        return svc;\r\n\t    }]);\r\n\r\n})();\n/* global angular */\r\n(function () {\r\n\t\"use strict\";\r\n\r\n\tangular.module(\"eavEditEntity\")\r\n        .service(\"eavDefaultValueService\", function () {\r\n\t\t// Returns a typed default value from the string representation\r\n\t\treturn function parseDefaultValue(fieldConfig) {\r\n\t\t\tvar e = fieldConfig;\r\n\t\t\tvar d = e.templateOptions.settings.All.DefaultValue;\r\n\r\n\t\t    if (e.templateOptions.header.Prefill && e.templateOptions.header.Prefill[e.key]) {\r\n\t\t\t    d = e.templateOptions.header.Prefill[e.key];\r\n\t\t\t}\r\n\r\n\t\t\tswitch (e.type.split(\"-\")[0]) {\r\n\t\t\t\tcase \"boolean\":\r\n\t\t\t\t\treturn d !== undefined && d !== null ? d.toLowerCase() === \"true\" : false;\r\n\t\t\t\tcase \"datetime\":\r\n\t\t\t\t\treturn d !== undefined && d !== null && d !== \"\" ? new Date(d) : null;\r\n\t\t\t\tcase \"entity\":\r\n\t\t\t\t    return d !== undefined && d !== null && d !== \"\" ? d : []; \r\n\t\t\t\tcase \"number\":\r\n\t\t\t\t    return d !== undefined && d !== null && d !== \"\" ? Number(d) : \"\";\r\n                default:\r\n\t\t\t\t\treturn d ? d : \"\";\r\n\t\t\t}\r\n\t\t};\r\n\t});\r\n\r\n})();\n/* global angular */\r\n(function () {\r\n\t\"use strict\";\r\n\r\n    angular.module(\"eavEditEntity\")\r\n        /// Standard entity commands like get one, many etc.\r\n        .factory(\"entitiesSvc\", [\"$http\", \"appId\", \"toastrWithHttpErrorHandling\", \"promiseToastr\", function ($http, appId, toastrWithHttpErrorHandling, promiseToastr) {\r\n            var svc = {\r\n                toastr: toastrWithHttpErrorHandling\r\n            };\r\n\r\n            svc.getManyForEditing = function(appId, items) {\r\n                return $http.post(\"eav/entities/getmanyforediting\", items, { params: { appId: appId } });\r\n            };\r\n\r\n            svc.saveMany = function(appId, items) {\r\n                // first clean up unnecessary nodes - just to make sure we don't miss-read the JSONs transferred\r\n                var removeTempValue = function(value, key) { delete value._currentValue; };\r\n                var itmCopy = angular.copy(items);\r\n                for (var ei = 0; ei < itmCopy.length; ei++)\r\n                    angular.forEach(itmCopy[ei].Entity.Attributes, removeTempValue);\r\n\r\n                return $http.post(\"eav/entities/savemany\", itmCopy, { params: { appId: appId } }).then(function (serverKeys) {\r\n                    var syncUpdatedKeys = function(value, key) {\r\n                        // first ensure we don't break something\r\n                        var ent = value.Entity;\r\n                        if ((ent.Id === null || ent.Id === 0) && (ent.Guid !== null || typeof (ent.Guid) !== \"undefined\" || ent.Guid !== \"00000000-0000-0000-0000-000000000000\")) {\r\n                            // try to find it in the return material to re-assign it\r\n                            var newId = serverKeys.data[ent.Guid];\r\n                            value.Entity.Id = newId;\r\n                            value.Header.ID = newId;\r\n                        }\r\n                    };\r\n                    angular.forEach(items, syncUpdatedKeys);\r\n\r\n                    return serverKeys;\r\n                });\r\n            };\r\n\r\n            svc.delete = function del(type, id) {\r\n                console.log(\"try to delete\");\r\n\r\n                var delPromise = $http.get(\"eav/entities/delete\", {\r\n                    ignoreErrors: true,\r\n                    params: {\r\n                        'contentType': type,\r\n                        'id': id,\r\n                        'appId': appId\r\n                    }\r\n                });\r\n                return promiseToastr(delPromise, \"Message.Deleting\", \"Message.Ok\", \"Message.Error\");\r\n            };\r\n\r\n            svc.newEntity = function(header) {\r\n                return {\r\n                    Id: null,\r\n                    Guid: header.Guid, \r\n                    Type: {\r\n                        StaticName: header.ContentTypeName // contentTypeName\r\n                    },\r\n                    Attributes: {},\r\n                    IsPublished: true\r\n                };\r\n            };\r\n\r\n\r\n            svc.save = function save(appId, newData) {\r\n                return $http.post(\"eav/entities/save\", newData, { params: { appId: appId } });\r\n            };\r\n\r\n            return svc;\r\n        }]);\r\n\r\n\r\n})();\nangular.module(\"eavEditTemplates\", []).run([\"$templateCache\", function($templateCache) {$templateCache.put(\"form/edit-many-entities.html\",\"<div ng-if=\\\"vm.items != null\\\" ng-click=\\\"vm.debug.autoEnableAsNeeded($event)\\\">\\r\\n    <eav-language-switcher is-disabled=\\\"!vm.isValid()\\\"></eav-language-switcher>\\r\\n\\r\\n    <div ng-repeat=\\\"p in vm.items\\\" class=\\\"group-entity\\\">\\r\\n        <h3 class=\\\"clickable\\\" ng-click=\\\"p.collapse = !p.collapse\\\">\\r\\n            {{p.Header.Title ? p.Header.Title : \\'EditEntity.DefaultTitle\\' | translate }}&nbsp;\\r\\n            <span ng-if=\\\"p.Header.Group.SlotCanBeEmpty\\\" ng-click=\\\"vm.toggleSlotIsEmpty(p)\\\" stop-event=\\\"click\\\">\\r\\n                <switch ng-model=\\\"p.slotIsUsed\\\" class=\\\"tosic-blue\\\" style=\\\"top: 6px;\\\" tooltip=\\\"{{\\'EditEntity.SlotUsed\\' + p.slotIsUsed | translate}}\\\"></switch>\\r\\n            </span>\\r\\n            <span class=\\\"pull-right clickable\\\" style=\\\"font-size: smaller\\\">\\r\\n                <span class=\\\"low-priority collapse-entity-button\\\" ng-if=\\\"p.collapse\\\" icon=\\\"plus-sign\\\"></span>\\r\\n                <span class=\\\"collapse-entity-button\\\" ng-if=\\\"!p.collapse\\\" icon=\\\"minus-sign\\\"></span>\\r\\n            </span>\\r\\n        </h3>\\r\\n        <eav-edit-entity-form entity=\\\"p.Entity\\\" header=\\\"p.Header\\\" register-edit-control=\\\"vm.registerEditControl\\\" ng-hide=\\\"p.collapse\\\"></eav-edit-entity-form>\\r\\n    </div>\\r\\n\\r\\n\\r\\n    <div>\\r\\n        <!-- note: the buttons are not really disabled, because we want to be able to click them and see the error message -->\\r\\n        <button ng-class=\\\"{ \\'disabled\\': !vm.isValid() || vm.isWorking > 0}\\\" ng-click=\\\"vm.save(true)\\\" type=\\\"button\\\" class=\\\"btn btn-primary btn-lg submit-button\\\">\\r\\n            <span icon=\\\"ok\\\" tooltip=\\\"{{ \\'Button.Save\\' | translate }}\\\"></span> &nbsp;<span translate=\\\"Button.Save\\\"></span>\\r\\n        </button>\\r\\n        &nbsp;\\r\\n        <button ng-class=\\\"{ \\'disabled\\': !vm.isValid() || vm.isWorking > 0}\\\" class=\\\"btn btn-default btn-lg btn-square\\\" type=\\\"button\\\" ng-click=\\\"vm.save(false)\\\">\\r\\n            <span icon=\\\"check\\\" tooltip=\\\"{{ \\'Button.SaveAndKeepOpen\\' | translate }}\\\"></span>\\r\\n        </button>\\r\\n        &nbsp;\\r\\n        <!-- note: published status will apply to all - so the first is taken for identification if published -->\\r\\n        <switch ng-model=\\\"vm.willPublish\\\" class=\\\"tosic-blue\\\" style=\\\"top: 13px;\\\"></switch>\\r\\n        &nbsp;\\r\\n        <span ng-click=\\\"vm.willPublish = !vm.willPublish;\\\" class=\\\"save-published-icon\\\">\\r\\n            <i ng-if=\\\"vm.willPublish\\\" icon=\\\"eye-open\\\" tooltip=\\\"{{ \\'Status.Published\\' | translate }} - {{ \\'Message.WillPublish\\' | translate }}\\\"></i>\\r\\n            <i ng-if=\\\"!vm.willPublish\\\" icon=\\\"eye-close\\\" tooltip=\\\"{{ \\'Status.Unpublished\\' | translate }} - {{ \\'Message.WontPublish\\' | translate }}\\\"></i>\\r\\n        </span>\\r\\n\\r\\n\\r\\n        <span ng-if=\\\"vm.debug.on\\\">\\r\\n            <button tooltip=\\\"debug\\\" icon=\\\"zoom-in\\\" class=\\\"btn\\\" ng-click=\\\"vm.showDebugItems = !vm.showDebugItems\\\"></button>\\r\\n        </span>\\r\\n        <show-debug-availability class=\\\"pull-right\\\" style=\\\"margin-top: 20px;\\\"></show-debug-availability>\\r\\n    </div>\\r\\n    <div ng-if=\\\"vm.debug.on && vm.showDebugItems\\\">\\r\\n        <div>\\r\\n            isValid: {{vm.isValid()}}<br/>\\r\\n            isWorking: {{vm.isWorking}}\\r\\n        </div>\\r\\n        <pre>{{ vm.items | json }}</pre>\\r\\n    </div>\\r\\n</div>\");\n$templateCache.put(\"form/edit-single-entity.html\",\"<div ng-show=\\\"vm.editInDefaultLanguageFirst()\\\" translate=\\\"Message.PleaseCreateDefLang\\\">\\r\\n\t\\r\\n</div>\\r\\n<div ng-show=\\\"!vm.editInDefaultLanguageFirst()\\\">\\r\\n    <formly-form ng-if=\\\"vm.formFields && vm.formFields.length\\\" ng-submit=\\\"vm.onSubmit()\\\" form=\\\"vm.form\\\" model=\\\"vm.entity.Attributes\\\" fields=\\\"vm.formFields\\\"></formly-form>\\r\\n</div>\");\n$templateCache.put(\"form/main-form.html\",\"<div class=\\\"modal-body\\\">\\r\\n    <span class=\\\"pull-right\\\">\\r\\n        <span style=\\\"display: inline-block; position: relative; left:15px\\\">\\r\\n            <button class=\\\"btn btn-default btn-square btn-subtle\\\" type=\\\"button\\\" ng-click=\\\"vm.close()\\\"><i icon=\\\"remove\\\"></i></button>\\r\\n        </span>\\r\\n    </span>\\r\\n    <eav-edit-entities item-list=\\\"vm.itemList\\\" after-save-event=\\\"vm.afterSave\\\" state=\\\"vm.state\\\"></eav-edit-entities>\\r\\n</div>\");\n$templateCache.put(\"localization/formly-localization-wrapper.html\",\"<eav-localization-scope-control></eav-localization-scope-control>\\r\\n<div ng-if=\\\"!!value\\\">\\r\\n    <formly-transclude></formly-transclude>\\r\\n    <eav-localization-menu form-model=\\\"model\\\" field-model=\\\"model[options.key]\\\" options=\\\"options\\\" value=\\\"value\\\" index=\\\"index\\\"></eav-localization-menu>\\r\\n</div>\\r\\n<p class=\\\"bg-info\\\" style=\\\"padding:12px;\\\" ng-if=\\\"!value\\\" translate=\\\"LangWrapper.CreateValueInDefFirst\\\" translate-values=\\\"{ fieldname: \\'{{to.label}}\\' }\\\">Please... <i>\\'{{to.label}}\\'</i> in the def...</p>\");\n$templateCache.put(\"localization/language-switcher.html\",\"<tabset>\\r\\n    <tab ng-repeat=\\\"l in languages.languages\\\" heading=\\\"{{ l.name.substring(0, l.name.indexOf(\\'(\\') > 0 ? l.name.indexOf(\\'(\\') - 1 : 100 ) }}\\\" ng-click=\\\"!isDisabled ? languages.currentLanguage = l.key : false;\\\" disable=\\\"isDisabled\\\" active=\\\"languages.currentLanguage == l.key\\\" tooltip=\\\"{{l.name}}\\\"></tab>\\r\\n</tabset>\");\n$templateCache.put(\"localization/localization-menu.html\",\"<div dropdown is-open=\\\"status.isopen\\\" class=\\\"eav-localization\\\"> <!--style=\\\"z-index:{{1000 - index}};\\\"-->\\r\\n\t<a class=\\\"eav-localization-lock\\\" ng-click=\\\"vm.actions.toggleTranslate();\\\" ng-if=\\\"vm.isDefaultLanguage()\\\" title=\\\"{{vm.tooltip()}}\\\" ng-class=\\\"{ \\'eav-localization-lock-open\\': !options.templateOptions.disabled }\\\" dropdown-toggle>\\r\\n        {{vm.infoMessage()}} <i class=\\\"glyphicon glyphicon-globe\\\"></i>\\r\\n\t</a>\\r\\n    <ul class=\\\"dropdown-menu multi-level pull-right eav-localization-dropdown\\\" role=\\\"menu\\\" aria-labelledby=\\\"single-button\\\">\\r\\n        <li role=\\\"menuitem\\\"><a ng-click=\\\"vm.actions.translate()\\\" translate=\\\"LangMenu.Unlink\\\"></a></li>\\r\\n        <li role=\\\"menuitem\\\"><a ng-click=\\\"vm.actions.linkDefault()\\\" translate=\\\"LangMenu.LinkDefault\\\"></a></li>\\r\\n        <!-- Google translate is disabled because there is no longer a free version\\r\\n            <li role=\\\"menuitem\\\" class=\\\"dropdown-submenu\\\">\\r\\n            <a href=\\\"#\\\" translate=\\\"LangMenu.GoogleTranslate\\\"></a>\\r\\n            <ul class=\\\"dropdown-menu\\\">\\r\\n                <li ng-repeat=\\\"language in vm.languages.languages\\\" role=\\\"menuitem\\\">\\r\\n                    <a ng-click=\\\"vm.actions.autoTranslate(language.key)\\\" title=\\\"{{language.name}}\\\" href=\\\"#\\\">{{language.key}}</a>\\r\\n                </li>\\r\\n            </ul>\\r\\n        </li>-->\\r\\n        <li role=\\\"menuitem\\\" class=\\\"dropdown-submenu\\\">\\r\\n            <a href=\\\"#\\\" translate=\\\"LangMenu.Copy\\\"></a>\\r\\n            <ul class=\\\"dropdown-menu\\\">\\r\\n                <li ng-repeat=\\\"language in vm.languages.languages\\\" ng-class=\\\"{ disabled: options.templateOptions.disabled || !vm.hasLanguage(language.key) }\\\" role=\\\"menuitem\\\">\\r\\n                    <a ng-click=\\\"vm.actions.copyFrom(language.key)\\\" title=\\\"{{language.name}}\\\" href=\\\"#\\\">{{language.key}}</a>\\r\\n                </li>\\r\\n            </ul>\\r\\n        </li>\\r\\n        <li role=\\\"menuitem\\\" class=\\\"dropdown-submenu\\\">\\r\\n            <a href=\\\"#\\\" translate=\\\"LangMenu.Use\\\"></a>\\r\\n            <ul class=\\\"dropdown-menu\\\">\\r\\n                <li ng-repeat=\\\"language in vm.languages.languages\\\" ng-class=\\\"{ disabled: !vm.hasLanguage(language.key) }\\\" role=\\\"menuitem\\\">\\r\\n                    <a ng-click=\\\"vm.actions.useFrom(language.key)\\\" title=\\\"{{language.name}}\\\" href=\\\"#\\\">{{language.key}}</a>\\r\\n                </li>\\r\\n            </ul>\\r\\n        </li>\\r\\n        <li role=\\\"menuitem\\\" class=\\\"dropdown-submenu\\\">\\r\\n            <a href=\\\"#\\\" translate=\\\"LangMenu.Share\\\"></a>\\r\\n            <ul class=\\\"dropdown-menu\\\">\\r\\n                <li ng-repeat=\\\"language in vm.languages.languages\\\" ng-class=\\\"{ disabled: !vm.hasLanguage(language.key) }\\\" role=\\\"menuitem\\\">\\r\\n                    <a ng-click=\\\"vm.actions.shareFrom(language.key)\\\" title=\\\"{{language.name}}\\\" href=\\\"#\\\">{{language.key}}</a>\\r\\n                </li>\\r\\n            </ul>\\r\\n        </li>\\r\\n        <!-- All fields -->\\r\\n        <li class=\\\"divider\\\"></li>\\r\\n        <li role=\\\"menuitem\\\" class=\\\"dropdown-submenu\\\">\\r\\n            <a href=\\\"#\\\" translate=\\\"LangMenu.AllFields\\\"></a>\\r\\n            <ul class=\\\"dropdown-menu\\\">\\r\\n                <li role=\\\"menuitem\\\"><a ng-click=\\\"vm.actions.all.translate()\\\" translate=\\\"LangMenu.Unlink\\\"></a></li>\\r\\n                <li role=\\\"menuitem\\\"><a ng-click=\\\"vm.actions.all.linkDefault()\\\" translate=\\\"LangMenu.LinkDefault\\\"></a></li>\\r\\n                <li role=\\\"menuitem\\\" class=\\\"dropdown-submenu\\\">\\r\\n                    <a href=\\\"#\\\" translate=\\\"LangMenu.Copy\\\"></a>\\r\\n                    <ul class=\\\"dropdown-menu\\\">\\r\\n                        <li ng-repeat=\\\"language in vm.languages.languages\\\" role=\\\"menuitem\\\">\\r\\n                            <a ng-click=\\\"vm.actions.all.copyFrom(language.key)\\\" title=\\\"{{language.name}}\\\" href=\\\"#\\\">{{language.key}}</a>\\r\\n                        </li>\\r\\n                    </ul>\\r\\n                </li>\\r\\n                <li role=\\\"menuitem\\\" class=\\\"dropdown-submenu\\\">\\r\\n                    <a href=\\\"#\\\" translate=\\\"LangMenu.Use\\\"></a>\\r\\n                    <ul class=\\\"dropdown-menu\\\">\\r\\n                        <li ng-repeat=\\\"language in vm.languages.languages\\\" role=\\\"menuitem\\\">\\r\\n                            <a ng-click=\\\"vm.actions.all.useFrom(language.key)\\\" title=\\\"{{language.name}}\\\" href=\\\"#\\\">{{language.key}}</a>\\r\\n                        </li>\\r\\n                    </ul>\\r\\n                </li>\\r\\n                <li role=\\\"menuitem\\\" class=\\\"dropdown-submenu\\\">\\r\\n                    <a href=\\\"#\\\" translate=\\\"LangMenu.Share\\\"></a>\\r\\n                    <ul class=\\\"dropdown-menu\\\">\\r\\n                        <li ng-repeat=\\\"language in vm.languages.languages\\\" role=\\\"menuitem\\\">\\r\\n                            <a ng-click=\\\"vm.actions.all.shareFrom(language.key)\\\" title=\\\"{{language.name}}\\\" href=\\\"#\\\">{{language.key}}</a>\\r\\n                        </li>\\r\\n                    </ul>\\r\\n                </li>\\r\\n            </ul>\\r\\n        </li>\\r\\n    </ul>\\r\\n</div>\");\n$templateCache.put(\"wrappers/collapsible.html\",\"<div ng-show=\\\"!to.collapse\\\" class=\\\"group-field-set\\\">\\r\\n    <formly-transclude></formly-transclude>\\r\\n</div>\");\n$templateCache.put(\"wrappers/disablevisually.html\",\"<div visually-disabled=\\\"{{to.disabled}}\\\">\\r\\n    <formly-transclude></formly-transclude>\\r\\n</div>\");\n$templateCache.put(\"wrappers/eav-label.html\",\"<div>\\r\\n    <label for=\\\"{{id}}\\\" class=\\\"control-label eav-label {{to.labelSrOnly ? \\'sr-only\\' : \\'\\'}} {{to.type}}\\\" ng-if=\\\"to.label\\\">\\r\\n        {{to.label}}\\r\\n        {{to.required ? \\'*\\' : \\'\\'}}\\r\\n        <a tabindex=\\\"-1\\\" ng-click=\\\"to.showDescription = !to.showDescription\\\" href=\\\"javascript:void(0);\\\" ng-if=\\\"to.description && to.description != \\'\\'\\\">\\r\\n            <i icon=\\\"info-sign\\\" class=\\\"low-priority\\\"></i>\\r\\n        </a>\\r\\n    </label>\\r\\n    <p ng-if=\\\"to.showDescription\\\" class=\\\"bg-info\\\" style=\\\"padding: 5px;\\\" ng-bind-html=\\\"to.description\\\">\\r\\n    </p>\\r\\n    <formly-transclude></formly-transclude>\\r\\n</div>\");\n$templateCache.put(\"wrappers/field-group.html\",\"<div>\\r\\n    <h4 class=\\\"clickable\\\" ng-click=\\\"to.collapseGroup = !to.collapseGroup\\\">\\r\\n        {{to.label}}\\r\\n        <span class=\\\"pull-right btn-sm\\\">\\r\\n            <span ng-if=\\\"to.collapseGroup\\\" class=\\\"low-priority collapse-fieldgroup-button\\\" icon=\\\"plus-sign\\\"></span>\\r\\n            <span ng-if=\\\"!to.collapseGroup\\\" class=\\\"low-priority collapse-fieldgroup-button\\\" icon=\\\"minus-sign\\\"></span>\\r\\n        </span>\\r\\n    </h4>\\r\\n    <div ng-if=\\\"!to.collapseGroup\\\" style=\\\"padding: 5px;\\\" ng-bind-html=\\\"to.description\\\">\\r\\n    </div>\\r\\n    <formly-transclude></formly-transclude>\\r\\n</div>\");\n$templateCache.put(\"ml-entities/tests/SpecRunner.html\",\"<!DOCTYPE html>\\r\\n<html>\\r\\n<head>\\r\\n  <meta charset=\\\"utf-8\\\">\\r\\n  <title>Jasmine Spec Runner v2.3.4</title>\\r\\n    <!--\\r\\n  <link rel=\\\"shortcut icon\\\" type=\\\"image/png\\\" href=\\\"lib/jasmine-2.3.4/jasmine_favicon.png\\\">\\r\\n  <link rel=\\\"stylesheet\\\" href=\\\"lib/jasmine-2.3.4/jasmine.css\\\">\\r\\n\\r\\n  <script src=\\\"lib/jasmine-2.3.4/jasmine.js\\\"></script>\\r\\n  <script src=\\\"lib/jasmine-2.3.4/jasmine-html.js\\\"></script>\\r\\n  <script src=\\\"lib/jasmine-2.3.4/boot.js\\\"></script>\\r\\n        -->\\r\\n\\r\\n    <link rel=\\\"stylesheet\\\" href=\\\"../../../../node_modules\\\\grunt-contrib-jasmine\\\\node_modules\\\\jasmine-core/lib/jasmine-core/jasmine.css\\\">\\r\\n    <script src=\\\"../../../../node_modules\\\\grunt-contrib-jasmine\\\\node_modules\\\\jasmine-core/lib/jasmine-core/jasmine.js\\\"></script>\\r\\n    <script src=\\\"../../../../node_modules\\\\grunt-contrib-jasmine\\\\node_modules\\\\jasmine-core/lib/jasmine-core/jasmine-html.js\\\"></script>\\r\\n    <script src=\\\"../../../../node_modules\\\\grunt-contrib-jasmine\\\\node_modules\\\\jasmine-core/lib/jasmine-core/boot.js\\\"></script>\\r\\n  <!-- include source files here... -->\\r\\n    <!--\\r\\n  <script src=\\\"src/Player.js\\\"></script>\\r\\n  <script src=\\\"src/Song.js\\\"></script>\\r\\n    -->\\r\\n    <script src=\\\"../entity-enhancer.js\\\"></script>\\r\\n\\r\\n\\r\\n  <!-- include spec files here... -->\\r\\n    <!--\\r\\n  <script src=\\\"spec/SpecHelper.js\\\"></script>\\r\\n  <script src=\\\"spec/PlayerSpec.js\\\"></script>\\r\\n        -->\\r\\n    <script src=\\\"../specs/eav-content-ml.spec.js\\\"></script>\\r\\n\\r\\n</head>\\r\\n\\r\\n<body>\\r\\n</body>\\r\\n</html>\\r\\n\");\n$templateCache.put(\"fields/boolean/boolean-default.html\",\"<div class=\\\"checkbox checkbox-labeled\\\">\\r\\n    <!--<label>-->\\r\\n        <switch class=\\\"tosic-green pull-left\\\" ng-model=\\\"value.Value\\\"></switch>\\r\\n    <!-- maybe need the (hidden) input to ensure the label actually switches the boolean -->\\r\\n        <!--<input type=\\\"checkbox\\\" class=\\\"formly-field-checkbox\\\" ng-model=\\\"value.Value\\\" style=\\\"display: none\\\">-->\\r\\n        <div ng-include=\\\"\\'wrappers/eav-label.html\\'\\\"></div>\\r\\n        <!--{{to.label}} {{to.required ? \\'*\\' : \\'\\'}}-->\\r\\n    <!--</label>-->\\r\\n</div>\");\n$templateCache.put(\"fields/custom/custom-default.html\",\"<div class=\\\"alert alert-danger\\\">\\r\\n    ERROR - This is a custom field, you shouldn\\'t see this. You only see this because the custom-dialog is missing.\\r\\n</div>\\r\\n<input class=\\\"form-control input-lg\\\" ng-pattern=\\\"vm.regexPattern\\\" ng-model=\\\"value.Value\\\">\");\n$templateCache.put(\"fields/empty/empty-default.html\",\"<span></span>\");\n$templateCache.put(\"fields/entity/entity-default.html\",\"<div class=\\\"eav-entityselect\\\">\\r\\n\\r\\n    <div ui-tree=\\\"options\\\" data-empty-placeholder-enabled=\\\"false\\\" ng-show=\\\"to.settings.merged.EnableCreate || chosenEntities.length > 0\\\">\\r\\n        <table ui-tree-nodes ng-model=\\\"chosenEntities\\\" entity-validation ng-required=\\\"false\\\" class=\\\"table eav-entityselect-table\\\" style=\\\"table-layout:fixed;\\\">\\r\\n            <thead>\\r\\n                <tr>\\r\\n                    <th></th>\\r\\n                    <th></th>\\r\\n                    <th></th>\\r\\n                </tr>\\r\\n            </thead>\\r\\n            <tr ng-repeat=\\\"item in chosenEntities track by $id(item)\\\" ui-tree-node class=\\\"eav-entityselect-item\\\" ui-tree-handle>\\r\\n                <td>\\r\\n                    <i title=\\\"{{ \\'FieldType.Entity.DragMove\\' | translate }}\\\" class=\\\"icon-link pull-left eav-entityselect-icon\\\" ng-show=\\\"to.settings.Entity.AllowMultiValue\\\"></i>\\r\\n                </td>\\r\\n                <td>\\r\\n                    <span class=\\\"eav-entityselect-item-title\\\" title=\\\"{{getEntityText(item) + \\' (\\' + item + \\')\\'}}\\\">{{getEntityText(item)}}</span>\\r\\n                </td>\\r\\n                <td style=\\\"text-align:right;\\\">\\r\\n                    <ul class=\\\"eav-entityselect-item-actions\\\" data-nodrag>\\r\\n                        <li>\\r\\n                            <a title=\\\"{{ \\'FieldType.Entity.Edit\\' | translate }}\\\" ng-click=\\\"edit(item, index)\\\" ng-if=\\\"to.settings.merged.EnableEdit\\\">\\r\\n                                <i class=\\\"icon-pencil\\\"></i>\\r\\n                            </a>\\r\\n                        </li>\\r\\n                        <li>\\r\\n                            <a title=\\\"{{ \\'FieldType.Entity.Remove\\' | translate }}\\\" ng-click=\\\"removeSlot(item, $index)\\\" class=\\\"eav-entityselect-item-remove\\\" ng-if=\\\"to.settings.merged.EnableRemove\\\">\\r\\n                                <i ng-class=\\\"{ \\'icon-minus-circled\\': to.settings.merged.AllowMultiValue, \\'icon-down-dir\\': !to.settings.merged.AllowMultiValue  }\\\"></i>\\r\\n                            </a>\\r\\n                        </li>\\r\\n                        <li>\\r\\n                            <!-- todo: i18n, code in action, icon-visiblity/alignment -->\\r\\n                            <a title=\\\"{{ \\'FieldType.Entity.Delete\\' | translate }}\\\" ng-click=\\\"deleteItemInSlot(item, $index)\\\" class=\\\"eav-entityselect-item-remove\\\" ng-if=\\\"to.settings.merged.EnableDelete\\\">\\r\\n                                <i class=\\\"icon-cancel\\\"></i>\\r\\n                            </a>\\r\\n                        </li>\\r\\n                    </ul>\\r\\n                </td>\\r\\n            </tr>\\r\\n        </table>\\r\\n    </div>\\r\\n    <ol>\\r\\n        <!-- add existing entity to this list--><!--ng-if=\\\"to.settings.merged.EnableAddExisting\\\"-->\\r\\n        <li class=\\\"eav-entityselect-item subtle-till-mouseover\\\"\\r\\n            ng-show=\\\"to.settings.merged.EnableAddExisting && (to.settings.merged.AllowMultiValue || chosenEntities.length < 1)\\\">\\r\\n            <div>\\r\\n                <i class=\\\"icon-plus-circled pull-left eav-entityselect-icon-before-select\\\"></i>\\r\\n                <div class=\\\"eav-entityselect-selector-wrapper\\\">\\r\\n                    <select class=\\\"eav-entityselect-selector form-control input-lg\\\"\\r\\n                            formly-skip-ng-model-attrs-manipulator\\r\\n                            ng-model=\\\"selectedEntity\\\"\\r\\n                            ng-change=\\\"addEntity()\\\">\\r\\n                        <option value=\\\"\\\" translate=\\\"FieldType.Entity.Choose\\\"></option>\\r\\n                        <option ng-repeat=\\\"item in availableEntities\\\" ng-disabled=\\\"chosenEntities.indexOf(item.Value) != -1\\\" value=\\\"{{item.Value}}\\\">{{item.Text}}</option>\\r\\n                    </select>\\r\\n                </div>\\r\\n            </div>\\r\\n        </li>\\r\\n\\r\\n        <!-- create new entity to add to this list -->\\r\\n        <li ng-if=\\\"to.settings.merged.EnableCreate && (to.settings.merged.AllowMultiValue || chosenEntities.length < 1)\\\"\\r\\n            class=\\\"eav-entityselect-item eav-entityselect-create subtle-till-mouseover\\\">\\r\\n            <div ng-click=\\\"openNewEntityDialog()\\\">\\r\\n                <i class=\\\"icon-plus pull-left eav-entityselect-icon\\\"></i>\\r\\n                <span>{{ \\'FieldType.Entity.New\\' | translate }}&nbsp;</span>\\r\\n            </div>\\r\\n        </li>\\r\\n    </ol>\\r\\n</div>\");}]);\n\r\n(function () {\r\n    \"use strict\";\r\n\r\n    angular.module(\"eavFieldTemplates\")\r\n        .config([\"formlyConfigProvider\", function (formlyConfigProvider) {\r\n            formlyConfigProvider.setWrapper({\r\n                name: 'collapsible',\r\n                templateUrl: \"wrappers/collapsible.html\"\r\n            });\r\n        }]);\r\n})();\n\r\n(function() {\r\n\t\"use strict\";\r\n\r\n    angular.module(\"eavFieldTemplates\")\r\n        .config([\"formlyConfigProvider\", function(formlyConfigProvider) {\r\n            formlyConfigProvider.setWrapper({\r\n                name: 'disablevisually',\r\n                templateUrl: \"wrappers/disablevisually.html\"\r\n            });\r\n        }]);\r\n})();\n\r\n(function() {\r\n\t\"use strict\";\r\n\r\n    angular.module(\"eavFieldTemplates\")\r\n        .config([\"formlyConfigProvider\", function(formlyConfigProvider) {\r\n            formlyConfigProvider.setWrapper({\r\n                name: 'eavLabel',\r\n                templateUrl: \"wrappers/eav-label.html\"\r\n            });\r\n        }]);\r\n})();\n\r\n(function() {\r\n\t\"use strict\";\r\n\r\n    angular.module(\"eavFieldTemplates\")\r\n        .config([\"formlyConfigProvider\", function(formlyConfigProvider) {\r\n            formlyConfigProvider.setWrapper({\r\n                name: 'fieldGroup',\r\n                templateUrl: \"wrappers/field-group.html\"\r\n            });\r\n        }]);\r\n})();"],"sourceRoot":"/source/"}